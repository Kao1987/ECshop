(function(){"use strict";var e={13154:function(e,t,a){a.d(t,{A:function(){return y}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"cart-container container mt-5"},i={key:0,class:"text-center"},n={class:"table table-hover"},c=["src"],d=["onUpdate:modelValue","onInput"],u=["onClick"],p={class:"d-flex justify-content-between align-items-center mt-4"},m=["disabled"];function h(e,t,a,h,b,k){const g=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",l,[t[5]||(t[5]=(0,s.Lk)("h2",{class:"text-center mb-4"},"我的購物車",-1)),0===h.cartItems.length?((0,s.uX)(),(0,s.CE)("div",i,[t[3]||(t[3]=(0,s.Lk)("p",null,"購物車是空的。",-1)),(0,s.bF)(g,{to:"/",class:"btn btn-primary"},{default:(0,s.k6)((()=>t[2]||(t[2]=[(0,s.eW)("去購物")]))),_:1})])):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("table",n,[t[4]||(t[4]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{scope:"col"},"商品圖片"),(0,s.Lk)("th",{scope:"col"},"商品名稱"),(0,s.Lk)("th",{scope:"col"},"單價"),(0,s.Lk)("th",{scope:"col"},"數量"),(0,s.Lk)("th",{scope:"col"},"小計"),(0,s.Lk)("th",{scope:"col"},"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.cartItems,((e,a)=>((0,s.uX)(),(0,s.CE)("tr",{key:`${e.id}-${a}`},[(0,s.Lk)("td",null,[(0,s.Lk)("img",{src:e.image,alt:"item.name",class:"product-image",onError:t[0]||(t[0]=(...e)=>h.imageError&&h.imageError(...e))},null,40,c)]),(0,s.Lk)("td",null,(0,r.v_)(e.name),1),(0,s.Lk)("td",null,(0,r.v_)(e.price)+"元",1),(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control quantity-input","onUpdate:modelValue":t=>e.quantity=t,onInput:t=>h.updateQuantity(a,e.quantity),min:"1"},null,40,d),[[o.Jo,e.quantity,void 0,{number:!0}]])]),(0,s.Lk)("td",null,(0,r.v_)(e.quantity*e.price)+"元",1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-danger",onClick:e=>h.removeItem(a)},"刪除",8,u)])])))),128))])]),(0,s.Lk)("div",p,[(0,s.Lk)("h4",null,"總計："+(0,r.v_)(h.cartTotal)+"元",1),(0,s.Lk)("button",{class:"btn btn-success",disabled:0===h.cartItems.length,onClick:t[1]||(t[1]=(...e)=>h.checkout&&h.checkout(...e))},"結帳",8,m)])],64))])}a(44114),a(81454);var b=a(4249),k=a(81387),g=a(74300),f={name:"ShopCart",setup(){const e=(0,b.Pj)(),t=(0,k.rd)(),a=(0,s.EW)((()=>e.state.cart.items)),r=(0,s.EW)((()=>e.getters["cart/cartTotal"])),o=(0,s.EW)((()=>e.state.auth&&e.state.auth.isLoggedIn)),l=(t,a)=>{(!Number.isInteger(a)||a<1)&&(a=1),e.dispatch("cart/updateItemQuantity",{index:t,quantity:a})},i=e=>{e.target.src="/img/wrong.png"},n=t=>{e.dispatch("cart/removeItemFromCart",t)},c=async()=>{if(!o.value)return e.dispatch("notifications/showNotification",{type:"warning",message:"請先登入！",timeout:2e3}),void t.push({name:"UserLogin",query:{redirect:"/cart"}});const s=localStorage.getItem("authToken");if(!s)return e.dispatch("notifications/showNotification",{type:"error",message:"登入狀態已過期，請重新登入！",timeout:2e3}),void t.push({name:"UserLogin",query:{redirect:"/cart"}});if(0===a.value.length)return void e.dispatch("notifications/showNotification",{type:"warning",message:"購物車是空的，無法結帳！",timeout:2e3});const l={user_id:e.state.auth.user.id,items:a.value.map((e=>({product_id:e.id,quantity:e.quantity,price:e.price}))),total:r.value};try{const a=await g.A.orderAPI.createOrder(l);if(a.orderId){if(e.dispatch("cart/clearShoppingCart"),e.dispatch("notifications/showNotification",{type:"success",message:"order已成功提交！",timeout:2e3}),window.WebSocket&&window.dashboardSocket)try{window.dashboardSocket.send(JSON.stringify({type:"newOrder",orderId:a.orderId,total:r.value,created_at:(new Date).toISOString()}))}catch(i){console.error("WebSocket發送消息失敗:",i)}t.push({name:"OrderConfirmation",params:{orderId:a.orderId}})}}catch(i){console.error("提交訂單失敗:",i),i.response&&403===i.response.status?(e.dispatch("notifications/showNotification",{type:"error",message:"權限不足或登入已過期，請重新登入！",timeout:2e3}),t.push({name:"UserLogin",query:{redirect:"/cart"}})):e.dispatch("notifications/showNotification",{type:"error",message:"提交訂單失敗，請稍後再試！",timeout:2e3})}};return{cartItems:a,cartTotal:r,updateQuantity:l,removeItem:n,checkout:c,imageError:i}}},L=a(71241);const v=(0,L.A)(f,[["render",h],["__scopeId","data-v-2671b740"]]);var y=v},29719:function(e,t,a){a.d(t,{A:function(){return y}});var s=a(56768),r=a(45130),o=a(24232);const l={class:"login-page"},i={class:"login-container container"},n={class:"auth-card"},c={class:"form-floating mb-3"},d={class:"form-floating mb-3"},u=["type"],p={class:"d-flex justify-content-between align-items-center mb-4"},m={class:"text-center"},h={class:"mb-0"};function b(e,t,a,b,k,g){const f=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[t[11]||(t[11]=(0,s.Lk)("div",{class:"auth-header text-center mb-4"},[(0,s.Lk)("h2",{class:"fw-bold text-primary"},"會員登入"),(0,s.Lk)("p",{class:"text-muted"},"歡迎回來，請登入您的帳號")],-1)),(0,s.Lk)("form",{onSubmit:t[3]||(t[3]=(0,r.D$)(((...e)=>g.handleLogin&&g.handleLogin(...e)),["prevent"])),class:"auth-form"},[(0,s.Lk)("div",c,[(0,s.bo)((0,s.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>k.email=e),class:"form-control",placeholder:"請輸入電子郵件",required:""},null,512),[[r.Jo,k.email]]),t[4]||(t[4]=(0,s.Lk)("label",{for:"email"},"電子郵件",-1))]),(0,s.Lk)("div",d,[(0,s.bo)((0,s.Lk)("input",{type:k.showPassword?"text":"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>k.password=e),class:"form-control",placeholder:"請輸入密碼",required:""},null,8,u),[[r.hp,k.password]]),t[5]||(t[5]=(0,s.Lk)("label",{for:"password"},"密碼",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-link password-toggle",onClick:t[2]||(t[2]=e=>k.showPassword=!k.showPassword)},[(0,s.Lk)("i",{class:(0,o.C4)(k.showPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),(0,s.Lk)("div",p,[t[7]||(t[7]=(0,s.Lk)("div",{class:"form-check"},[(0,s.Lk)("input",{type:"checkbox",class:"form-check-input",id:"remember"}),(0,s.Lk)("label",{class:"form-check-label",for:"remember"},"記住我")],-1)),(0,s.bF)(f,{to:"/ForgotPwd",class:"text-primary text-decoration-none"},{default:(0,s.k6)((()=>t[6]||(t[6]=[(0,s.eW)(" 忘記密碼？ ")]))),_:1})]),t[10]||(t[10]=(0,s.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3"},[(0,s.Lk)("i",{class:"fas fa-sign-in-alt me-2"}),(0,s.eW)("登入 ")],-1)),(0,s.Lk)("div",m,[(0,s.Lk)("p",h,[t[9]||(t[9]=(0,s.eW)("還沒有帳號？ ")),(0,s.bF)(f,{to:"/UserRegister",class:"text-primary text-decoration-none"},{default:(0,s.k6)((()=>t[8]||(t[8]=[(0,s.eW)(" 立即註冊 ")]))),_:1})])])],32)])])])}a(44114),a(74300);var k=a(79539),g=a(4249),f={name:"UserLogin",data(){return{email:"",password:"",showPassword:!1}},methods:{...(0,g.i0)("auth",["login"]),async handleLogin(){try{const e=await this.login({email:this.email,password:this.password}),t=e.data;if(t){console.log("找到的用戶",t),alert("登入成功!歡迎"+t.name);const e=this.$route.query.redirect;"admin"===t.role.toLowerCase()?e&&e.startsWith("/admin")?this.$router.push(e):this.$router.push("/admin"):"user"===t.role.toLowerCase()?e&&!e.startsWith("/admin")?this.$router.push(e):this.$router.push("/MembersPage"):alert("帳號或密碼錯誤")}}catch(e){(0,k.h)(e,"登入失敗，請稍後再試")}}}},L=a(71241);const v=(0,L.A)(f,[["render",b],["__scopeId","data-v-4d007a45"]]);var y=v},49659:function(e,t,a){a.d(t,{A:function(){return U}});var s=a(56768),r=a(45130),o=a(24232);const l={class:"register-page"},i={class:"register-container container"},n={class:"auth-card"},c={class:"row g-3"},d={class:"col-12"},u={class:"form-floating"},p={class:"col-12"},m={class:"form-floating"},h={class:"col-12"},b={class:"form-floating"},k={class:"col-12"},g={class:"form-floating"},f={class:"col-12"},L={class:"form-floating password-wrapper"},v=["type"],y={class:"col-12"},w={class:"form-floating"},C={key:0,class:"alert alert-danger mt-3"},F={class:"mb-0"},P={class:"text-center mt-3"},_={class:"mb-0"};function I(e,t,a,I,x,A){const S=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[t[17]||(t[17]=(0,s.Lk)("div",{class:"auth-header text-center mb-4"},[(0,s.Lk)("h2",{class:"fw-bold text-primary"},"會員註冊"),(0,s.Lk)("p",{class:"text-muted"},"創建您的帳號，開始購物之旅")],-1)),(0,s.Lk)("form",{onSubmit:t[7]||(t[7]=(0,r.D$)(((...e)=>A.handleRegister&&A.handleRegister(...e)),["prevent"])),class:"auth-form"},[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("div",u,[(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>x.username=e),placeholder:"請輸入姓名",required:""},null,512),[[r.Jo,x.username]]),t[8]||(t[8]=(0,s.Lk)("label",{for:"username"},"會員姓名",-1))])]),(0,s.Lk)("div",p,[(0,s.Lk)("div",m,[(0,s.bo)((0,s.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>x.email=e),placeholder:"請輸入電子信箱",required:""},null,512),[[r.Jo,x.email]]),t[9]||(t[9]=(0,s.Lk)("label",{for:"email"},"電子郵件",-1))])]),(0,s.Lk)("div",h,[(0,s.Lk)("div",b,[(0,s.bo)((0,s.Lk)("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>x.phone=e),placeholder:"請輸入手機號碼",required:""},null,512),[[r.Jo,x.phone]]),t[10]||(t[10]=(0,s.Lk)("label",{for:"phone"},"手機號碼",-1))])]),(0,s.Lk)("div",k,[(0,s.Lk)("div",g,[(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"address","onUpdate:modelValue":t[3]||(t[3]=e=>x.address=e),placeholder:"請輸入收件地址",required:""},null,512),[[r.Jo,x.address]]),t[11]||(t[11]=(0,s.Lk)("label",{for:"address"},"收件地址",-1))])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",L,[(0,s.bo)((0,s.Lk)("input",{type:x.showPassword?"text":"password",class:"form-control",id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>x.password=e),placeholder:"請設定密碼",required:""},null,8,v),[[r.hp,x.password]]),t[12]||(t[12]=(0,s.Lk)("label",{for:"password"},"密碼",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-link password-toggle",onClick:t[5]||(t[5]=e=>x.showPassword=!x.showPassword)},[(0,s.Lk)("i",{class:(0,o.C4)(x.showPassword?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),(0,s.Lk)("div",y,[(0,s.Lk)("div",w,[(0,s.bo)((0,s.Lk)("input",{type:"password",class:"form-control",id:"confirmpassword","onUpdate:modelValue":t[6]||(t[6]=e=>x.confirmpassword=e),placeholder:"請再次輸入密碼",required:""},null,512),[[r.Jo,x.confirmpassword]]),t[13]||(t[13]=(0,s.Lk)("label",{for:"confirmpassword"},"確認密碼",-1))])])]),x.formErrors.length?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("ul",F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(x.formErrors,(e=>((0,s.uX)(),(0,s.CE)("li",{key:e},(0,o.v_)(e),1)))),128))])])):(0,s.Q3)("",!0),t[16]||(t[16]=(0,s.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mt-4"},[(0,s.Lk)("i",{class:"fas fa-user-plus me-2"}),(0,s.eW)("註冊 ")],-1)),(0,s.Lk)("div",P,[(0,s.Lk)("p",_,[t[15]||(t[15]=(0,s.eW)("已經有帳號？ ")),(0,s.bF)(S,{to:"/UserLogin",class:"text-primary text-decoration-none"},{default:(0,s.k6)((()=>t[14]||(t[14]=[(0,s.eW)(" 立即登入 ")]))),_:1})])])],32)])])])}a(44114);var x=a(74300),A=a(79539),S={name:"UserRegister",data(){return{username:"",phone:"",address:"",email:"",password:"",confirmpassword:"",formErrors:[],showPassword:!1}},methods:{async handleRegister(){try{this.formErrors=[];const e=this.validateForm();if(e.length>0)return void(this.formErrors=e);const t=await x.A.userAPI.register({name:this.sanitizeInput(this.username),phone:this.sanitizeInput(this.phone),address:this.sanitizeInput(this.address),email:this.sanitizeInput(this.email),password:this.sanitizeInput(this.password),role:"user"});t.success&&(alert("註冊成功"),this.$router.push("/UserLogin"))}catch(e){(0,A.h)(e,"註冊失敗，請稍後再試")}},validateForm(){const e=[];return this.username.trim()?this.username.length<2&&e.push("會員姓名至少需要2個字元"):e.push("請輸入會員姓名"),this.validatePhoneNumber(this.phone)||e.push("請輸入正確的手機號碼格式（10位數字）"),this.address.trim()?this.address.length<8&&e.push("地址需要更詳細"):e.push("請輸入地址"),this.validateEmail(this.email)||e.push("請輸入正確的電子郵件格式"),this.password?this.password.length<6?e.push("密碼長��需至少為6個字元"):/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/.test(this.password)||e.push("密碼需包含至少一個字母和一個數字"):e.push("請設定密碼"),this.password!==this.confirmpassword&&e.push("兩次密碼不相符"),e},validatePhoneNumber(e){const t=/^09\d{8}$/;return t.test(e)},validateEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},sanitizeInput(e){return"string"!==typeof e?"":e.trim().replace(/<[^>]*>/g,"").replace(/[<>]/g,"")}}},O=a(71241);const E=(0,O.A)(S,[["render",I],["__scopeId","data-v-7e1390a9"]]);var U=E},83686:function(e,t,a){a.d(t,{A:function(){return n}});var s=a(56768);function r(e,t,a,r,o,l){return(0,s.uX)(),(0,s.CE)("h5",null,"AdminContact")}var o={name:"AdminContact"},l=a(71241);const i=(0,l.A)(o,[["render",r]]);var n=i},89938:function(e,t,a){a.d(t,{A:function(){return Z}});var s=a(56768),r=a(24232);const o={class:"admin-dashboard container py-4"},l={class:"quick-actions mb-4"},i={class:"row g-3"},n={class:"col-md-3 col-sm-6"},c={class:"col-md-3 col-sm-6"},d={class:"col-md-3 col-sm-6"},u={class:"col-md-3 col-sm-6"},p={class:"stats-overview mb-4"},m={class:"row g-3"},h={class:"col-md-3 col-sm-6"},b={class:"stat-card"},k={class:"stat-info"},g={class:"col-md-3 col-sm-6"},f={class:"stat-card"},L={class:"stat-info"},v={class:"col-md-3 col-sm-6"},y={class:"stat-card"},w={class:"stat-info"},C={class:"col-md-3 col-sm-6"},F={class:"stat-card"},P={class:"stat-info"},_={class:"row g-4 mb-4"},I={class:"col-md-6"},x={class:"card shadow-sm h-100"},A={class:"card-body"},S={class:"comparison-item"},O={class:"d-flex justify-content-between mb-2"},E={class:"fw-bold"},U={class:"d-flex justify-content-between mb-2"},T={class:"fw-bold"},D={class:"d-flex justify-content-between"},M={class:"fw-bold"},N={class:"col-md-6"},X={class:"card shadow-sm h-100"},$={class:"card-body"},W={class:"comparison-item"},V={class:"d-flex justify-content-between mb-2"},q={class:"fw-bold"},B={class:"d-flex justify-content-between"},R={class:"fw-bold"};function j(e,t,a,j,J,K){const Q=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",o,[t[19]||(t[19]=(0,s.Lk)("div",{class:"dashboard-header mb-4"},[(0,s.Lk)("h2",{class:"fw-bold text-primary"},"管理後台儀表板"),(0,s.Lk)("p",{class:"text-muted"},"查看網站營運概況與重要數據")],-1)),(0,s.Lk)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[(0,s.bF)(Q,{to:"/admin/CarouselImages",class:"quick-action-card"},{default:(0,s.k6)((()=>t[0]||(t[0]=[(0,s.Lk)("i",{class:"fas fa-images"},null,-1),(0,s.Lk)("span",null,"輪播圖片管理",-1)]))),_:1})]),(0,s.Lk)("div",c,[(0,s.bF)(Q,{to:"/admin/products",class:"quick-action-card"},{default:(0,s.k6)((()=>t[1]||(t[1]=[(0,s.Lk)("i",{class:"fas fa-box"},null,-1),(0,s.Lk)("span",null,"商品管理",-1)]))),_:1})]),(0,s.Lk)("div",d,[(0,s.bF)(Q,{to:"/admin/orders",class:"quick-action-card"},{default:(0,s.k6)((()=>t[2]||(t[2]=[(0,s.Lk)("i",{class:"fas fa-shopping-cart"},null,-1),(0,s.Lk)("span",null,"訂單管理",-1)]))),_:1})]),(0,s.Lk)("div",u,[(0,s.bF)(Q,{to:"/admin/users",class:"quick-action-card"},{default:(0,s.k6)((()=>t[3]||(t[3]=[(0,s.Lk)("i",{class:"fas fa-users"},null,-1),(0,s.Lk)("span",null,"使用者管理",-1)]))),_:1})])])]),(0,s.Lk)("div",p,[(0,s.Lk)("div",m,[(0,s.Lk)("div",h,[(0,s.Lk)("div",b,[t[5]||(t[5]=(0,s.Lk)("div",{class:"stat-icon bg-primary"},[(0,s.Lk)("i",{class:"fas fa-shopping-bag"})],-1)),(0,s.Lk)("div",k,[(0,s.Lk)("h3",null,(0,r.v_)(J.todayOrders),1),t[4]||(t[4]=(0,s.Lk)("p",null,"今日訂單數",-1))])])]),(0,s.Lk)("div",g,[(0,s.Lk)("div",f,[t[7]||(t[7]=(0,s.Lk)("div",{class:"stat-icon bg-success"},[(0,s.Lk)("i",{class:"fas fa-dollar-sign"})],-1)),(0,s.Lk)("div",L,[(0,s.Lk)("h3",null,(0,r.v_)(K.formatNumber(J.todaySales)),1),t[6]||(t[6]=(0,s.Lk)("p",null,"今日銷售額",-1))])])]),(0,s.Lk)("div",v,[(0,s.Lk)("div",y,[t[9]||(t[9]=(0,s.Lk)("div",{class:"stat-icon bg-info"},[(0,s.Lk)("i",{class:"fas fa-user-plus"})],-1)),(0,s.Lk)("div",w,[(0,s.Lk)("h3",null,(0,r.v_)(J.todayNewMembers),1),t[8]||(t[8]=(0,s.Lk)("p",null,"今日新會員",-1))])])]),(0,s.Lk)("div",C,[(0,s.Lk)("div",F,[t[11]||(t[11]=(0,s.Lk)("div",{class:"stat-icon bg-warning"},[(0,s.Lk)("i",{class:"fas fa-users"})],-1)),(0,s.Lk)("div",P,[(0,s.Lk)("h3",null,(0,r.v_)(J.totalMembers),1),t[10]||(t[10]=(0,s.Lk)("p",null,"總會員數",-1))])])])])]),t[20]||(t[20]=(0,s.Fv)('<div class="card shadow-sm mb-4" data-v-82bf2296><div class="card-body" data-v-82bf2296><h5 class="card-title mb-4" data-v-82bf2296><i class="fas fa-chart-line me-2" data-v-82bf2296></i>銷售趨勢 </h5><div class="chart-container" data-v-82bf2296><canvas id="salesChart" data-v-82bf2296></canvas></div></div></div>',1)),(0,s.Lk)("div",_,[(0,s.Lk)("div",I,[(0,s.Lk)("div",x,[(0,s.Lk)("div",A,[t[15]||(t[15]=(0,s.Lk)("h5",{class:"card-title mb-3"},[(0,s.Lk)("i",{class:"fas fa-calendar-day me-2"}),(0,s.eW)("銷售比較 ")],-1)),(0,s.Lk)("div",S,[(0,s.Lk)("div",O,[t[12]||(t[12]=(0,s.Lk)("span",null,"今日銷售額",-1)),(0,s.Lk)("span",E,(0,r.v_)(K.formatNumber(J.todaySales)),1)]),(0,s.Lk)("div",U,[t[13]||(t[13]=(0,s.Lk)("span",null,"昨日銷售額",-1)),(0,s.Lk)("span",T,(0,r.v_)(K.formatNumber(J.yesterdaySales)),1)]),(0,s.Lk)("div",D,[t[14]||(t[14]=(0,s.Lk)("span",null,"近7日銷售額",-1)),(0,s.Lk)("span",M,(0,r.v_)(K.formatNumber(J.last7DaySales)),1)])])])])]),(0,s.Lk)("div",N,[(0,s.Lk)("div",X,[(0,s.Lk)("div",$,[t[18]||(t[18]=(0,s.Lk)("h5",{class:"card-title mb-3"},[(0,s.Lk)("i",{class:"fas fa-user-friends me-2"}),(0,s.eW)("會員統計 ")],-1)),(0,s.Lk)("div",W,[(0,s.Lk)("div",V,[t[16]||(t[16]=(0,s.Lk)("span",null,"今日新增會員",-1)),(0,s.Lk)("span",q,(0,r.v_)(J.todayNewMembers),1)]),(0,s.Lk)("div",B,[t[17]||(t[17]=(0,s.Lk)("span",null,"累計會員總數",-1)),(0,s.Lk)("span",R,(0,r.v_)(J.totalMembers),1)])])])])])])])}a(98992),a(54520),a(3949),a(81454),a(8872);var J=a(46591),K=a(74300),Q={name:"AdminDashboard",data(){return{todayOrders:0,todaySales:0,yesterdaySales:0,last7DaySales:0,salesData:[],lowStockProducts:[],todayNewMembers:0,totalMembers:0,carouselImages:[],products:[],sevenDaySalesRanking:[],monthSalesRanking:[],socket:null}},async mounted(){await this.loadDashboardData(),this.renderSalesChart()},methods:{async loadDashboardData(){try{const[e,t,a]=await Promise.all([K.A.orderAPI.getOrders(),K.A.userAPI.getAllUsers(),K.A.productAPI.getAllProducts()]),s=e.data,r=t.data,o=a.data;this.products=o;const l=new Date,i=l.toISOString().split("T")[0];this.todayOrders=s.filter((e=>e.order_date.split("T")[0]===i)).length;const n=new Date;n.setDate(n.getDate()-1);const c=n.toISOString().split("T")[0],d=new Date;d.setDate(d.getDate()-7);const u=d.toISOString().split("T")[0];this.todaySales=s.filter((e=>e.order_date.split("T")[0]===i)).reduce(((e,t)=>e+Number(t.total)),0),this.yesterdaySales=s.filter((e=>e.order_date.split("T")[0]===c)).reduce(((e,t)=>e+Number(t.total)),0),this.last7DaySales=s.filter((e=>e.order_date.split("T")[0]>=u&&e.order_date.split("T")[0]<=i)).reduce(((e,t)=>e+Number(t.total)),0);const p={};s.forEach((e=>{const t=e.order_date.split("T")[0],a=Number(e.total);p[t]?p[t]+=a:p[t]=a})),this.salesData=Object.keys(p).map((e=>({date:e,amount:p[e]}))).sort(((e,t)=>new Date(e.date)-new Date(t.date))),this.todayNewMembers=r.filter((e=>{if(e.created_at){const t=new Date(e.created_at).toISOString().split("T")[0];return t===i}return!1})).length,this.totalMembers=r.length}catch(e){console.error("加載儀表板數據時出錯：",e),alert("加載儀表板數據時出錯，請稍後再試！")}},renderSalesChart(){if(!this.salesData||0===this.salesData.length)return void console.error("銷售數據未加載！");const e=document.getElementById("salesChart").getContext("2d");this.chart&&this.chart.destroy(),this.chart=new J.Ay(e,{type:"line",data:{labels:this.salesData.map((e=>e.date)),datasets:[{label:"銷售金額",data:this.salesData.map((e=>e.amount)),borderColor:"rgba(75,192,192,1)",backgroundColor:"rgba(75,192,192,0.1)",borderWidth:2,fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(e.parsed.y)),t}}}},scales:{x:{grid:{display:!1},ticks:{maxRotation:45,minRotation:45}},y:{beginAtZero:!0,ticks:{callback:function(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(e)}}}}}})},formatNumber(e){return Number(e).toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).replace(/^NT\$\s?/,"")},initWebSocket(){this.socket=new WebSocket("ws://localhost:5002/ws/admin"),this.socket.onmessage=e=>{const t=JSON.parse(e.data);"newOrder"===t.type&&this.updateDashboardData()}},updateDashboardData(e){const t=new Date,a=t.Date(e.created_at);e.order_date.split("T")[0]===a&&(this.todayOrders++,this.todaySales+=Number(e.total))}}},z=a(71241);const G=(0,z.A)(Q,[["render",j],["__scopeId","data-v-82bf2296"]]);var Z=G},94625:function(e,t,a){a.d(t,{A:function(){return M}});var s=a(56768),r=a(45130),o=a(24232);const l={class:"admin-dashboard container mt-5"},i={class:"filters-container p-3 bg-light rounded-3 mb-4"},n={class:"row g-3"},c={class:"col-md-5"},d={class:"input-group"},u={class:"col-md-4"},p={class:"col-md-3"},m={class:"table-responsive rounded-3 shadow-sm"},h={class:"table table-hover mb-0"},b={class:"align-middle"},k={class:"align-middle"},g={class:"d-flex align-items-center"},f={class:"user-avatar"},L={class:"ms-2"},v={class:"align-middle fw-bold"},y={class:"align-middle"},w={class:"align-middle"},C={class:"align-middle"},F=["onClick"],P=["onClick","disabled"],_={class:"pagination-container mt-4 d-flex justify-content-between align-items-center"},I={class:"page-info text-muted"},x={class:"pagination-controls"},A=["disabled"],S=["disabled"];function O(e,t,a,O,E,U){const T=(0,s.gN)("tooltip");return(0,s.uX)(),(0,s.CE)("div",l,[t[13]||(t[13]=(0,s.Lk)("div",{class:"dashboard-header mb-4"},[(0,s.Lk)("h2",{class:"text-primary fw-bold"},"訂單管理系統"),(0,s.Lk)("p",{class:"text-muted"},"管理所有訂單狀態與詳情")],-1)),(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[t[5]||(t[5]=(0,s.Lk)("span",{class:"input-group-text bg-white"},[(0,s.Lk)("i",{class:"fas fa-search text-muted"})],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control border-start-0",placeholder:"搜尋訂單號或用戶名","onUpdate:modelValue":t[0]||(t[0]=e=>E.searchQuery=e)},null,512),[[r.Jo,E.searchQuery]])])]),(0,s.Lk)("div",u,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>E.selectedStatus=e),class:"form-select"},t[6]||(t[6]=[(0,s.Fv)('<option value="" data-v-50128844>所有訂單狀態</option><option value="pending" data-v-50128844>待確認</option><option value="shipped" data-v-50128844>已發貨</option><option value="completed" data-v-50128844>已完成</option><option value="cancelled" data-v-50128844>已取消</option>',5)]),512),[[r.u1,E.selectedStatus]])]),(0,s.Lk)("div",p,[(0,s.Lk)("button",{class:"btn btn-primary w-100",onClick:t[2]||(t[2]=(...e)=>U.filterOrders&&U.filterOrders(...e))},t[7]||(t[7]=[(0,s.Lk)("i",{class:"fas fa-filter me-2"},null,-1),(0,s.eW)("套用篩選 ")]))])])]),(0,s.Lk)("div",m,[(0,s.Lk)("table",h,[t[10]||(t[10]=(0,s.Lk)("thead",{class:"bg-light"},[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{class:"py-3"},"訂單號"),(0,s.Lk)("th",{class:"py-3"},"用戶資訊"),(0,s.Lk)("th",{class:"py-3"},"總金額"),(0,s.Lk)("th",{class:"py-3"},"狀態"),(0,s.Lk)("th",{class:"py-3"},"建立日期"),(0,s.Lk)("th",{class:"py-3"},"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(U.paginatedOrders,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",b,"#"+(0,o.v_)(e.id),1),(0,s.Lk)("td",k,[(0,s.Lk)("div",g,[(0,s.Lk)("span",f,(0,o.v_)(U.getUserInitials(e.user_id)),1),(0,s.Lk)("span",L,(0,o.v_)(U.getUserName(e.user_id)),1)])]),(0,s.Lk)("td",v,(0,o.v_)(U.formatCurrency(e.total)),1),(0,s.Lk)("td",y,[(0,s.Lk)("span",{class:(0,o.C4)(U.getStatusBadgeClass(e.status))},(0,o.v_)(U.formatStatus(e.status)),3)]),(0,s.Lk)("td",w,(0,o.v_)(U.formatDate(e.order_date)),1),(0,s.Lk)("td",C,[(0,s.Lk)("button",{class:"btn btn-outline-info btn-sm me-2",onClick:t=>U.viewOrderDetails(e)},t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-eye me-1"},null,-1),(0,s.eW)("查看 ")]),8,F),(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>U.cancelOrder(e),disabled:"cancelled"===e.status||"completed"===e.status},t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,s.eW)("取消 ")]),8,P)),[[T,"cancelled"===e.status||"completed"===e.status?"無法取消已完成或已取消的訂單":"取消此訂單"]])])])))),128))])])]),(0,s.Lk)("div",_,[(0,s.Lk)("div",I," 顯示第 "+(0,o.v_)(U.paginationInfo.start)+" 到 "+(0,o.v_)(U.paginationInfo.end)+" 筆，共 "+(0,o.v_)(U.filteredOrders.length)+" 筆 ",1),(0,s.Lk)("div",x,[(0,s.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:t[3]||(t[3]=(...e)=>U.prevPage&&U.prevPage(...e)),disabled:1===E.currentPage},t[11]||(t[11]=[(0,s.Lk)("i",{class:"fas fa-chevron-left me-1"},null,-1),(0,s.eW)("上一頁 ")]),8,A),(0,s.Lk)("button",{class:"btn btn-outline-primary",onClick:t[4]||(t[4]=(...e)=>U.nextPage&&U.nextPage(...e)),disabled:E.currentPage===U.totalPages},t[12]||(t[12]=[(0,s.eW)(" 下一頁"),(0,s.Lk)("i",{class:"fas fa-chevron-right ms-1"},null,-1)]),8,S)])])])}a(44114),a(98992),a(54520),a(72577),a(81454);var E=a(74300),U=(a(12952),{name:"AdminOrders",data(){return{orders:[],users:[],searchQuery:"",selectedStatus:"",currentPage:1,itemsPerPage:10,debouncedFilter:null,loading:!1,showToast:!1,toastMessage:"",toastType:"success"}},computed:{filteredOrders(){return this.orders.filter((e=>{const t=e.user_id&&e.user_id.toString().toLowerCase().includes(this.searchQuery.toLowerCase())||e.id&&e.id.toString().toLowerCase().includes(this.searchQuery.toLowerCase()),a=!this.selectedStatus||e.status===this.selectedStatus;return t&&a}))},totalPages(){return Math.ceil(this.filteredOrders.length/this.itemsPerPage)||1},paginatedOrders(){const e=(this.currentPage-1)*this.itemsPerPage,t=this.currentPage*this.itemsPerPage;return this.filteredOrders.slice(e,t)},paginationInfo(){const e=(this.currentPage-1)*this.itemsPerPage+1,t=Math.min(this.currentPage*this.itemsPerPage,this.filteredOrders.length);return{start:e,end:t}}},methods:{async fetchOrders(){try{const e=await E.A.orderAPI.getOrders();console.log("API回傳的訂單資料",e.data);const t=e.data;this.orders=t.map((e=>({...e,status:e.status||"pending"})))||[]}catch(e){e.response&&401===e.response.status?(alert("您的登入已過期，請重新登入。"),this.$store.dispatch("auth/logout"),this.$router.push("/UserLogin")):e.response&&403===e.response.status?(alert("您沒有權限訪問此頁面"),this.$router.push("/")):(console.error("加載訂單時出錯",e),alert("加載訂單時出錯，請稍後再試")),this.orders=[]}},async fetchUsers(){try{const e=await E.A.userAPI.getAllUsers();this.users=e.data||[]}catch(e){console.error("加載用戶時出錯",e),alert("加載用戶時出錯，請稍候再試！"),this.users=[]}},viewOrderDetails(e){console.log("查看訂單",e),this.$router.push({name:"OrderDetail",params:{id:e.id}})},async cancelOrder(e){if(confirm("確定要取消這個訂單？"))try{await E.A.orderAPI.updateOrder(e.id,{status:"cancelled"}),e.status="cancelled",alert("訂單已成功取消。")}catch(t){console.error("取消訂單時出錯",t),alert("取消訂單時出錯")}},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatStatus(e){const t={pending:"待確認",shipped:"已發貨",completed:"已完成",cancelled:"已取消"};return t[e]||"未知狀態"},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},filterOrders(){this.currentPage=1},getUserName(e){const t=this.users.find((t=>t.id==e));return t?t.name:"未知用戶"},getStatusBadgeClass(e){const t={pending:"badge bg-warning text-dark",shipped:"badge bg-info text-white",completed:"badge bg-success text-white",cancelled:"badge bg-danger text-white"};return t[e]||"badge bg-secondary"},getUserInitials(e){const t=this.users.find((t=>t.id===e));return t?t.name.substring(0,2).toUpperCase():"??"},showNotification(e,t="success"){this.toastMessage=e,this.toastType=t,this.showToast=!0,setTimeout((()=>{this.showToast=!1}),3e3)}},async mounted(){try{await this.fetchOrders(),await this.fetchUsers()}catch(e){console.error("獲取訂單或用戶數據時出錯",e),alert("獲取訂單或用戶數據時出錯，請稍後再試！")}},watch:{searchQuery(){this.debouncedFilter()},selectedStatus(){this.debouncedFilter()}}}),T=a(71241);const D=(0,T.A)(U,[["render",O],["__scopeId","data-v-50128844"]]);var M=D},56689:function(e,t,a){a.d(t,{A:function(){return me}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"admin-dashboard container mt-5"},i={class:"d-flex justify-content-between align-items-center mb-4"},n={class:"btn-group shadow-sm"},c={key:0,class:"accordion",id:"productAccordion"},d={class:"accordion-item"},u={class:"accordion-header",id:"headingProducts"},p={class:"accordion-body"},m={class:"card-header bg-white d-flex justify-content-between align-items-center mb-3"},h={class:"d-flex align-items-center"},b=["value"],k={class:"card-footer bg-white d-flex justify-content-between align-items-center"},g=["disabled"],f=["disabled"],L={class:"table"},v={class:"product-name-container text-truncate",style:{"max-width":"150px"}},y={class:"product-name mb-1"},w=["onClick"],C={class:"text-nowrap text-center"},F={class:"product-description-container"},P=["onClick"],_={class:"text-center align-middle"},I={class:"d-flex justify-content-center"},x=["onClick"],A={class:"row mt-5"},S={class:"col-md-6"},O={class:"accordion",id:"tagAccordion"},E={class:"accordion-item"},U={class:"accordion-header",id:"headingTags"},T={class:"accordion-body"},D={class:"d-flex justify-content-end mb-3"},M={class:"table"},N=["onClick"],X=["onClick"],$={class:"col-md-6"},W={class:"accordion",id:"brandAccordion"},V={class:"accordion-item"},q={class:"accordion-header",id:"headingBrands"},B={class:"accordion-body"},R={class:"d-flex justify-content-end mb-3"},j={class:"table"},J=["onClick"],K=["onClick"],Q={class:"modal fade",tabindex:"-1",ref:"tagModal"},z={class:"modal-dialog"},G={class:"modal-content"},Z={class:"modal-header"},H={class:"modal-body"},Y={class:"modal-footer"},ee={class:"modal fade",tabindex:"-1",ref:"brandModal"},te={class:"modal-dialog"},ae={class:"modal-content"},se={class:"modal-header"},re={class:"modal-body"},oe={class:"modal-footer"};function le(e,t,a,le,ie,ne){const ce=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",l,[t[24]||(t[24]=(0,s.Lk)("h2",{class:"text-center"},"商品管理",-1)),(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[(0,s.bF)(ce,{to:"/admin/CreateProduct",class:"btn btn-success d-flex align-items-center"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,s.eW)("新增商品 ")]))),_:1}),(0,s.bF)(ce,{to:"/admin/SpecialOffers",class:"btn btn-primary d-flex align-items-center"},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.Lk)("i",{class:"bi bi-tag me-2"},null,-1),(0,s.eW)("特價商品 ")]))),_:1})])]),ie.isSectionOpen.products?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("h2",u,[(0,s.Lk)("button",{class:"accordion-button",type:"button",onClick:t[0]||(t[0]=e=>ne.toggleSection("products"))}," 商品管理 ")]),(0,s.Lk)("div",{class:(0,r.C4)(["accordion-collapse collapse show",{show:ie.isSectionOpen.products}]),"aria-labelledby":"headingProducts","data-bs-parent":"#productAccordion"},[(0,s.Lk)("div",p,[(0,s.Lk)("div",m,[t[19]||(t[19]=(0,s.Lk)("h5",{class:"mb-0"},"商品清單",-1)),(0,s.Lk)("div",h,[t[18]||(t[18]=(0,s.Lk)("label",{class:"me-2"},"每頁顯示：",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>ie.itemsPerPage=e),class:"form-select form-select-sm w-auto"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ie.itemsPerPageOptions,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,r.v_)(e),9,b)))),128))],512),[[o.u1,ie.itemsPerPage,void 0,{number:!0}]])]),(0,s.Lk)("div",k,[(0,s.Lk)("div",null,"第 "+(0,r.v_)(ie.currentPage)+" 頁，共 "+(0,r.v_)(ne.totalPages)+" 頁",1),(0,s.Lk)("button",{class:"btn btn-outline-secondary",disabled:1===ie.currentPage,onClick:t[2]||(t[2]=e=>ie.currentPage--)}," 上一頁 ",8,g),(0,s.Lk)("button",{class:"btn btn-outline-secondary",disabled:ie.currentPage===ne.totalPages,onClick:t[3]||(t[3]=e=>ie.currentPage++)}," 下一頁 ",8,f)])]),(0,s.Lk)("table",L,[t[21]||(t[21]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",{class:"text-nowrap text-center"},[(0,s.Lk)("th",null,"商品名稱"),(0,s.Lk)("th",null,"價格"),(0,s.Lk)("th",null,"庫存"),(0,s.Lk)("th",null,"描述"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ne.paginatedProducts,((e,a)=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,[(0,s.Lk)("div",v,[(0,s.Lk)("p",y,(0,r.v_)(e.name),1),e.name.length>20?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-link btn-sm p-0",onClick:t=>ne.toggleName(e)},(0,r.v_)(e.isNameExpanded?"收起":"查看更多"),9,w)):(0,s.Q3)("",!0)])]),(0,s.Lk)("td",null,"NT$"+(0,r.v_)(Math.round(e.price)),1),(0,s.Lk)("td",C,[(0,s.Lk)("span",{class:(0,r.C4)(e.stock<=10?"text-danger":"text-success")},(0,r.v_)(e.stock),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",F,[(0,s.Lk)("p",{class:(0,r.C4)(["product-description mb-1",{expanded:e.isDescriptionExpanded}]),style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis"}},(0,r.v_)(e.isDescriptionExpanded?e.description:e.description.slice(0,50)+"..."),3),e.description.length>50?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-link btn-sm p-0",onClick:t=>ne.toggleDescription(e)},(0,r.v_)(e.isDescriptionExpanded?"收起":"查看更多"),9,P)):(0,s.Q3)("",!0)])]),(0,s.Lk)("td",_,[(0,s.Lk)("div",I,[(0,s.bF)(ce,{to:{name:"EditProduct",params:{id:e.id}},class:"btn btn-warning btn-sm me-2"},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)(" 編輯 ")]))),_:2},1032,["to"]),(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t=>ne.deleteProduct(e.id,a)}," 刪除 ",8,x)])])])))),128))])])])],2)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",A,[(0,s.Lk)("div",S,[(0,s.Lk)("div",O,[(0,s.Lk)("div",E,[(0,s.Lk)("h2",U,[(0,s.Lk)("button",{class:"accordion-button",type:"button",onClick:t[4]||(t[4]=e=>ne.toggleSection("tags"))}," 標籤管理 ")]),(0,s.Lk)("div",{class:(0,r.C4)(["accordion-collapse collapse",{show:ie.isSectionOpen.tags}]),"aria-labelledby":"headingTags","data-bs-parent":"#tagAccordion"},[(0,s.Lk)("div",T,[(0,s.Lk)("div",D,[(0,s.Lk)("button",{class:"btn btn-success",onClick:t[5]||(t[5]=(...e)=>ne.openCreateTagModal&&ne.openCreateTagModal(...e))},"新增標籤")]),(0,s.Lk)("table",M,[t[22]||(t[22]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"標籤名稱"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ie.tags,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,r.v_)(e.name),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>ne.openEditTagModal(t)},"編輯",8,N),(0,s.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>ne.deleteTag(e.id,t)},"刪除",8,X)])])))),128))])])])],2)])])]),(0,s.Lk)("div",$,[(0,s.Lk)("div",W,[(0,s.Lk)("div",V,[(0,s.Lk)("h2",q,[(0,s.Lk)("button",{class:"accordion-button",type:"button",onClick:t[6]||(t[6]=e=>ne.toggleSection("brands"))}," 廠牌管理 ")]),(0,s.Lk)("div",{class:(0,r.C4)(["accordion-collapse collapse",{show:ie.isSectionOpen.brands}]),"aria-labelledby":"headingBrands","data-bs-parent":"#brandAccordion"},[(0,s.Lk)("div",B,[(0,s.Lk)("div",R,[(0,s.Lk)("button",{class:"btn btn-success",onClick:t[7]||(t[7]=(...e)=>ne.openCreateBrandModal&&ne.openCreateBrandModal(...e))}," 新增廠牌 ")]),(0,s.Lk)("table",j,[t[23]||(t[23]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"廠牌名稱"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ie.brands,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,r.v_)(e.name),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>ne.openEditBrandModal(t)},"編輯",8,J),(0,s.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>ne.deleteBrand(e.id,t)},"刪除",8,K)])])))),128))])])])],2)])])])])]),(0,s.Lk)("div",Q,[(0,s.Lk)("div",z,[(0,s.Lk)("div",G,[(0,s.Lk)("div",Z,[t[25]||(t[25]=(0,s.Lk)("h5",{class:"modal-title"},"編輯標籤",-1)),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[8]||(t[8]=(...e)=>ne.closeTagModal&&ne.closeTagModal(...e))})]),(0,s.Lk)("div",H,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>ie.tagForm.name=e),class:"form-control",placeholder:"標籤名稱"},null,512),[[o.Jo,ie.tagForm.name]])]),(0,s.Lk)("div",Y,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=(...e)=>ne.closeTagModal&&ne.closeTagModal(...e))},"取消"),(0,s.Lk)("button",{type:"submit",class:"btn btn-primary",onClick:t[11]||(t[11]=(...e)=>ne.saveTag&&ne.saveTag(...e))},(0,r.v_)(ie.isEditingTag?"保存變更":"新增標籤"),1)])])])],512),(0,s.Lk)("div",ee,[(0,s.Lk)("div",te,[(0,s.Lk)("div",ae,[(0,s.Lk)("div",se,[t[26]||(t[26]=(0,s.Lk)("h5",{class:"modal-title"},"編輯廠牌",-1)),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=(...e)=>ne.closeBrandModal&&ne.closeBrandModal(...e))})]),(0,s.Lk)("div",re,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>ie.brandForm.name=e),class:"form-control",placeholder:"廠牌名稱"},null,512),[[o.Jo,ie.brandForm.name]])]),(0,s.Lk)("div",oe,[(0,s.Lk)("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=(...e)=>ne.closeBrandModal&&ne.closeBrandModal(...e))},"取消"),(0,s.Lk)("button",{class:"btn btn-primary",onClick:t[15]||(t[15]=(...e)=>ne.saveBrand&&ne.saveBrand(...e))},"保存")])])])],512)],64)}a(44114),a(81454);var ie=a(74300),ne=a(79539),ce=a(94578),de={name:"AdminProducts",data(){return{products:[],tags:[],brands:[],productForm:{name:"",price:0,stock:0,description:"",brand_id:"",tag_ids:[]},tagForm:{name:""},brandForm:{name:""},isEditing:!1,currentIndex:null,isEditingTag:!1,isEditingBrand:!1,currentPage:1,itemsPerPage:10,itemsPerPageOptions:[10,20,50],isSectionOpen:{products:!0,tags:!1,brands:!1}}},mounted(){this.loadProducts(),this.loadTags(),this.loadBrands()},computed:{paginatedProducts(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.products.slice(e,t)},totalPages(){return Math.ceil(this.products.length/this.itemsPerPage)}},methods:{toggleSection(e){this.isSectionOpen[e]=!this.isSectionOpen[e]},async loadProducts(){try{const e=await ie.A.productAPI.getAllProducts();console.log(e),this.products=e.map((e=>({...e,isDescriptionExanded:!1}))),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages||1)}catch(e){(0,ne.h)(e,"加載產品時出錯，請稍後再試！")}},async loadTags(){try{const e=await ie.A.tagAPI.getAllTags();this.tags=e}catch(e){(0,ne.h)(e,"加載標籤時錯誤，請稍候再試！")}},async loadBrands(){try{const e=await ie.A.brandAPI.getAllBrands();this.brands=e}catch(e){(0,ne.h)(e,"加載廠牌時出錯，請稍候再試！")}},async saveTag(){try{if(this.isEditingTag)await ie.A.tagAPI.updateTag(this.tagForm.id,this.tagForm),this.tags[this.currentIndex]={...this.tagForm};else{const e=await ie.A.tagAPI.createTag(this.tagForm);this.tags.push(e.data)}}catch(e){(0,ne.h)(e,"保存標籤時出錯，請稍候再試！")}this.closeTagModal()},async saveBrand(){try{if(this.isEditingBrand)await ie.A.brandAPI.updateBrand(this.brandForm.id,this.brandForm),this.brands[this.currentIndex]={...this.brandForm};else{const e=await ie.A.brandAPI.createBrand(this.brandForm);this.brands.push(e.data)}}catch(e){(0,ne.h)(e,"保存廠牌時出錯，請稍候再試！")}this.closeBrandModal()},async deleteProduct(e,t){if(confirm("確定要刪除此商品？"))try{await ie.A.productAPI.deleteProduct(e),this.products.splice(t,1)}catch(a){(0,ne.h)(a,"刪除產品時出錯，請稍後再試！")}},async deleteTag(e,t){if(confirm("確定要刪除此標籤？"))try{await ie.A.tagAPI.deleteTag(e),this.tags.splice(t,1)}catch(a){(0,ne.h)(a,"刪除標籤時出錯，請稍後再試！")}},async deleteBrand(e,t){if(confirm("確定要刪除此廠牌？"))try{await ie.A.brandAPI.deleteBrand(e),this.brands.splice(t,1)}catch(a){(0,ne.h)(a,"刪除廠牌時出錯，請稍後再試！")}},openCreateTagModal(){this.isEditingTag=!1,this.tagForm={name:""},this.$nextTick((()=>{const e=new ce.aF(this.$refs.tagModal);e.show()}))},openCreateBrandModal(){this.isEditingBrand=!1,this.brandForm={name:""},this.$nextTick((()=>{const e=new ce.aF(this.$refs.brandModal);e.show()}))},openEditTagModal(e){this.isEditingTag=!0,this.currentIndex=e,this.tagForm={...this.tags[e]};const t=new ce.aF(this.$refs.tagModal);t.show()},openEditBrandModal(e){this.isEditingBrand=!0,this.currentIndex=e,this.brandForm={...this.brands[e]};const t=new ce.aF(this.$refs.brandModal);t.show()},closeTagModal(){const e=ce.aF.getInstance(this.$refs.tagModal);e&&e.hide()},closeBrandModal(){const e=ce.aF.getInstance(this.$refs.brandModal);e&&e.hide()},toggleDescription(e){e.isDescriptionExpanded=!e.isDescriptionExpanded},toggleName(e){e.isNameExpanded=!e.isNameExpanded}},watch:{itemsPerPage(){this.currentPage=1}}},ue=a(71241);const pe=(0,ue.A)(de,[["render",le],["__scopeId","data-v-f2c81672"]]);var me=pe},42240:function(e,t,a){a.d(t,{A:function(){return se}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"admin-dashboard container py-4"},i={class:"page-header mb-4"},n={class:"d-flex justify-content-between align-items-center"},c={class:"card shadow-sm"},d={class:"table-responsive"},u={class:"table table-hover align-middle mb-0"},p={class:"d-flex align-items-center"},m={class:"user-avatar me-3"},h={class:"mb-0"},b={class:"text-muted"},k=["onClick"],g={key:1,class:"text-muted"},f={class:"text-end"},L={class:"btn-group"},v=["onClick"],y=["onClick"],w={key:0},C={colspan:"4",class:"bg-light"},F={class:"recipient-list p-3"},P={class:"recipient-info"},_={class:"mb-2"},I={class:"mb-1"},x={class:"mb-0"},A={class:"recipient-actions"},S=["onClick"],O=["onClick"],E={class:"modal fade",tabindex:"-1",ref:"userModal"},U={class:"modal-dialog"},T={class:"modal-content"},D={class:"modal-header border-0"},M={class:"modal-title"},N={class:"modal-body"},X={class:"mb-3"},$={class:"mb-3"},W={class:"mb-3"},V={class:"input-group"},q=["type","required"],B={class:"mb-3"},R=["required"],j={class:"mb-3"},J={key:0},K={class:"mb-3"},Q={class:"mb-3"},z={class:"modal-footer border-0"};function G(e,t,a,G,Z,H){return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",i,[(0,s.Lk)("div",n,[t[14]||(t[14]=(0,s.Lk)("div",null,[(0,s.Lk)("h2",{class:"fw-bold text-primary mb-1"},"用戶管理"),(0,s.Lk)("p",{class:"text-muted mb-0"},"管理系統用戶和權限")],-1)),(0,s.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>H.openCreateUserModal&&H.openCreateUserModal(...e))},t[13]||(t[13]=[(0,s.Lk)("i",{class:"fas fa-user-plus me-2"},null,-1),(0,s.eW)("新增用戶 ")]))])]),(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("table",u,[t[21]||(t[21]=(0,s.Lk)("thead",{class:"bg-light"},[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{class:"py-3"},"用戶資訊"),(0,s.Lk)("th",{class:"py-3"},"權限"),(0,s.Lk)("th",{class:"py-3"},"收件地址"),(0,s.Lk)("th",{class:"py-3 text-end"},"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.users,((a,o)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:o},[(0,s.Lk)("tr",null,[(0,s.Lk)("td",null,[(0,s.Lk)("div",p,[(0,s.Lk)("div",m,(0,r.v_)(H.getUserInitials(a.name)),1),(0,s.Lk)("div",null,[(0,s.Lk)("h6",h,(0,r.v_)(a.name),1),(0,s.Lk)("small",b,(0,r.v_)(a.email),1)])])]),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,r.C4)(H.getRoleBadgeClass(a.role))},(0,r.v_)(H.getRoleDisplayName(a.role)),3)]),(0,s.Lk)("td",null,[a.recipients&&a.recipients.length?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-link btn-sm text-decoration-none",onClick:e=>H.toggleRecipients(o)},[(0,s.eW)((0,r.v_)(a.recipients.length)+" 個地址 ",1),(0,s.Lk)("i",{class:(0,r.C4)(["fas",a.showRecipients?"fa-chevron-up":"fa-chevron-down","ms-1"])},null,2)],8,k)):((0,s.uX)(),(0,s.CE)("span",g,"無收件地址"))]),(0,s.Lk)("td",f,[(0,s.Lk)("div",L,[(0,s.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>H.openEditUserModal(o),title:"編輯用戶"},t[15]||(t[15]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,v),(0,s.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>H.deleteUser(o),title:"刪除用戶"},t[16]||(t[16]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,y)])])]),a.showRecipients&&a.recipients&&a.recipients.length?((0,s.uX)(),(0,s.CE)("tr",w,[(0,s.Lk)("td",C,[(0,s.Lk)("div",F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.recipients,((a,l)=>((0,s.uX)(),(0,s.CE)("div",{key:l,class:"recipient-item"},[(0,s.Lk)("div",P,[(0,s.Lk)("h6",_,(0,r.v_)(a.name),1),(0,s.Lk)("p",I,[t[17]||(t[17]=(0,s.Lk)("i",{class:"fas fa-phone me-2 text-muted"},null,-1)),(0,s.eW)(" "+(0,r.v_)(a.phone),1)]),(0,s.Lk)("p",x,[t[18]||(t[18]=(0,s.Lk)("i",{class:"fas fa-map-marker-alt me-2 text-muted"},null,-1)),(0,s.eW)(" "+(0,r.v_)(a.address),1)])]),(0,s.Lk)("div",A,[(0,s.Lk)("button",{class:"btn btn-outline-primary btn-sm me-2",onClick:t=>e.editRecipient(o,l)},t[19]||(t[19]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,S),(0,s.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>e.deleteRecipient(o,l)},t[20]||(t[20]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,O)])])))),128))])])])):(0,s.Q3)("",!0)],64)))),128))])])])]),(0,s.Lk)("div",E,[(0,s.Lk)("div",U,[(0,s.Lk)("div",T,[(0,s.Lk)("div",D,[(0,s.Lk)("h5",M,(0,r.v_)(Z.isEditing?"編輯用戶":"新增用戶"),1),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>H.closeModal&&H.closeModal(...e))})]),(0,s.Lk)("div",N,[(0,s.Lk)("form",{onSubmit:t[10]||(t[10]=(0,o.D$)(((...e)=>H.saveUser&&H.saveUser(...e)),["prevent"])),class:"needs-validation"},[(0,s.Lk)("div",X,[t[22]||(t[22]=(0,s.Lk)("label",{class:"form-label"},"用戶名稱",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>Z.userForm.name=e),required:""},null,512),[[o.Jo,Z.userForm.name]])]),(0,s.Lk)("div",$,[t[23]||(t[23]=(0,s.Lk)("label",{class:"form-label"},"電子郵件",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>Z.userForm.email=e),required:""},null,512),[[o.Jo,Z.userForm.email]])]),(0,s.Lk)("div",W,[t[24]||(t[24]=(0,s.Lk)("label",{class:"form-label"},"密碼",-1)),(0,s.Lk)("div",V,[(0,s.bo)((0,s.Lk)("input",{type:Z.showPassword?"text":"password",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>Z.userForm.password=e),required:!Z.isEditing},null,8,q),[[o.hp,Z.userForm.password]]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[5]||(t[5]=e=>Z.showPassword=!Z.showPassword)},[(0,s.Lk)("i",{class:(0,r.C4)(["fas",Z.showPassword?"fa-eye-slash":"fa-eye"])},null,2)])])]),(0,s.Lk)("div",B,[t[25]||(t[25]=(0,s.Lk)("label",{class:"form-label"},"確認密碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=e=>Z.userForm.confirmPassword=e),required:!Z.isEditing||Z.userForm.password},null,8,R),[[o.Jo,Z.userForm.confirmPassword]])]),(0,s.Lk)("div",j,[t[27]||(t[27]=(0,s.Lk)("label",{class:"form-label"},"用戶權限",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select","onUpdate:modelValue":t[7]||(t[7]=e=>Z.userForm.role=e)},t[26]||(t[26]=[(0,s.Lk)("option",{value:"user"},"一般用戶",-1),(0,s.Lk)("option",{value:"admin"},"管理員",-1)]),512),[[o.u1,Z.userForm.role]])]),"user"===Z.userForm.role?((0,s.uX)(),(0,s.CE)("div",J,[(0,s.Lk)("div",K,[t[28]||(t[28]=(0,s.Lk)("label",{class:"form-label"},"聯絡電話",-1)),(0,s.bo)((0,s.Lk)("input",{type:"tel",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=e=>Z.userForm.phone=e),required:""},null,512),[[o.Jo,Z.userForm.phone]])]),(0,s.Lk)("div",Q,[t[29]||(t[29]=(0,s.Lk)("label",{class:"form-label"},"聯絡地址",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=e=>Z.userForm.address=e),required:""},null,512),[[o.Jo,Z.userForm.address]])])])):(0,s.Q3)("",!0)],32)]),(0,s.Lk)("div",z,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[11]||(t[11]=(...e)=>H.closeModal&&H.closeModal(...e))},"取消"),(0,s.Lk)("button",{type:"submit",class:"btn btn-primary",onClick:t[12]||(t[12]=(...e)=>H.saveUser&&H.saveUser(...e))},(0,r.v_)(Z.isEditing?"保存變更":"新增用戶"),1)])])])],512)])}a(44114);var Z=a(94578),H=a(74300),Y=a(79539),ee={name:"AdminUsers",data(){return{users:[],userForm:{name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},isEditing:!1,currentIndex:null,showPassword:!1}},mounted(){this.loadUsers()},methods:{async loadUsers(){try{const e=await H.A.userAPI.getAllUsers();this.users=e.data}catch(e){(0,Y.h)(e,"無法加載用戶資料")}},openCreateUserModal(){this.isEditing=!1,this.userForm={name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},this.$nextTick((()=>{const e=new Z.aF(this.$refs.userModal);e.show()}))},openEditUserModal(e){this.isEditing=!0,this.currentIndex=e,this.userForm={...this.users[e]},this.userForm.password="",this.userForm.confirmPassword="";const t=new Z.aF(this.$refs.userModal);t.show()},async saveUser(){try{if(this.userForm.password!==this.userForm.confirmPassword)return void alert("密碼和確認密碼不一致");if(this.isEditing){const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address};this.userForm.password&&(e.password=this.userForm.password),await H.A.userAPI.updateUser(this.userForm.id,e),this.users[this.currentIndex]={...this.userForm}}else{const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address,password:this.userForm.password},t=await H.A.userAPI.createUsers(e);this.users.push(t.data)}this.closeModal()}catch(e){console.error("更新用戶資料時錯誤！",e),alert("更新用戶資料失敗！")}},async deleteUser(e){if(confirm("確定要刪除此用戶嗎？"))try{await H.A.userAPI.deleteUsers(this.users[e].id),this.users.splice(e,1)}catch(t){alert("無法刪除用戶")}},closeModal(){this.$nextTick((()=>{const e=Z.aF.getInstance(this.$refs.userModal);e&&e.hide()}))},getUserInitials(e){return e?e.substring(0,2).toUpperCase():"??"},getRoleBadgeClass(e){return"admin"===e?"badge bg-primary":"badge bg-success"},getRoleDisplayName(e){return"admin"===e?"管理員":"一般用戶"},toggleRecipients(e){this.$set(this.users[e],"showRecipients",!this.users[e].showRecipients)}}},te=a(71241);const ae=(0,te.A)(ee,[["render",G],["__scopeId","data-v-c4ddb490"]]);var se=ae},51839:function(e,t,a){a.d(t,{A:function(){return I}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"carousel-management container mt-5"},i={class:"image-grid mb-4"},n={class:"image-wrapper"},c=["src"],d={class:"image-overlay"},u={class:"action-buttons"},p=["onClick"],m=["onClick"],h={class:"image-status mt-2"},b={class:"upload-section p-4 bg-light rounded-3"},k={key:0,class:"preview-section mt-4"},g={class:"preview-container"},f=["src"],L={class:"preview-actions mt-3"};function v(e,t,a,v,y,w){return(0,s.uX)(),(0,s.CE)("div",l,[t[14]||(t[14]=(0,s.Lk)("div",{class:"dashboard-header mb-4"},[(0,s.Lk)("h2",{class:"text-primary fw-bold"},"輪播圖片管理"),(0,s.Lk)("p",{class:"text-muted"},"管理網站首頁輪播圖片的顯示與排序")],-1)),(0,s.Lk)("div",i,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.carouselImages,(a=>((0,s.uX)(),(0,s.CE)("div",{key:a.id,class:"image-card"},[(0,s.Lk)("div",n,[(0,s.Lk)("img",{src:w.getImageUrl(a.url,"carousel"),onLoad:t[0]||(t[0]=t=>w.onImgLoad(e.index)),onError:t[1]||(t[1]=t=>w.onImgError(e.index)),class:"carousel-image",alt:"輪播圖片"},null,40,c),(0,s.Lk)("div",d,[(0,s.Lk)("div",u,[(0,s.Lk)("button",{class:(0,r.C4)(["btn btn-light btn-sm me-2",{active:a.visible}]),onClick:e=>w.toggleImageVisibility(a)},[(0,s.Lk)("i",{class:(0,r.C4)(a.visible?"fas fa-eye":"fas fa-eye-slash")},null,2),(0,s.eW)(" "+(0,r.v_)(a.visible?"隱藏":"顯示"),1)],10,p),(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:e=>w.deleteCarouselImage(a.id)},t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-trash-alt me-1"},null,-1),(0,s.eW)(" 刪除 ")]),8,m)])])]),(0,s.Lk)("div",h,[(0,s.Lk)("span",{class:(0,r.C4)(["status-badge",a.visible?"status-active":"status-inactive"])},(0,r.v_)(a.visible?"顯示中":"已隱藏"),3)])])))),128))]),(0,s.Lk)("div",b,[t[13]||(t[13]=(0,s.Lk)("h4",{class:"mb-3"},[(0,s.Lk)("i",{class:"fas fa-cloud-upload-alt me-2"}),(0,s.eW)(" 上傳新圖片 ")],-1)),(0,s.Lk)("div",{class:(0,r.C4)(["upload-area",{dragging:y.isDragging}]),onDragover:t[4]||(t[4]=(0,o.D$)((()=>{}),["prevent"])),onDrop:t[5]||(t[5]=(0,o.D$)(((...e)=>w.handleFileDrop&&w.handleFileDrop(...e)),["prevent"]))},[(0,s.Lk)("input",{type:"file",onChange:t[2]||(t[2]=(...e)=>w.handleFileSelect&&w.handleFileSelect(...e)),accept:"image/*",ref:"fileInput",class:"d-none"},null,544),(0,s.Lk)("div",{class:"upload-placeholder",onClick:t[3]||(t[3]=t=>e.$refs.fileInput.click())},t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-plus-circle fs-2 mb-2"},null,-1),(0,s.Lk)("p",{class:"mb-1"},"點擊或拖曳圖片至此處上傳",-1),(0,s.Lk)("small",{class:"text-muted"},"支援 JPG、PNG、GIF 格式，檔案大小不超過 5MB",-1)]))],34),y.previewUrl?((0,s.uX)(),(0,s.CE)("div",k,[t[12]||(t[12]=(0,s.Lk)("h5",{class:"mb-3"},"預覽圖片",-1)),(0,s.Lk)("div",g,[(0,s.Lk)("img",{src:y.previewUrl,alt:"預覽圖片",class:"preview-image"},null,8,f),(0,s.Lk)("div",L,[(0,s.Lk)("button",{class:"btn btn-primary me-2",onClick:t[6]||(t[6]=(...e)=>w.confirmUpload&&w.confirmUpload(...e))},t[10]||(t[10]=[(0,s.Lk)("i",{class:"fas fa-check me-1"},null,-1),(0,s.eW)("確認上傳 ")])),(0,s.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>w.cancelUpload&&w.cancelUpload(...e))},t[11]||(t[11]=[(0,s.Lk)("i",{class:"fas fa-times me-1"},null,-1),(0,s.eW)("取消 ")]))])])])):(0,s.Q3)("",!0)]),y.showToast?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,r.C4)(["toast-notification",`toast-${y.toastType}`])},(0,r.v_)(y.toastMessage),3)):(0,s.Q3)("",!0)])}a(44114),a(98992),a(54520),a(3949),a(14603),a(47566),a(98721);var y=a(74300),w=a(79539),C=a(55019),F={name:"AdminCarouselImages",data(){return{carouselImages:[],selectedFile:null,previewUrl:"",isDragging:!1,showToast:!1,toastMessage:"",toastType:"success"}},async mounted(){await this.loadCarouselImages()},methods:{async loadCarouselImages(){try{const e=await y.A.carouselAPI.getCarouselImages();this.carouselImages=e,console.log("後端回傳的輪播資料:",this.carouselImages),this.carouselImages.forEach(((e,t)=>{console.log(`[carouselImages] index=${t}, url=`,e.url)}))}catch(e){(0,w.h)(e,"加載輪播圖片失敗")}},handleFileSelect(e){const t=e.target.files[0];if(t){const e=["image/jpeg","image/png","image/gif"],a=5242880;if(!e.includes(t.type))return void alert("僅支援JPEG, PNG, GIF 格式的圖片！");if(t.size>a)return void alert("圖片超出5MB的上限！");this.selectedFile=t,this.previewUrl=URL.createObjectURL(t)}},async confirmUpload(){if(!this.selectedFile)return void alert("沒有選擇任何文件！");const e=new FormData;e.append("image",this.selectedFile);try{const t=await y.A.carouselAPI.uploadCarouselImages(e);this.carouselImages.push(t),alert("圖片上傳成功"),this.resetUpload()}catch(t){(0,w.h)(t,"圖片上傳失敗")}},cancelUpload(){this.resetUpload()},resetUpload(){this.selectedFile=null,this.previewUrl="",this.$refs.fileInput.value=""},async deleteCarouselImage(e){if(confirm("確定要刪除這張圖片嗎？"))try{await y.A.carouselAPI.deleteCarouselImage(e),this.carouselImages=this.carouselImages.filter((t=>t.id!==e)),alert("圖片已刪除。")}catch(t){(0,w.h)(t,"圖片刪除失敗")}},async toggleImageVisibility(e){const t=!e.visible;try{const a=await y.A.carouselAPI.updateCarouselImage(e.id,{visible:t});e.visible=a.visible,alert(`圖片已${t?"顯示":"隱藏"}。`)}catch(a){(0,w.h)(a,"更新圖片狀態失敗")}},getImageUrl(e,t){const a=(0,C.A)(e,t);return console.log(`[getImageUrl] url=${e}, type=${t}, finalUrl=${a}`),a},onImgLoad(e){console.log(`image #${e} 載入成功！`)},onImgError(e){console.error(`image #${e} 載入失敗！`)},handleFileDrop(e){this.isDragging=!1;const t=e.dataTransfer.files[0];t&&this.handleFile(t)},showNotification(e,t="success"){this.toastMessage=e,this.toastType=t,this.showToast=!0,setTimeout((()=>{this.showToast=!1}),3e3)}}},P=a(71241);const _=(0,P.A)(F,[["render",v],["__scopeId","data-v-0e5e5756"]]);var I=_},89801:function(e,t,a){a.d(t,{A:function(){return _}});var s=a(56768),r=a(45130);const o={class:"container mt-5"},l={class:"mb-3"},i={class:"mb-3"},n={class:"mb-3"},c={class:"mb-3"},d={class:"mb-3"},u={key:0,class:"text-danger"},p={class:"mb-3"},m={key:0,class:"text-danger"},h={class:"mb-3"},b={key:0},k=["src"];function g(e,t,a,g,f,L){const v=(0,s.g2)("Multiselect");return(0,s.uX)(),(0,s.CE)("div",o,[t[17]||(t[17]=(0,s.Lk)("h2",{class:"text-center mb-4"},"新增商品",-1)),(0,s.Lk)("form",{onSubmit:t[7]||(t[7]=(0,r.D$)(((...e)=>g.createProduct&&g.createProduct(...e)),["prevent"]))},[(0,s.Lk)("div",l,[t[8]||(t[8]=(0,s.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>g.productForm.name=e),class:"form-control",required:""},null,512),[[r.Jo,g.productForm.name]])]),(0,s.Lk)("div",i,[t[9]||(t[9]=(0,s.Lk)("label",{for:"description",class:"form-label"},"商品描述",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>g.productForm.description=e),class:"form-control",required:""},null,512),[[r.Jo,g.productForm.description]])]),(0,s.Lk)("div",n,[t[10]||(t[10]=(0,s.Lk)("label",{for:"price",class:"form-label"},"價格",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>g.productForm.price=e),class:"form-control",required:""},null,512),[[r.Jo,g.productForm.price]])]),(0,s.Lk)("div",c,[t[11]||(t[11]=(0,s.Lk)("label",{for:"stock",class:"form-label"},"庫存",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>g.productForm.stock=e),class:"form-control",required:""},null,512),[[r.Jo,g.productForm.stock]])]),(0,s.Lk)("div",d,[t[12]||(t[12]=(0,s.Lk)("label",{for:"brand_id",class:"form-label"},"選擇品牌",-1)),(0,s.bF)(v,{modelValue:g.productForm.brand_id,"onUpdate:modelValue":t[4]||(t[4]=e=>g.productForm.brand_id=e),options:g.brands,searchable:!0,taggable:!0,label:"name",key:"id",valueProp:"id",placeholder:"搜尋或選擇品牌",onSelect:g.handleBrandSelect,onTag:g.createNewBrand},null,8,["modelValue","options","onSelect","onTag"]),!g.productForm.brand_id&&g.formSubmitted?((0,s.uX)(),(0,s.CE)("span",u,"請選擇品牌")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",p,[t[13]||(t[13]=(0,s.Lk)("label",{for:"tag_ids",class:"form-label"},"選擇標籤",-1)),(0,s.bF)(v,{modelValue:g.productForm.tag_ids,"onUpdate:modelValue":t[5]||(t[5]=e=>g.productForm.tag_ids=e),options:g.tags,searchable:!0,taggable:!0,label:"name",multiple:!0,key:"id",valueProp:"id",placeholder:"搜尋或選擇標籤",onSelect:g.handleTagSelect,onTag:g.createNewTag},null,8,["modelValue","options","onSelect","onTag"]),!g.productForm.tag_ids?.length&&g.formSubmitted?((0,s.uX)(),(0,s.CE)("span",m,"請選擇至少一個標籤")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",h,[t[14]||(t[14]=(0,s.Lk)("label",{for:"productImage",class:"form-label"},"圖片上傳",-1)),(0,s.Lk)("input",{type:"file",class:"form-control",id:"productImage",onChange:t[6]||(t[6]=(...e)=>g.selectImage&&g.selectImage(...e)),accept:"image/*"},null,32)]),g.productForm.imagePreview?((0,s.uX)(),(0,s.CE)("div",b,[t[15]||(t[15]=(0,s.Lk)("h5",null,"圖片預覽",-1)),(0,s.Lk)("img",{src:g.productForm.imagePreview,alt:"商品圖片",style:{"max-width":"200px"}},null,8,k)])):(0,s.Q3)("",!0),t[16]||(t[16]=(0,s.Lk)("button",{type:"submit",class:"btn btn-primary"},"新增商品",-1))],32)])}a(44114),a(98992),a(54520),a(81454),a(14603),a(47566),a(98721);var f=a(90144),L=a(81387),v=a(74300),y=a(79539),w=a(68074),C={name:"CreateProduct",components:{Multiselect:w.Ay},setup(){const e=(0,L.rd)(),t=(0,f.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],created_at:(new Date).toISOString().split("T")[0],imageFile:null,imagePreview:""}),a=()=>t.name.trim()?t.description.trim()?t.price<=0?(alert("價格必填且需大於 0"),!1):t.stock<=0?(alert("庫存必填且需大於 0"),!1):t.brand_id?!!t.tag_ids.length||(alert("請選擇至少一個標籤"),!1):(alert("請選擇品牌"),!1):(alert("商品描述必填"),!1):(alert("商品名稱必填"),!1),r=(0,f.KR)([]),o=(0,f.KR)([]),l=(0,f.KR)(!1),i=async()=>{try{const e=await v.A.brandAPI.getAllBrands();r.value=Array.isArray(e.data)?e.data:[],console.log("加載的品牌資料:",r.value)}catch(e){(0,y.h)(e,"讀取品牌資料時出錯，請稍後再試！")}},n=async()=>{try{const e=await v.A.tagAPI.getAllTags();o.value=Array.isArray(e.data)?e.data:[],console.log("加載的標籤資料:",o.value)}catch(e){(0,y.h)(e,"讀取標籤資料時出錯，請稍後再試！")}},c=e=>{t.brand_id=e,console.log("選擇的品牌:",e)},d=e=>{Array.isArray(e)?t.tag_ids=e:t.tag_ids=[e].filter(Boolean),console.log("選擇的標籤",e)},u=async e=>{try{const a=await v.A.brandAPI.createBrand(e),s=a.data;r.value.push(s),t.brand_id=s.id,alert("新品牌已添加")}catch(a){(0,y.h)(a,"創建新品牌時出錯，請稍後再試！")}},p=async e=>{try{const a=await v.A.tagAPI.createTag(e),s=a.data;o.value.push(s),t.tag_ids.push(s.id),alert("新標籤已增加")}catch(a){(0,y.h)(a,"創建新標籤時出錯，請稍後再試！")}};(0,s.sV)((()=>{i(),n()}));const m=async()=>{if(l.value=!0,a())if(t.brand_id&&t.tag_ids&&0!==t.tag_ids.length)try{const a=new FormData;let s=[];Array.isArray(t.tag_ids)&&(s=t.tag_ids.map((e=>"object"===typeof e?e.id:e))),a.append("name",t.name),a.append("description",t.description),a.append("price",String(t.price)),a.append("stock",String(t.stock)),a.append("brand_id","object"===typeof t.brand_id?t.brand_id.id:t.brand_id),a.append("tag_ids",JSON.stringify(s)),a.append("created_at",t.created_at),t.imageFile&&a.append("image",t.imageFile);const r=await v.A.productAPI.createProduct(a);console.log("伺服器回應：",r.data),alert("商品新增成功"),e.push("/admin/products")}catch(s){(0,y.h)(s,"新增商品時出錯，請稍後再試！")}finally{l.value=!1}else alert("請選擇品牌和至少一個標籤")},h=e=>{const a=e.target.files[0];if(a&&!a.type.startsWith("image/"))return alert("請上傳正確的圖片格式"),void(e.target.value="");t.imageFile=a,t.imagePreview=URL.createObjectURL(a)};return{productForm:t,brands:r,tags:o,formSubmitted:l,createProduct:m,selectImage:h,handleBrandSelect:c,handleTagSelect:d,validateForm:a,createNewBrand:u,createNewTag:p}}},F=a(71241);const P=(0,F.A)(C,[["render",g],["__scopeId","data-v-7a4cf5ca"]]);var _=P},7811:function(e,t,a){a.d(t,{A:function(){return M}});var s=a(56768),r=a(45130),o=a(24232);const l={class:"container mt-5"},i={key:0,class:"text-center my-5"},n={key:0,class:"text-center mb-4"},c=["src"],d={class:"mb-3"},u={class:"mb-3"},p={class:"input-group"},m=["readonly"],h={class:"mb-3"},b={class:"input-group"},k=["readonly"],g={class:"mb-3"},f={class:"input-group"},L=["readonly"],v={class:"mb-3"},y={class:"input-group"},w=["readonly"],C={class:"mb-3"},F={class:"input-group"},P={class:"mb-3"},_={class:"input-group"},I={class:"custom-tag"},x=["onClick"];function A(e,t,a,A,S,O){const E=(0,s.g2)("Multiselect");return(0,s.uX)(),(0,s.CE)("div",l,[t[23]||(t[23]=(0,s.Lk)("h2",{class:"text-center"},"編輯產品資訊",-1)),A.isLoading?((0,s.uX)(),(0,s.CE)("div",i,t[14]||(t[14]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"載入中...")],-1)]))):(0,s.Q3)("",!0),A.isLoading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("form",{key:1,onSubmit:t[13]||(t[13]=(0,r.D$)(((...e)=>A.updateProduct&&A.updateProduct(...e)),["prevent"]))},[A.productForm.imagePreview?((0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("img",{src:A.productForm.imagePreview,alt:"Product Image",class:"product-image"},null,8,c)])):(0,s.Q3)("",!0),(0,s.Lk)("div",d,[t[15]||(t[15]=(0,s.Lk)("label",{for:"productImage",class:"form-label"},"產品圖片",-1)),(0,s.Lk)("input",{type:"file",id:"productImage",class:"form-control",onChange:t[0]||(t[0]=(...e)=>A.selectImage&&A.selectImage(...e))},null,32)]),(0,s.Lk)("div",u,[t[16]||(t[16]=(0,s.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,s.Lk)("div",p,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"productName",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>A.productForm.name=e),readonly:!A.editableFields.name,required:""},null,8,m),[[r.Jo,A.productForm.name]]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=e=>A.toggleEdit("name"))},(0,o.v_)(A.editableFields.name?"完成":"修改"),1)])]),(0,s.Lk)("div",h,[t[17]||(t[17]=(0,s.Lk)("label",{for:"productPrice",class:"form-label"},"價格",-1)),(0,s.Lk)("div",b,[(0,s.bo)((0,s.Lk)("input",{type:"number",id:"productPrice",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>A.productForm.price=e),readonly:!A.editableFields.price,required:""},null,8,k),[[r.Jo,A.productForm.price]]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=e=>A.toggleEdit("price"))},(0,o.v_)(A.editableFields.price?"完成":"修改"),1)])]),(0,s.Lk)("div",g,[t[18]||(t[18]=(0,s.Lk)("label",{for:"productStock",class:"form-label"},"庫存",-1)),(0,s.Lk)("div",f,[(0,s.bo)((0,s.Lk)("input",{type:"number",id:"productStock",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>A.productForm.stock=e),readonly:!A.editableFields.stock,required:""},null,8,L),[[r.Jo,A.productForm.stock]]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[6]||(t[6]=e=>A.toggleEdit("stock"))},(0,o.v_)(A.editableFields.stock?"完成":"修改"),1)])]),(0,s.Lk)("div",v,[t[19]||(t[19]=(0,s.Lk)("label",{for:"productDescription",class:"form-label"},"描述",-1)),(0,s.Lk)("div",y,[(0,s.bo)((0,s.Lk)("textarea",{type:"number",id:"productDescription",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=e=>A.productForm.description=e),readonly:!A.editableFields.description,required:""},null,8,w),[[r.Jo,A.productForm.description]]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[8]||(t[8]=e=>A.toggleEdit("description"))},(0,o.v_)(A.editableFields.description?"完成":"修改"),1)])]),(0,s.Lk)("div",C,[t[20]||(t[20]=(0,s.Lk)("label",{for:"productBrand",class:"form-label"},"廠牌",-1)),(0,s.Lk)("div",F,[(0,s.bF)(E,{modelValue:A.productForm.brand_id,"onUpdate:modelValue":t[9]||(t[9]=e=>A.productForm.brand_id=e),options:A.brands,searchable:!0,label:"name","value-prop":"id",placeholder:"請選擇廠牌",disabled:!A.editableFields.brand_id,required:""},null,8,["modelValue","options","disabled"]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[10]||(t[10]=e=>A.toggleEdit("brand_id"))},(0,o.v_)(A.editableFields.brand_id?"完成":"修改"),1)])]),(0,s.Lk)("div",P,[t[21]||(t[21]=(0,s.Lk)("label",{for:"productTags",class:"form-label"},"標籤",-1)),(0,s.Lk)("div",_,[(0,s.bF)(E,{modelValue:A.productForm.tag_ids,"onUpdate:modelValue":t[11]||(t[11]=e=>A.productForm.tag_ids=e),options:A.tags,label:"name","value-prop":"id",placeholder:"請選擇標籤",disabled:!A.editableFields.tag_ids,required:"",multiple:""},{tag:(0,s.k6)((({option:e,remove:t})=>[(0,s.Lk)("span",I,[(0,s.eW)((0,o.v_)(e.name)+" ",1),(0,s.Lk)("button",{type:"button",onClick:a=>t(e)}," X ",8,x)])])),_:1},8,["modelValue","options","disabled"]),(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=e=>A.toggleEdit("tag_ids"))},(0,o.v_)(A.editableFields.tag_ids?"完成":"修改"),1)])]),t[22]||(t[22]=(0,s.Lk)("button",{type:"submit",class:"btn btn-primary"},"更新產品",-1))],32))])}a(44114),a(81454),a(14603),a(47566),a(98721);var S=a(90144),O=a(81387),E=(a(74300),a(54014)),U={name:"EditProduct",components:{Multiselect:E.A},setup(){const e=(0,O.rd)(),t=(0,O.lq)(),a=t.params.id,r=(0,S.KR)(!0),o=(0,S.Kh)({name:!1,price:!1,stock:!1,description:!1,brand_id:!1,tag_ids:!1}),l=e=>{o[e]=!o[e]},i=(0,S.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],imageFile:null,imagePreview:""}),n=(0,S.KR)([]),c=(0,S.KR)([]),d=async()=>{try{r.value=!0;const[e,t,s]=await Promise.all([axios.get(`/api/products/${a}`),axios.get("/api/brands"),axios.get("/api/tags")]);n.value=t.data,c.value=s.data;const o=e.data;i.name=o.name,i.description=o.description,i.price=o.price,i.stock=o.stock,i.imagePreview=o.image?`/${o.image}`:"",o.brand_id&&(i.brand_id=Number(o.brand_id)),o.tag_ids&&Array.isArray(o.tag_ids)&&(i.tag_ids=o.tag_ids.map((e=>Number(e)))),console.log("成功讀取資料！",{product:o,selectedBrand:i.brand_id,selectedTags:i.tag_ids})}catch(e){console.error("加載商品訊息時出錯",e),alert("加載商品訊息時出錯，請稍後再試！")}finally{r.value=!1}},u=async()=>{try{if(!i.name)return void alert("請填寫商品名稱");if(!i.description)return void alert("請填寫商品描述");if(!i.price||isNaN(i.price))return void alert("請填寫有效的商品價格");if(!i.stock||isNaN(i.stock))return void alert("請填寫有效的商品庫存");if(!i.brand_id||isNaN(i.brand_id))return void alert("請選擇一個有效的廠牌");const t=new FormData;t.append("name",i.name),t.append("description",i.description),t.append("price",i.price),t.append("stock",i.stock),t.append("brand_id",i.brand_id),t.append("tag_ids",JSON.stringify(i.tag_ids)),i.imageFile&&t.append("image",i.imageFile),await axios.put(`/api/products/${a}`,t,{headers:{"Content-Type":"multipart/form-data"}}),alert("更新商品成功！"),e.push({name:"AdminProducts"})}catch(t){console.error("更新商品時出錯:",t),alert("更新商品時出錯，請稍後再試！")}},p=e=>{const t=e.target.files[0];t&&(i.imageFile=t,i.imagePreview=URL.createObjectURL(t))};return(0,s.sV)((async()=>{await d()})),{productForm:i,brands:n,tags:c,isLoading:r,editableFields:o,toggleEdit:l,updateProduct:u,selectImage:p}}},T=a(71241);const D=(0,T.A)(U,[["render",A]]);var M=D},62019:function(e,t,a){a.d(t,{A:function(){return f}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"order-detail container mt-5"},i={key:0},n={class:"order-info mb-4"},c={class:"mb-3"},d={class:"table table-bordered"},u={key:1};function p(e,t,a,p,m,h){return(0,s.uX)(),(0,s.CE)("div",l,[t[13]||(t[13]=(0,s.Lk)("h2",{class:"text-center"},"訂單詳情",-1)),m.order?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",n,[(0,s.Lk)("p",null,[t[3]||(t[3]=(0,s.Lk)("strong",null,"訂單號：",-1)),(0,s.eW)((0,r.v_)(m.order.id),1)]),(0,s.Lk)("p",null,[t[4]||(t[4]=(0,s.Lk)("strong",null,"會員編號：",-1)),(0,s.eW)((0,r.v_)(m.order.user_id),1)]),(0,s.Lk)("p",null,[t[5]||(t[5]=(0,s.Lk)("strong",null,"用戶名：",-1)),(0,s.eW)((0,r.v_)(m.userName),1)]),(0,s.Lk)("p",null,[t[6]||(t[6]=(0,s.Lk)("strong",null,"建立日期：",-1)),(0,s.eW)((0,r.v_)(h.formatDate(m.order.orderDate)),1)]),(0,s.Lk)("p",null,[t[7]||(t[7]=(0,s.Lk)("strong",null,"總金額：",-1)),(0,s.eW)((0,r.v_)(h.formatCurrency(m.order.total)),1)]),(0,s.Lk)("div",c,[t[9]||(t[9]=(0,s.Lk)("label",{for:"orderStatus",class:"form-label"},[(0,s.Lk)("strong",null,"訂單狀態：")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"orderStatus","onUpdate:modelValue":t[0]||(t[0]=e=>m.order.status=e),class:"form-select",onChange:t[1]||(t[1]=(...e)=>h.updateOrderStatus&&h.updateOrderStatus(...e))},t[8]||(t[8]=[(0,s.Lk)("option",{value:"pending"},"待確認",-1),(0,s.Lk)("option",{value:"shipped"},"已發貨",-1),(0,s.Lk)("option",{value:"completed"},"已完成",-1),(0,s.Lk)("option",{value:"cancelled"},"已取消",-1)]),544),[[o.u1,m.order.status]])])]),t[11]||(t[11]=(0,s.Lk)("h4",null,"商品列表",-1)),(0,s.Lk)("table",d,[t[10]||(t[10]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"商品名稱"),(0,s.Lk)("th",null,"數量"),(0,s.Lk)("th",null,"單價"),(0,s.Lk)("th",null,"小計")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.order.items,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.productId},[(0,s.Lk)("td",null,(0,r.v_)(e.product_name),1),(0,s.Lk)("td",null,(0,r.v_)(e.quantity),1),(0,s.Lk)("td",null,(0,r.v_)(h.formatCurrency(e.price)),1),(0,s.Lk)("td",null,(0,r.v_)(h.formatCurrency(e.price*e.quantity)),1)])))),128))])]),(0,s.Lk)("button",{class:"btn btn-secondary mt-3",onClick:t[2]||(t[2]=(...e)=>h.goBack&&h.goBack(...e))},"返回")])):((0,s.uX)(),(0,s.CE)("div",u,t[12]||(t[12]=[(0,s.Lk)("p",null,"正在加載訂單詳情...",-1)])))])}var m=a(74300),h=a(4249),b={name:"OrderDetail",props:["id"],data(){return{order:null,userName:"",store:(0,h.Pj)()}},methods:{async fetchOrderDetails(e){try{const t=await m.A.orderAPI.getOrderById(e);this.order=t||t.data,this.fetchUserName(this.order.user_id)}catch(t){console.error("加載訂單詳情時出錯",t),alert("加載訂單詳情時出錯，請稍候再試！"),this.order=null}},async fetchUserName(e){try{const t=await m.A.userAPI.getUserInfo(e),a=t.data||t;this.userName=a.name||"未知用戶"}catch(t){console.error("加載用戶資訊時出錯",t),this.userName="未知用戶"}},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},async updateOrderStatus(){if(this.order)try{await m.A.orderAPI.updateOrderStatus(this.order.id,this.order.status),store.dispatch("notification/showNotification",{message:"訂單狀態已更新",type:"success",timeout:3e3}),alert("訂單狀態已更新")}catch(e){console.error("更新訂單狀態時出錯",e),store.dispatch("notifications/showNotification",{type:"error",message:"更新訂單狀態時出錯，請稍後再試！",timeout:2e3})}},goBack(){this.$router.go(-1)}},mounted(){const e=this.id||this.$route.params.id;this.fetchOrderDetails(e)}},k=a(71241);const g=(0,k.A)(b,[["render",p],["__scopeId","data-v-36c506e4"]]);var f=g},39812:function(e,t,a){a.d(t,{A:function(){return X}});var s=a(56768),r=a(24232),o=a(45130);const l={class:"special-offers-dashboard container mt-5"},i={class:"d-flex justify-content-end mb-3"},n={class:"accordion",id:"specialOffersAccordion"},c={class:"accordion-item"},d={id:"collapseSpecialOffers",class:"accordion-collapse collapse show","aria-labelledby":"headingSpecialOffers","data-bs-parent":"#specialOffersAccordion"},u={class:"accordion-body"},p={class:"table"},m=["onClick"],h=["onClick"],b={class:"modal fade",tabindex:"-1",ref:"specialOfferModal"},k={class:"modal-dialog"},g={class:"modal-content"},f={class:"modal-header"},L={class:"modal-title"},v={class:"modal-body"},y={class:"mb-3"},w={key:0,class:"list-group mt-2"},C=["onClick"],F={key:1,class:"mt-2"},P={class:"mb-3"},_={class:"mb-3"},I={class:"mb-3"},x={class:"modal-footer"};function A(e,t,a,A,S,O){return(0,s.uX)(),(0,s.CE)("div",l,[t[17]||(t[17]=(0,s.Lk)("h2",{class:"text-center"},"特價商品管理",-1)),(0,s.Lk)("div",i,[(0,s.Lk)("button",{class:"btn btn-success",onClick:t[0]||(t[0]=(...e)=>O.openCreateSpecialOfferModal&&O.openCreateSpecialOfferModal(...e))},"新增特價商品")]),(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[t[11]||(t[11]=(0,s.Lk)("h2",{class:"accordion-header",id:"headingSpecialOffers"},[(0,s.Lk)("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseSpecialOffers","aria-expanded":"true","aria-controls":"collapseSpecialOffers"}," 特價商品管理 ")],-1)),(0,s.Lk)("div",d,[(0,s.Lk)("div",u,[(0,s.Lk)("table",p,[t[10]||(t[10]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"商品名稱"),(0,s.Lk)("th",null,"特價價格"),(0,s.Lk)("th",null,"倒數時間 (秒)"),(0,s.Lk)("th",null,"創建日期"),(0,s.Lk)("th",null,"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.specialOffers,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:e?.id},[(0,s.Lk)("td",null,(0,r.v_)(O.getProductName(e.product_id)),1),(0,s.Lk)("td",null,(0,r.v_)(e.price),1),(0,s.Lk)("td",null,(0,r.v_)(e.countdown),1),(0,s.Lk)("td",null,(0,r.v_)(O.formatDate(e.created_at)),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-warning btn-sm me-2",onClick:e=>O.openEditSpecialOfferModal(t)},"編輯",8,m),(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:a=>O.deleteSpecialOffer(e.id,t)},"刪除",8,h)])])))),128))])])])])])]),(0,s.Lk)("div",b,[(0,s.Lk)("div",k,[(0,s.Lk)("div",g,[(0,s.Lk)("div",f,[(0,s.Lk)("h5",L,(0,r.v_)(S.isEditing?"編輯特價商品":"新增特價商品"),1),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>O.closeSpecialOfferModal&&O.closeSpecialOfferModal(...e))})]),(0,s.Lk)("div",v,[(0,s.Lk)("div",y,[t[13]||(t[13]=(0,s.Lk)("label",{for:"productSelect",class:"form-label"},"搜尋商品名稱",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"productSearch",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>S.productSearchKeyword=e),onInput:t[3]||(t[3]=(...t)=>e.debouncedSearchProducts&&e.debouncedSearchProducts(...t)),required:""},null,544),[[o.Jo,S.productSearchKeyword]]),S.searchResults&&S.searchResults.length>0?((0,s.uX)(),(0,s.CE)("ul",w,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.searchResults,(e=>((0,s.uX)(),(0,s.CE)("li",{class:"list-group-item list-group-item-action",key:e.id,onClick:t=>O.selectProduct(e)},(0,r.v_)(e.name),9,C)))),128))])):(0,s.Q3)("",!0),S.selectedProduct?((0,s.uX)(),(0,s.CE)("div",F,[t[12]||(t[12]=(0,s.Lk)("strong",null,"已選擇商品：",-1)),(0,s.eW)((0,r.v_)(S.selectedProduct.name)+" ",1),(0,s.Lk)("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-2",onClick:t[4]||(t[4]=(...e)=>O.clearSelectedProduct&&O.clearSelectedProduct(...e))},"移除")])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",P,[t[14]||(t[14]=(0,s.Lk)("label",{for:"priceInput",class:"form-label"},"特價價格",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",id:"priceInput","onUpdate:modelValue":t[5]||(t[5]=e=>S.specialOfferForm.price=e),class:"form-control",placeholder:"請輸入特價價格",required:""},null,512),[[o.Jo,S.specialOfferForm.price]])]),(0,s.Lk)("div",_,[t[15]||(t[15]=(0,s.Lk)("label",{for:"countdownInput",class:"form-label"},"倒數時間 (秒)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",id:"countdownInput","onUpdate:modelValue":t[6]||(t[6]=e=>S.specialOfferForm.countdown=e),class:"form-control",placeholder:"請輸入倒數時間",required:""},null,512),[[o.Jo,S.specialOfferForm.countdown]])]),(0,s.Lk)("div",I,[t[16]||(t[16]=(0,s.Lk)("label",{for:"createdAtInput",class:"form-label"},"創建日期",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",id:"createdAtInput","onUpdate:modelValue":t[7]||(t[7]=e=>S.specialOfferForm.created_at=e),class:"form-control",required:""},null,512),[[o.Jo,S.specialOfferForm.created_at]])])]),(0,s.Lk)("div",x,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=(...e)=>O.closeSpecialOfferModal&&O.closeSpecialOfferModal(...e))},"取消"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>O.saveSpecialOffer&&O.saveSpecialOffer(...e))},(0,r.v_)(S.isEditing?"保存變更":"新增特價商品"),1)])])])],512)])}a(44114),a(98992),a(3949);var S=a(74300),O=a(79539),E=a(94578),U=a(12952),T=a.n(U),D={name:"SpecialOffers",data(){return{specialOffers:[],products:[],productMap:{},specialOfferForm:{id:null,product_id:"",price:0,countdown:0,created_at:""},isEditing:!1,currentIndex:null,productSearchKeyword:"",searchResults:[],selectedProduct:null}},mounted(){this.loadSpecialOffers(),this.loadProducts(),this.debouncedSearchProducts=T()(this.searchProducts,500)},methods:{async loadSpecialOffers(){try{const e=await S.A.specialOffersAPI.getAllSpecialOffers();console.log("loadSpecialOffers response:",e),this.specialOffers=e}catch(e){(0,O.h)(e,"加載特價商品時出錯，請稍後再試！")}},async searchProducts(){const e=this.productSearchKeyword.trim();if(e)try{const t=await S.A.productAPI.searchProducts({keyword:e,page:1,limit:10});this.searchResults=t}catch(t){(0,O.h)(t,"搜尋商品時出錯，請稍後再試！")}else this.searchResults=[]},selectProduct(e){this.selectedProduct=e,this.specialOfferForm.product_id=e.id,this.searchResults=[],this.productSearchKeyword=""},clearSelectedProduct(){this.selectedProduct=null,this.specialOfferForm.product_id=""},async loadProducts(){try{const e=await S.A.productAPI.getAllProducts();this.products=e,this.productMap={},e.forEach((e=>{this.productMap[e.id]=e.name}))}catch(e){(0,O.h)(e,"加載商品時出錯，請稍後再試！")}},formatDate(e){const t=new Date(e);return t.toLocaleDateString()},openCreateSpecialOfferModal(){this.isEditing=!1,this.specialOfferForm={id:null,product_id:"",price:0,countdown:0,created_at:""},this.selectedProduct=null,this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new E.aF(this.$refs.specialOfferModal);e.show()}))},async openEditSpecialOfferModal(e){this.isEditing=!0,this.currentIndex=e;const t={...this.specialOffers[e]};this.specialOfferForm=t;try{const e=await S.A.specialOffersAPI.getSpecialOfferById(t.id);this.selectedProduct=e}catch(a){(0,O.h)(a,"取得商品資訊時出錯，請稍後再試！")}this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new E.aF(this.$refs.specialOfferModal);e.show()}))},getProductName(e){return this.productMap[e]||"未知商品"},closeSpecialOfferModal(){const e=E.aF.getInstance(this.$refs.specialOfferModal);e&&e.hide()},async saveSpecialOffer(){if(this.specialOfferForm.product_id&&this.specialOfferForm.price&&this.specialOfferForm.countdown&&this.specialOfferForm.created_at)try{if(this.isEditing){const e=await S.A.specialOffersAPI.updateSpecialOfferById(this.specialOfferForm.id,this.specialOfferForm);this.$set(this.specialOffers,this.currentIndex,e),alert("特價商品已更新！")}else{const e=await S.A.specialOffersAPI.createSpecialOffer(this.specialOfferForm);this.specialOffers.push(e),alert("特價商品已新增！")}this.closeSpecialOfferModal()}catch(e){(0,O.h)(e,"保存特價商品時出錯，請稍後再試！")}else alert("請填寫所有必填欄位！")},async deleteSpecialOffer(e,t){if(confirm("確定要刪除此特價商品？"))try{await S.A.specialOffersAPI.deleteSpecialOffer(e),this.specialOffers.splice(t,1),alert("特價商品已刪除！")}catch(a){(0,O.h)(a,"刪除特價商品時出錯，請稍後再試！")}}}},M=a(71241);const N=(0,M.A)(D,[["render",A],["__scopeId","data-v-78d172d3"]]);var X=N}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,r,o){if(!s){var l=1/0;for(d=0;d<e.length;d++){s=e[d][0],r=e[d][1],o=e[d][2];for(var i=!0,n=0;n<s.length;n++)(!1&o||l>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[n])}))?s.splice(n--,1):(i=!1,o<l&&(l=o));if(i){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,r,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={259:0,475:0,54:0,765:0,562:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,o,l=s[0],i=s[1],n=s[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(n)var d=n(a)}for(t&&t(s);c<l.length;c++)o=l[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self["webpackChunkeshop_site"]=self["webpackChunkeshop_site"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[547,475,60,54,62,810,261,716,308,765,868,842,363,453,882,225,325,322,623,799,670,229,386,531,634,485,949,110,501,636,823,787,610,489,282,562,834],(function(){return a(17541)}));s=a.O(s)})();