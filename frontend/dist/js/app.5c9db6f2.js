(function(){"use strict";var e={3906:function(e,t,a){var s=a(5130),r=a(6768);const o={id:"app"},n={class:"main-content"};function i(e,t,a,s,i,l){const c=(0,r.g2)("NotificationComponent"),d=(0,r.g2)("MainHeader"),u=(0,r.g2)("router-view"),p=(0,r.g2)("MainFooter");return(0,r.uX)(),(0,r.CE)(r.FK,null,[t[0]||(t[0]=(0,r.Lk)("div",{class:"marquee"},[(0,r.Lk)("span",null,"2024.09.01，注意！本公司不會主動通知帳務問題，若有相關疑問請洽客服！小心詐騙！")],-1)),(0,r.Lk)("div",o,[(0,r.bF)(c),(0,r.bF)(d),(0,r.Lk)("div",n,[(0,r.bF)(u)]),(0,r.bF)(p)])],64)}var l=a(4232);const c={class:"header-container"},d={class:"headerbar d-flex align-items-center"},u={key:0,class:"nav-toggle-wrapper d-flex align-items-center ms-2"},p={class:"nav-content d-flex w-100 align-items-center justify-content-between"},m=["to"],h={class:"search-container d-flex mx-lg-3"},g={class:"search-input-wrapper"},b={class:"cartmember d-flex"},k={key:0,class:"cart-item"},v={class:"text-link"};function f(e,t,a,o,n,i){const f=(0,r.g2)("BNavbarToggle"),L=(0,r.g2)("router-link"),y=(0,r.g2)("BNavbarNav"),w=(0,r.g2)("BFormInput"),C=(0,r.g2)("BButton"),_=(0,r.g2)("BCollapse"),I=(0,r.g2)("BContainer"),F=(0,r.g2)("BNavbar");return(0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(F,{toggleable:"lg",type:"light",variant:"light",class:"navbar-overlay px-0"},{default:(0,r.k6)((()=>[(0,r.bF)(I,{fluid:""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",d,[(0,r.bF)(f,{onClick:i.toggleNav},null,8,["onClick"]),n.isNavOpen?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("img",{src:"img/arrowleft.png",alt:"導航提示",class:"nav-toggle-image",onClick:t[0]||(t[0]=(...e)=>i.toggleNav&&i.toggleNav(...e))}),t[4]||(t[4]=(0,r.Lk)("span",{class:"nav-toggle-text ms-1"},"請點選此處開啟導航欄",-1))]))]),(0,r.bF)(_,{id:"nav-collapse",modelValue:n.isNavOpen,"onUpdate:modelValue":t[3]||(t[3]=e=>n.isNavOpen=e),"is-nav":""},{default:(0,r.k6)((()=>[(0,r.Lk)("div",p,[(0,r.bF)(y,{class:"nav-links me-lg-3"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.navItems,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.path,to:e.path,class:"nav-item-container"},[(0,r.bF)(L,{to:e.path,class:"nav-link-text",onClick:i.closeNav},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(e.text),1)])),_:2},1032,["to","onClick"])],8,m)))),128))])),_:1}),(0,r.Lk)("div",h,[(0,r.Lk)("div",g,[(0,r.bF)(w,{type:"text",modelValue:n.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>n.searchQuery=e),class:"search-box",placeholder:"請輸入想找的商品搜尋",onKeyup:(0,s.jR)(i.handleSearch,["enter"])},null,8,["modelValue","onKeyup"]),(0,r.bF)(C,{class:"search-button btn btn-primary ms-2",onClick:i.handleSearch},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("搜尋")]))),_:1},8,["onClick"])])]),(0,r.Lk)("div",b,[(0,r.bF)(L,{class:"cart-item me-3",to:"/ShopCart",onClick:i.closeNav},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.Lk)("img",{src:"/img/shopping_cart.png",alt:"購物車",class:"icon-img"},null,-1),(0,r.Lk)("span",{class:"text-link"},"購物車",-1)]))),_:1},8,["onClick"]),i.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",k,[(0,r.Lk)("span",v,"歡迎 "+(0,l.v_)(i.userName),1),(0,r.Lk)("button",{class:"btn btn-link",onClick:t[2]||(t[2]=(...e)=>i.logout&&i.logout(...e))},"會員登出")])):((0,r.uX)(),(0,r.Wv)(L,{key:1,class:"cart-item",to:"/UserLogin",onClick:i.closeNav},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.Lk)("img",{src:"/img/member_login.png",alt:"會員登入",class:"icon-img"},null,-1),(0,r.Lk)("span",{class:"text-link"},"會員登入",-1)]))),_:1},8,["onClick"]))])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])}a(4114);var L={name:"MainHeader",data(){return{searchQuery:"",isNavOpen:window.innerWidth<992,navItems:[{path:"/",text:"首頁"},{path:"/MembersPage",text:"會員中心"},{path:"/ProductsList",text:"產品列表"},{path:"/AboutUsPage",text:"關於我們"},{path:"/ContactUs",text:"聯絡我們"},{path:"/admin",text:"後台"}]}},computed:{isLoggedIn(){return this.$store.state.auth.isLoggedIn},userName(){return this.$store.state.auth.user?this.$store.state.auth.user.name:""}},methods:{handleSearch(){""!==this.searchQuery.trim()&&(this.$router.push({path:"/ProductsList",query:{search:this.searchQuery.trim()}}),this.closeNav())},toggleNav(){this.isNavOpen=!this.isNavOpen},closeNav(){window.innerWidth<992&&(this.isNavOpen=!1)},checkScreenSize(){window.innerWidth>=992?this.isNavOpen=!0:this.isNavOpen=!1},handleResize(){this.checkScreenSize()},logout(){this.$store.dispatch("auth/logout"),this.$router.push({path:"/"})}},mounted(){this.checkScreenSize(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},watch:{$route(){this.closeNav()}}},y=a(1241);const w=(0,y.A)(L,[["render",f],["__scopeId","data-v-67589a17"]]);var C=w;const _={class:"footer d-flex flex-column"};function I(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)("div",_,t[0]||(t[0]=[(0,r.Lk)("div",{class:"flex-grow-1"},[(0,r.Lk)("p",null,[(0,r.eW)("台灣ECshop.com有限公司"),(0,r.Lk)("br"),(0,r.eW)(" 統編 99999999"),(0,r.Lk)("br"),(0,r.eW)(" Copyright 2024, ECSHOP Group.")])],-1)]))}var F={name:"MainFooter"};const E=(0,y.A)(F,[["render",I],["__scopeId","data-v-499e5536"]]);var P=E;const S={class:"notifications-container"},O=["onClick"],A={class:"message"},x=["onClick"];function T(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",S,[(0,r.bF)(s.F,{name:"notification"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.notifications,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,l.C4)(["notification",`notification-${e.type}`]),onClick:t=>o.closeNotification(e.id)},[(0,r.Lk)("span",A,(0,l.v_)(e.message),1),(0,r.Lk)("button",{class:"close-btn",onClick:(0,s.D$)((t=>o.closeNotification(e.id)),["stop"])},"×",8,x)],10,O)))),128))])),_:1})])}var U=a(782),D={name:"NotificationComponent",setup(){const e=(0,U.Pj)(),t=(0,r.EW)((()=>e.state.notifications.notifications)),a=t=>{e.dispatch("notifications/removeNotification",t)};return{notifications:t,closeNotification:a}}};const M=(0,y.A)(D,[["render",T],["__scopeId","data-v-c8dde580"]]);var R=M,N={name:"App",components:{MainHeader:C,MainFooter:P,NotificationComponent:R},setup(){const e=(0,U.Pj)(),t=(0,r.EW)((()=>e.getters["auth/isLoggedIn"]));return{isLoggedIn:t}}};const X=(0,y.A)(N,[["render",i],["__scopeId","data-v-2873ea48"]]);var $=X,q=a(9804),V=(a(4188),a(323),a(8077)),W=a(8047),K=(a(8992),a(7550),a(1387));const B={class:"homepage container mt-5"},Q={class:"carousel-section"},j={key:0,id:"mainCarousel",class:"carousel slide"},J={key:1,class:"alert alert-warning"},z={key:2,id:"carouselExampleIndicators",class:"carousel slide position-relative","data-bs-ride":"carousel"},H={class:"carousel-indicators"},G=["data-bs-slide-to","aria-current","aria-label"],Z={class:"carousel-inner"},Y=["src","alt"],ee={key:0,class:"sales-ranking mt-5"},te={class:"product-list"},ae=["src"],se={key:0},re={key:1,class:"sales-ranking mt-5"},oe={class:"product-list"},ne=["src"],ie={key:2,class:"sales-ranking mt-5"},le={class:"product-list"},ce=["src"],de={key:3,class:"countdown-special-offers mt-4"},ue={class:"product-list"},pe=["src"],me={class:"countdown-timer"};function he(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",B,[(0,r.Lk)("div",Q,[o.isLoading.carousel?((0,r.uX)(),(0,r.CE)("div",j,t[0]||(t[0]=[(0,r.Lk)("div",{class:"spinner-border",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"加載中...")],-1)]))):o.errors.carousel?((0,r.uX)(),(0,r.CE)("div",J,(0,l.v_)(o.errors.carousel),1)):o.carouselImages&&o.carouselImages.length?((0,r.uX)(),(0,r.CE)("div",z,[(0,r.Lk)("div",H,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.carouselImages,((e,t)=>((0,r.uX)(),(0,r.CE)("button",{key:"indicator-"+t,type:"button","data-bs-target":"#carouselExampleIndicators","data-bs-slide-to":t,class:(0,l.C4)({active:0===t}),"aria-current":0===t,"aria-label":"Slide"+(t+1)},null,10,G)))),128))]),(0,r.Lk)("div",Z,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.carouselImages,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:(0,l.C4)(["carousel-item",{active:0===t}])},[(0,r.Lk)("img",{src:n.getImageUrl(e.url),class:"d-block w-100",alt:"圖片"+(t+1)},null,8,Y)],2)))),128))]),t[1]||(t[1]=(0,r.Fv)('<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev" data-v-059667ce><span class="carousel-control-prev-icon" aria-hidden="true" data-v-059667ce></span><span class="visually-hidden" data-v-059667ce>Previous</span></button><button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next" data-v-059667ce><span class="carousel-control-next-icon" aria-hidden="true" data-v-059667ce></span><span class="visually-hidden" data-v-059667ce>Next</span></button>',2))])):(0,r.Q3)("",!0)])]),o.randomProducts&&o.randomProducts.length>0?((0,r.uX)(),(0,r.CE)("div",ee,[t[2]||(t[2]=(0,r.Lk)("h2",null,"為您推薦",-1)),(0,r.Lk)("div",te,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.randomProducts,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"product-item"},[(0,r.Lk)("img",{src:n.getProductImage(e.product_id),class:"product-thumbnail"},null,8,ae),(0,r.Lk)("div",null,(0,l.v_)(t+1)+"."+(0,l.v_)(e.name),1),"-"===e.quantity_sold?((0,r.uX)(),(0,r.CE)("div",se,"熱門推薦")):(0,r.Q3)("",!0)])))),128))])])):(0,r.Q3)("",!0),o.sevenDaySalesRanking&&o.sevenDaySalesRanking.length>0?((0,r.uX)(),(0,r.CE)("div",re,[t[3]||(t[3]=(0,r.Lk)("h2",null,"過去7日銷售排行",-1)),(0,r.Lk)("div",oe,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.sevenDaySalesRanking,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"product-item"},[(0,r.Lk)("img",{src:n.getProductImage(e.product_id),class:"product-thumbnail"},null,8,ne),(0,r.Lk)("div",null,(0,l.v_)(t+1)+"."+(0,l.v_)(e.name),1),(0,r.Lk)("div",null,"賣出 "+(0,l.v_)(e.quantity_sold)+"件",1)])))),128))])])):(0,r.Q3)("",!0),o.monthSalesRanking&&o.monthSalesRanking.length>0?((0,r.uX)(),(0,r.CE)("div",ie,[t[4]||(t[4]=(0,r.Lk)("h2",null,"過去30日銷售排行",-1)),(0,r.Lk)("div",le,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.monthSalesRanking,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"product-item"},[(0,r.Lk)("img",{src:n.getProductImage(e.product_id),class:"product-thumbnail"},null,8,ce),(0,r.Lk)("div",null,(0,l.v_)(t+1)+"."+(0,l.v_)(e.name),1),(0,r.Lk)("div",null,"賣出"+(0,l.v_)(e.quantity_sold)+"件",1)])))),128))])])):(0,r.Q3)("",!0),n.processedSpecialOffers.length>0?((0,r.uX)(),(0,r.CE)("div",de,[t[5]||(t[5]=(0,r.Lk)("h2",null,"特價倒數計時商品",-1)),(0,r.Lk)("div",ue,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.processedSpecialOffers,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"product-item"},[(0,r.Lk)("img",{src:n.getProductImage(e.product_id),class:"product-thumbnail"},null,8,pe),(0,r.Lk)("div",null,(0,l.v_)(e.name),1),(0,r.Lk)("div",null,"特價 "+(0,l.v_)(e.price)+"元",1),(0,r.Lk)("div",me," 倒數"+(0,l.v_)(n.formatTime(e.countdown)),1)])))),128))])])):(0,r.Q3)("",!0)],64)}a(2577),a(3949),a(1454);var ge=a(4373);const be={carouselImages:[{url:"/static/img/welcome.jpg"},{url:"/static/img/welcome.jpg"}]};var ke={name:"HomePage",beforeUnmount(){this.clearCountdownIntervals()},data(){return{isPageLoading:!0,sevenDaySalesRanking:[],monthSalesRanking:[],specialOffers:[],carouselImages:be.carouselImages,products:[],countdownIntervals:[],isLoading:{sales:!1,offers:!1,carousel:!1,products:!1},errors:{sales:null,offers:null,carousel:null,products:null},randomProducts:[]}},async mounted(){try{await this.loadHomePageData(),this.randomProducts=this.getRandomProducts(),this.$nextTick((()=>{this.startCountdown(),this.initializeCarousel()}))}catch(e){console.error("Failed to load home page data",e)}},methods:{handleError(e,t){console.error(`Error in ${e}:`,t.message||t),this.errors[e]=`無法加載 ${e} 數據，請稍後再試。`,"carousel"===e&&(this.carouselImages=be.carouselImages)},async loadHomePageData(){try{await this.loadProductsData(),await Promise.allSettled([this.loadSalesData(),this.loadOffersData(),this.loadCarouselData()])}catch(e){console.error("讀取主頁資料失敗",e)}},async loadSalesData(){this.isLoading.sales=!0;try{const[e,t]=await Promise.all([ge.A.get("/api/sales/ranking",{params:{days:7}}),ge.A.get("/api/sales/ranking",{params:{days:30}})]),a=e.data||[],s=t.data||[];this.sevenDaySalesRanking=this.processSalesRanking(a),console.log("Processed Seven Day Sales Ranking:",this.sevenDaySalesRanking),this.monthSalesRanking=this.processSalesRanking(s),console.log("Processed Month Sales Ranking:",this.monthSalesRanking)}catch(e){console.error("加載銷售數據失敗",e),this.errors.sales="無法加載銷售排行數據",this.sevenDaySalesRanking=[],this.monthSalesRanking=[]}finally{this.isLoading.sales=!1}},processSalesRanking(e){return e.map((e=>{const t=Number(e.product_id),a=this.products.find((e=>e.id===t));return{product_id:t,name:a?a.name:`Product ID: ${t}`,quantity_sold:e.quantity_sold,image:a&&a.image?`api${a.image}`:"/img/default-product.jpg"}})).slice(0,10)},async loadOffersData(){this.isLoading.offers=!0;try{const e=await ge.A.get("/api/special-offers");this.specialOffers=e.data||[]}catch(e){console.error("加載特價商品失敗",e),this.errors.offers="無法加載特價商品數據",this.specialOffers=[]}finally{this.isLoading.offers=!1}},async loadCarouselData(){this.isLoading.carousel=!0;try{const e=await ge.A.get("/api/carousel_images");this.carouselImages=e.data||[],console.log("Loaded carousel images:",this.carouselImages)}catch(e){console.error("加載輪播圖片失敗",e),this.errors.carousel="無法加載輪播圖片",this.carouselImages=be.carouselImages}finally{this.isLoading.carousel=!1}},async loadProductsData(){this.isLoading.products=!0;try{const e=await ge.A.get("/api/products");this.products=e.data||[]}catch(e){console.error("加載商品數據失敗",e),this.errors.products="無法加載商品列表",this.products=[]}finally{this.isLoading.products=!1}},convertToSortedRankingWithProducts(e){return Object.entries(e).map((([e,t])=>{const a=Number(e),s=this.products.find((e=>e.id===a));return{product_id:e,quantity_sold:t,name:s?s.name:"未知商品",image:s?s.image:"/img/default-product.jpg"}})).sort(((e,t)=>t.quantity_sold-e.quantity_sold)).slice(0,5)},startCountdown(){this.clearCountdownIntervals(),this.specialOffers&&0!==this.specialOffers.length&&this.specialOffers.forEach(((e,t)=>{if(!e.countdown)return;const a=setInterval((()=>{e.countdown>0?this.$set(this.specialOffers,t,{...e,countdown:e.countdown-1}):clearInterval(a)}),1e3);this.countdownIntervals.push(a)}))},clearCountdownIntervals(){this.countdownIntervals.forEach((e=>clearInterval(e))),this.countdownIntervals=[]},formatTime(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return`${t}時${a}分${s}秒`},getImageUrl(e){return`api${e}`},getProductImage(e){const t=Number(e),a=this.products.find((e=>e.id===t));return a&&a.image?`api${a.image}`:"/img/default-product.jpg"},getRandomProducts(e=5){const t=[...this.products];for(let a=t.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[t[a],t[e]]=[t[e],t[a]]}return t.slice(0,e).map((e=>({product_id:e.id,name:e.name,image:this.getProductImage(e.id),quantity_sold:"-"})))},initializeCarousel(){const e=document.getElementById("carouselExampleIndicators");e&&new V.FN(e,{interval:5e3,ride:!0})}},computed:{processedSpecialOffers(){return this.specialOffers&&this.products?this.specialOffers.map((e=>{const t=this.products.find((t=>t.id===e.product_id));return{...e,name:t?t.name:"未知商品"}})):[]}}};const ve=(0,y.A)(ke,[["render",he],["__scopeId","data-v-059667ce"]]);var fe=ve;function Le(e,t,a,s,o,n){return t[0]||(t[0]=(0,r.Fv)('<h1 style="color:coral;" data-v-b5050256>關於我們</h1><br data-v-b5050256><br data-v-b5050256><div data-v-b5050256><div class="title" data-v-b5050256>公司願景</div><div class="content" data-v-b5050256> ECSHOP 電商平台致力於打造一個以消費者需求為核心的全球購物平台，通過先進的技術、優質的產品及卓越的服務，提供每一位顧客最便捷、愉快的購物體驗。 我們相信，透過創新和精確的市場洞察，能為消費者和合作夥伴創造更多的價值，並推動電商產業的進步。 我們的願景是成為全球消費者心目中的首選購物平台，無論是日常所需還是高端商品，ECSHOP 都能夠滿足不同客戶的需求，並且實現跨境無縫銷售的全球電商體驗。 </div><div class="title" data-v-b5050256>未來展望</div><div class="content" data-v-b5050256> ECSHOP 將持續不斷地創造優質的產品和優秀的服務，並持續推動消費者需求的解決方案，讓消費者能更輕鬆地在全球購物。 我們也將不斷地學習和進步，以提供給消&quot;&gt;未來，ECSHOP 將持續拓展產品品類，並加強與世界各地的品牌商及供應商的合作，為消費者提供更豐富的選擇。同時，我們將致力於智能化技術的應用，利用大數據分析、人工智慧和物聯網等前沿技術，提升用戶體驗，優化物流配送效率，並實現個性化推薦和精準行銷。 我們也將積極推動環保和可持續發展，通過綠色物流、減少包裝浪費等措施，承擔企業社會責任，為地球的未來做出貢獻。 展望未來，ECSHOP 將不斷創新，推動整個行業的數位化轉型，並且努力實現「消費者、合作夥伴與企業共贏」的目標。我們期待與您攜手，共創電商新時代的輝煌！</div></div>',4))}var ye={name:"AboutUsPage"};const we=(0,y.A)(ye,[["render",Le],["__scopeId","data-v-b5050256"]]);var Ce=we;const _e={class:"cart-container container mt-5"},Ie={key:0,class:"text-center"},Fe={class:"table table-hover"},Ee=["src"],Pe=["onUpdate:modelValue","onInput"],Se=["onClick"],Oe={class:"d-flex justify-content-between align-items-center mt-4"},Ae=["disabled"];function xe(e,t,a,o,n,i){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",_e,[t[5]||(t[5]=(0,r.Lk)("h2",{class:"text-center mb-4"},"我的購物車",-1)),0===o.cartItems.length?((0,r.uX)(),(0,r.CE)("div",Ie,[t[3]||(t[3]=(0,r.Lk)("p",null,"購物車是空的。",-1)),(0,r.bF)(c,{to:"/",class:"btn btn-primary"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("去購物")]))),_:1})])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("table",Fe,[t[4]||(t[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{scope:"col"},"商品圖片"),(0,r.Lk)("th",{scope:"col"},"商品名稱"),(0,r.Lk)("th",{scope:"col"},"單價"),(0,r.Lk)("th",{scope:"col"},"數量"),(0,r.Lk)("th",{scope:"col"},"小計"),(0,r.Lk)("th",{scope:"col"},"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.cartItems,((e,a)=>((0,r.uX)(),(0,r.CE)("tr",{key:`${e.id}-${a}`},[(0,r.Lk)("td",null,[(0,r.Lk)("img",{src:e.image,alt:"item.name",class:"product-image",onError:t[0]||(t[0]=(...e)=>o.imageError&&o.imageError(...e))},null,40,Ee)]),(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,(0,l.v_)(e.price)+"元",1),(0,r.Lk)("td",null,[(0,r.bo)((0,r.Lk)("input",{type:"number",class:"form-control quantity-input","onUpdate:modelValue":t=>e.quantity=t,onInput:t=>o.updateQuantity(a,e.quantity),min:"1"},null,40,Pe),[[s.Jo,e.quantity,void 0,{number:!0}]])]),(0,r.Lk)("td",null,(0,l.v_)(e.quantity*e.price)+"元",1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-danger",onClick:e=>o.removeItem(a)},"刪除",8,Se)])])))),128))])]),(0,r.Lk)("div",Oe,[(0,r.Lk)("h4",null,"總計："+(0,l.v_)(o.cartTotal)+"元",1),(0,r.Lk)("button",{class:"btn btn-success",disabled:0===o.cartItems.length,onClick:t[1]||(t[1]=(...e)=>o.checkout&&o.checkout(...e))},"結帳",8,Ae)])],64))])}var Te={name:"ShopCart",setup(){const e=(0,U.Pj)(),t=(0,K.rd)(),a=(0,r.EW)((()=>e.state.cart.items)),s=(0,r.EW)((()=>e.getters["cart/cartTotal"])),o=(0,r.EW)((()=>e.state.auth&&e.state.auth.isLoggedIn)),n=(t,a)=>{(!Number.isInteger(a)||a<1)&&(a=1),e.dispatch("cart/updateItemQuantity",{index:t,quantity:a})},i=e=>{e.target.src="/img/wrong.png"},l=t=>{e.dispatch("cart/removeItemFromCart",t)},c=async()=>{if(!o.value)return void t.push({name:"UserLogin",query:{redirect:"/cart"}});if(0===a.value.length)return void e.dispatch("notifications/showNotification",{type:"warning",message:"購物車是空的，無法結帳！",timeout:2e3});const r={user_id:e.state.auth.user.id,items:a.value.map((e=>({product_id:e.id,quantity:e.quantity,price:e.price}))),total:s.value},n=e=>{if(!Array.isArray(e.items)||0===e.items.length)throw new Error("訂單商品數據不正確");if("number"!==typeof e.total||e.total<=0)throw new Error("訂單總計金額不正確");if(!e.user_id)throw new Error("用戶未登入或用戶ID缺失")};try{n(r),console.log("送出的訂單數據:",r);const a=await ge.A.post("/api/orders",r);a.data&&a.data.orderId&&(e.dispatch("cart/clearShoppingCart"),e.dispatch("notifications/showNotification",{type:"success",message:"訂單已成功提交！",timeout:2e3}),t.push({name:"OrderConfirmation",params:{orderId:a.data.orderId}}))}catch(i){console.error("提交訂單數據檢查失敗:",i),e.dispatch("notifications/showNotification",{type:"error",message:"提交訂單失敗，請稍後再試！"})}};return{cartItems:a,cartTotal:s,updateQuantity:n,removeItem:l,checkout:c,imageError:i}}};const Ue=(0,y.A)(Te,[["render",xe],["__scopeId","data-v-acacbd22"]]);var De=Ue;const Me={class:"container mt-5"},Re={key:0},Ne={class:"row"},Xe={class:"tag-filter mb-4"},$e=["onClick"],qe={class:"search-bar mb-4"},Ve={class:"col-md-3"},We=["max"],Ke={class:"container mt-5"},Be={class:"row"};function Qe(e,t,a,o,n,i){const c=(0,r.g2)("ProductCard");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",Me,[t[6]||(t[6]=(0,r.Lk)("h2",{class:"mb-4"},"商品列表",-1)),0===o.filteredProducts.length?((0,r.uX)(),(0,r.CE)("div",Re,t[2]||(t[2]=[(0,r.Lk)("p",null,"暫無符合條件的商品，請修改查詢條件！",-1)]))):(0,r.Q3)("",!0),(0,r.Lk)("div",Ne,[(0,r.Lk)("div",Xe,[t[3]||(t[3]=(0,r.Lk)("h4",null,"選擇標籤",-1)),(0,r.Lk)("div",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.availableTags,(e=>((0,r.uX)(),(0,r.CE)("button",{key:e,onClick:t=>o.toggleTag(e),class:(0,l.C4)([{btn:!0,"btn-primary":o.selectedTags.includes(e),"btn-outline-primary":!o.selectedTags.includes(e)},"me-2 mb-2"])},(0,l.v_)(e),11,$e)))),128))])]),(0,r.Lk)("div",qe,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.searchQuery=e),class:"form-control",placeholder:"搜尋產品..."},null,512),[[s.Jo,o.searchQuery]])]),(0,r.Lk)("div",Ve,[t[5]||(t[5]=(0,r.Lk)("h4",null,"篩選條件",-1)),(0,r.Lk)("div",null,[t[4]||(t[4]=(0,r.Lk)("label",null,"價格區間",-1)),(0,r.bo)((0,r.Lk)("input",{type:"range","onUpdate:modelValue":t[1]||(t[1]=e=>o.priceRange=e),min:"0",max:o.maxPrice,step:"500"},null,8,We),[[s.Jo,o.priceRange]]),(0,r.Lk)("p",null,"價格："+(0,l.v_)(o.priceRange)+"元",1)])])])]),(0,r.Lk)("div",Ke,[(0,r.Lk)("div",Be,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.filteredProducts,(e=>((0,r.uX)(),(0,r.CE)("div",{class:"col-md-3 mb-4",key:e.id},[(0,r.bF)(c,{product:e,onAddToCart:o.addToCart},null,8,["product","onAddToCart"])])))),128))])])],64)}a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(4520);var je=a(144);const Je={class:"product-card"},ze=["src"],He={class:"card-title"},Ge={class:"card-text"},Ze=["disabled"];function Ye(e,t,a,s,o,n){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Je,[(0,r.bF)(i,{to:{name:"ProductDetail",params:{id:s.productId}}},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:s.productImageUrl,class:"product-image",alt:"Product Image",onError:t[0]||(t[0]=(...e)=>s.imageError&&s.imageError(...e))},null,40,ze),(0,r.Lk)("h5",He,(0,l.v_)(a.product.name),1),(0,r.Lk)("p",Ge,(0,l.v_)(parseInt(a.product.price))+" 元",1)])),_:1},8,["to"]),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>s.handleAddToCart&&s.handleAddToCart(...e)),disabled:s.isAdding},(0,l.v_)(s.isAdding?"添加中...":"加入購物車"),9,Ze)])}var et={name:"ProductCard",props:{product:{type:Object,required:!0,validator:function(e){return e.id&&e.name&&e.price&&e.image}}},setup(e,{emit:t}){const a=(0,je.KR)(!1),s=(0,r.EW)((()=>String(e.product.id).trim())),o=(0,r.EW)((()=>`/api/${e.product.image}`)),n=(0,r.EW)((()=>{const t=parseFloat(e.product.price);return isNaN(t)?"0 元":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)})),i=()=>{a.value||(a.value=!0,t("add-to-cart",e.product),setTimeout((()=>{a.value=!1}),1e3))},l=e=>{e.target.src="/img/wrong.png"};return{isAdding:a,productId:s,productImageUrl:o,formattedPrice:n,handleAddToCart:i,imageError:l}}};const tt=(0,y.A)(et,[["render",Ye],["__scopeId","data-v-1ec3a29f"]]);var at=tt,st={name:"ProductsList",components:{ProductCard:at},setup(){const e=(0,je.KR)([]),t=(0,je.KR)(!1),a=(0,je.KR)(null),s=(0,r.EW)((()=>{if(!Array.isArray(e.value))return 1e6;const t=e.value.map((e=>Number(e.price)));return t.length?Math.max(...t):1e6})),o=(0,je.KR)(s.value),n=(0,je.KR)([]),i=(0,je.KR)([]),l=(0,U.Pj)(),c=(0,K.rd)(),d=(0,K.lq)(),u=(0,r.EW)((()=>l.state.auth.isLoggedIn)),p=(0,je.KR)(""),m=(0,r.EW)((()=>Array.isArray(e.value)?e.value.filter((e=>{const t=Number(e.price),a=e.name.toLowerCase().includes(p.value.toLowerCase()),s=t<=o.value,r=e.tags||[],n=0===i.value.length||i.value.some((e=>r.includes(e)));return a&&s&&n})):[])),h=async()=>{t.value=!0,a.value=null;try{const t=await ge.A.get("/api/products");if(!Array.isArray(t.data))throw new Error("API 返回的數據格式不正確，預期為陣列");console.log("商品數據:",t.data),e.value=Array.isArray(t.data)?t.data.map((e=>({...e,id:String(e.id).trim()}))):[],0===e.value.length&&console.warn("商品數據為空或格式錯誤"),console.log("處理後的商品數據:",e.value),o.value=s.value;const a=new Set;e.value.forEach((e=>{e.tags&&Array.isArray(e.tags)&&e.tags.forEach((e=>a.add(e)))})),n.value=Array.from(a)}catch(r){console.error("加載商品時出錯",r),a.value="加載產品時出錯，請稍後再試！"}finally{t.value=!1}},g=e=>{i.value.includes(e)?i.value=i.value.filter((t=>t!==e)):i.value.push(e)},b=e=>{if(u.value)l.dispatch("cart/addProductToCart",e),l.dispatch("notifications/showNotification",{type:"success",message:`已將 ${e.name} 加入購物車`,timeout:2e3});else{l.dispatch("notifications/showNotification",{type:"warning",message:"請先登入會員再加入購物車！",timeout:2e3});const e=d.fullPath;c.push({name:"UserLogin",query:{redirect:e}})}};return(0,r.sV)((()=>{p.value=d.query.search||"",h().then((()=>{console.log("加載後的商品列表:",e.value)}))})),(0,r.wB)((()=>d.query.search),(e=>{p.value=e||""})),{products:e,maxPrice:s,priceRange:o,loading:t,error:a,isLoggedIn:u,filteredProducts:m,availableTags:n,selectedTags:i,searchQuery:p,toggleTag:g,addToCart:b}}};const rt=(0,y.A)(st,[["render",Qe],["__scopeId","data-v-33490d87"]]);var ot=rt;const nt={class:"container mt-5"},it={key:0,class:"product-detail"},lt={class:"row"},ct={class:"col-md-6"},dt={class:"image-container"},ut=["src"],pt={class:"col-md-6"},mt={class:"product-name"},ht={class:"product-description"},gt={class:"product-price"},bt={class:"d-flex mt-4"},kt={key:1,class:"loading"};function vt(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)("div",nt,[s.product&&s.product.id?((0,r.uX)(),(0,r.CE)("div",it,[(0,r.Lk)("div",lt,[(0,r.Lk)("div",ct,[(0,r.Lk)("div",dt,[(0,r.Lk)("img",{src:s.productImageUrl,alt:"Product Image",class:"product-image"},null,8,ut)])]),(0,r.Lk)("div",pt,[(0,r.Lk)("h2",mt,(0,l.v_)(s.product.name),1),(0,r.Lk)("p",ht,(0,l.v_)(s.product.description),1),(0,r.Lk)("h4",gt,"價格："+(0,l.v_)(s.product.price)+" 元",1),(0,r.Lk)("div",bt,[(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>s.addToCart&&s.addToCart(...e))},"加入購物車"),(0,r.Lk)("button",{class:"btn btn-secondary ms-2",onClick:t[1]||(t[1]=(...e)=>s.goBack&&s.goBack(...e))},"返回上一頁")])])])])):((0,r.uX)(),(0,r.CE)("div",kt,t[2]||(t[2]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"正在加載...")],-1),(0,r.Lk)("p",null,"正在加載商品中...",-1)])))])}var ft={name:"ProductDetail",setup(){const e=(0,U.Pj)(),t=(0,K.lq)(),a=(0,K.rd)(),s=(0,je.KR)(null),o=(0,r.EW)((()=>t.params.id)),n=(0,r.EW)((()=>s.value?`/api/${s.value.image}`:"/img/wrong.png")),i=(0,r.EW)((()=>e.state.auth.isLoggedIn)),l=async()=>{if(!d.value)return console.error("商品ID格式不正確:",o.value),e.dispatch("notifications/showNotification",{type:"error",message:"商品ID格式不正確，無法加載商品詳情。"}),void a.go(-1);try{const e=await ge.A.get(`/api/products/${o.value}`);s.value=e.data}catch(t){console.error("加載商品詳情時出錯",t),e.dispatch("notifications/showNotification",{type:"error",message:"加載商品詳情時出錯，請稍後再試！"})}},c=()=>{if(i.value)e.dispatch("cart/addProductToCart",s.value),e.dispatch("notifications/showNotification",{type:"success",message:`已將${s.value.name}加入購物車`,timeout:2e3});else{e.dispatch("notifications/showNotification",{type:"warning",message:"請先登入在加入購物車！"});const s=t.fullPath;a.push({name:"UserLogin",query:{redirect:s}})}},d=(0,r.EW)((()=>{const e=o.value;return/^[1-9]\d*$/.test(e)})),u=()=>{a.go(-1)};return(0,r.sV)((()=>{l()})),{addToCart:c,goBack:u,product:s,productId:o,productImageUrl:n}}};const Lt=(0,y.A)(ft,[["render",vt],["__scopeId","data-v-392b619e"]]);var yt=Lt;const wt={class:"container mt-5"},Ct={class:"card mb-3"},_t={class:"card-body"},It={class:"card-text"},Ft={class:"card-text"},Et={class:"card-text"},Pt={class:"card-text"},St={class:"card mb-3"},Ot={class:"card-body"},At={key:0},xt={class:"table"},Tt=["onClick"],Ut=["onClick"],Dt={class:"mb-3"},Mt={class:"card-body"},Rt={class:"table"},Nt=["onClick"],Xt={key:0},$t={colspan:"4"},qt={class:"order-details"},Vt=["src","alt"],Wt={class:"item-info"},Kt={class:"text-end"},Bt={class:"modal fade",id:"recipientModal",ref:"recipientModal",tabindex:"-1","aria-labelledby":"recipientModalLabel","aria-hidden":"true"},Qt={class:"modal-dialog"},jt={key:0,class:"text-center"},Jt={key:1,class:"text-center"},zt={class:"modal-content"},Ht={class:"modal-header"},Gt={class:"modal-title",id:"recipientModalLabel"},Zt={class:"modal-body"},Yt={class:"mb-3"},ea={class:"mb-3"},ta={class:"mb-3"},aa={class:"modal-footer"};function sa(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",wt,[t[22]||(t[22]=(0,r.Lk)("h2",{class:"mb-4"},"會員資料",-1)),(0,r.Lk)("div",Ct,[(0,r.Lk)("div",_t,[t[7]||(t[7]=(0,r.Lk)("h5",{class:"card-title"},"會員基本資料",-1)),(0,r.Lk)("p",It,"使用者名稱："+(0,l.v_)(n.userInfo.name),1),(0,r.Lk)("p",Ft,"電子郵件："+(0,l.v_)(n.userInfo.email),1),(0,r.Lk)("p",Et,"電話："+(0,l.v_)(n.userInfo.phone),1),(0,r.Lk)("p",Pt,"住址: "+(0,l.v_)(n.userInfo.address),1)])]),(0,r.Lk)("div",St,[(0,r.Lk)("div",Ot,[t[9]||(t[9]=(0,r.Lk)("h5",null,"收件人資料",-1)),(0,r.Lk)("button",{class:"btn btn-link",onClick:t[0]||(t[0]=(...e)=>i.toggleRecipient&&i.toggleRecipient(...e))},"展開/收起"),n.showRecipient?((0,r.uX)(),(0,r.CE)("div",At,[(0,r.Lk)("table",xt,[t[8]||(t[8]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"收件人名稱"),(0,r.Lk)("th",null,"聯絡電話"),(0,r.Lk)("th",null,"地址")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.recipients,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:t},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,(0,l.v_)(e.phone),1),(0,r.Lk)("td",null,(0,l.v_)(e.address),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-primary btn-sm",onClick:e=>i.editRecipientInfo(t)},"編輯",8,Tt),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:e=>i.deleteRecipient(t)},"刪除",8,Ut)])])))),128))])]),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>i.addRecipient&&i.addRecipient(...e))},"新增收件人")])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Dt,[(0,r.Lk)("div",Mt,[t[14]||(t[14]=(0,r.Lk)("h5",{class:"card-title"},"訂單查詢",-1)),(0,r.Lk)("table",Rt,[t[13]||(t[13]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"訂單編號"),(0,r.Lk)("th",null,"訂單金額"),(0,r.Lk)("th",null,"訂購時間"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.orders,((e,a)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:a},[(0,r.Lk)("tr",null,[(0,r.Lk)("td",null,(0,l.v_)(e.id),1),(0,r.Lk)("td",null,(0,l.v_)(Math.round(e.total)),1),(0,r.Lk)("td",null,(0,l.v_)(i.formateOrderDate(e.created_at)),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-link",onClick:e=>i.toggleOrderDetails(a)},"展開/收起",8,Nt)])]),null!==n.expandedOrder&&n.expandedOrder===a?((0,r.uX)(),(0,r.CE)("tr",Xt,[(0,r.Lk)("td",$t,[(0,r.Lk)("div",qt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.items,((e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"order-item"},[(0,r.Lk)("img",{src:e.product_image||"/default-product-image.png",alt:e.product_name,class:"product-thumbnail"},null,8,Vt),(0,r.Lk)("div",Wt,[t[10]||(t[10]=(0,r.Lk)("strong",null,"商品名稱:",-1)),(0,r.eW)((0,l.v_)(e.name)+" ",1),t[11]||(t[11]=(0,r.Lk)("strong",null,"數量:",-1)),(0,r.eW)(" "+(0,l.v_)(e.quantity)+" ",1),t[12]||(t[12]=(0,r.Lk)("strong",null,"價格:",-1)),(0,r.eW)(" "+(0,l.v_)(e.price),1)])])))),128))])])])):(0,r.Q3)("",!0)],64)))),128))])])])]),(0,r.Lk)("div",Kt,[(0,r.Lk)("button",{class:"btn btn-danger",onClick:t[2]||(t[2]=(...e)=>i.handleLogout&&i.handleLogout(...e))},"登出")])]),(0,r.Lk)("div",Bt,[(0,r.Lk)("div",Qt,[n.isLoadingRecipients?((0,r.uX)(),(0,r.CE)("div",jt,t[15]||(t[15]=[(0,r.Lk)("p",null,"正在加載收件人資料...",-1)]))):n.recipients.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Jt,t[16]||(t[16]=[(0,r.Lk)("p",null,"目前尚未有收件人資料。",-1)]))),(0,r.Lk)("div",zt,[(0,r.Lk)("div",Ht,[(0,r.Lk)("h5",Gt,(0,l.v_)(n.isEditing?"編輯收件人":"新增收件人"),1),t[17]||(t[17]=(0,r.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),(0,r.Lk)("div",Zt,[(0,r.Lk)("div",Yt,[t[18]||(t[18]=(0,r.Lk)("label",{for:"recipientName",class:"form-label"},"收件人名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>n.editRecipient.name=e)},null,512),[[s.Jo,n.editRecipient.name]])]),(0,r.Lk)("div",ea,[t[19]||(t[19]=(0,r.Lk)("label",{for:"recipientPhone",class:"form-label"},"收件人電話",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>n.editRecipient.phone=e)},null,512),[[s.Jo,n.editRecipient.phone]])]),(0,r.Lk)("div",ta,[t[20]||(t[20]=(0,r.Lk)("label",{for:"recipientAddress",class:"form-label"},"收件人地址",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>n.editRecipient.address=e)},null,512),[[s.Jo,n.editRecipient.address]])])]),(0,r.Lk)("div",aa,[t[21]||(t[21]=(0,r.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...e)=>i.saveRecipient&&i.saveRecipient(...e))},(0,l.v_)(n.isEditing?"儲存變更":"新增"),1)])])])],512)])}a(3215);var ra={name:"MemberPage",data(){return{showRecipient:!1,expandedOrder:null,isEditing:!1,isLoadingRecipients:!1,recipients:[],editRecipient:{name:" ",phone:" ",address:" "},editingIndex:-1,userInfo:{name:" ",email:" ",phone:"",address:""},orders:[]}},computed:{...(0,U.aH)("auth",{isLoggedIn:e=>e.isLoggedIn,user:e=>e.user})},mounted(){if(!this.isLoggedIn)return alert("請先登入會員！"),void this.$router.push("/UserLogin");this.loadUserInfo(),this.loadOrders(),this.loadRecipients()},methods:{async loadUserInfo(){try{const e=this.user.id;if(console.log("用戶 ID:",e),!e)return void console.error("用戶ID無效");const t=await ge.A.get(`/api/users/${e}`);this.userInfo=t.data,console.log("用戶資料",this.userInfo)}catch(e){console.error("加載用戶信息時出錯:",e),console.error("錯誤回應:",e.response),console.error("請求細節:",e.config),alert("加載用戶信息失敗，請重試。")}},async loadOrders(){try{const e=this.user.id;if(!e)return void console.error("用戶ID無效");const t=await ge.A.get("/api/orders",{params:{userId:e}});this.orders=t.data}catch(e){console.error("加載訂單失敗，請稍候再試。"),alert("加載訂單失敗，請稍候再試")}},async loadRecipients(){this.isLoadingRecipients=!0;try{const e=this.user.id,t=await ge.A.get("/api/recipients",{params:{user_id:e}});this.recipients=t.data}catch(e){console.error("加載收件人時錯誤：",e),this.recipients=[],alert("加載收件人失敗，請稍候再試。")}finally{this.isLoadingRecipients=!1}},async saveRecipient(){try{const e=this.user.id,t=e=>{const t=/^[0-9]{10}$/;return e.name.trim()&&t.test(e.phone)&&e.address.trim()};if(!t(this.editRecipient))return void alert("請檢查收件人資料是否完整且格式正確！");if(this.isEditing)await ge.A.put(`/api/recipients/${this.editRecipient.id}`,{...this.editRecipient,user_id:e}),this.recipients[this.editingIndex]={...this.editRecipient};else{const t=await ge.A.post("/api/recipients",{...this.editRecipient,user_id:e});this.recipients.push(t.data)}this.hideModal()}catch(e){console.error("保存收件人時出錯：",e),alert("保存收件人失敗，請稍候再試。")}},async deleteRecipient(e){try{const t=this.recipients[e].id;await ge.A.delete(`/api/recipients/${t}`),this.recipients.splice(e,1)}catch(t){console.error("刪除收件人失敗",t),alert("刪除收件人失敗")}},toggleRecipient(){this.showRecipient=!this.showRecipient},addRecipient(){this.isEditing=!1,this.editRecipient={name:"",phone:"",address:""},this.showModal()},editRecipientInfo(e){this.isEditing=!0,this.editingIndex=e,this.editRecipient={...this.recipients[e]},this.showModal()},toggleOrderDetails(e){const t=this.orders[e];if(!t.items||!t.items.length)return void alert("該訂單無法顯示細節！");const a=e=>e.name&&e.quantity>0&&e.price>=0;t.items.every(a)?this.expandedOrder=this.expandedOrder===e?null:e:alert("該訂單數據不完整，無法展開！")},showModal(){if(this.$refs.recipientModal){const e=new V.aF(this.$refs.recipientModal);e.show()}},hideModal(){const e=V.aF.getInstance(this.$refs.recipientModal);e&&e.hide()},...(0,U.i0)("auth",["logout"]),async handleLogout(){await this.logout(),alert("已成功登出!"),this.$router.push("/UserLogin")},formateOrderDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}}};const oa=(0,y.A)(ra,[["render",sa],["__scopeId","data-v-77d3e32e"]]);var na=oa;function ia(e,t,a,s,o,n){return t[0]||(t[0]=(0,r.Fv)('<div class="faq-search" data-v-7a8228db><input type="text" class="form-control" id="faqSearch" placeholder="搜尋問題..." data-v-7a8228db></div><div class="accordion" id="faqAccordion" data-v-7a8228db><div class="accordion-item faq-item" data-v-7a8228db><h2 class="accordion-header" id="headingOne" data-v-7a8228db><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" data-v-7a8228db> 問題一：如何註冊？ </button></h2><div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion" data-v-7a8228db><div class="accordion-body" data-v-7a8228db> 您可以點擊右上角的「註冊」按鈕，並按照提示填寫相關資訊來完成註冊。 </div></div></div><div class="accordion-item faq-item" data-v-7a8228db><h2 class="accordion-header" id="headingTwo" data-v-7a8228db><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" data-v-7a8228db> 問題二：忘記密碼怎麼辦？ </button></h2><div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion" data-v-7a8228db><div class="accordion-body" data-v-7a8228db> 您可以點擊「忘記密碼」連結，輸入您的電子郵件，系統將發送密碼重置的指引給您。 </div></div></div></div><div class="contact-container contact" data-v-7a8228db><div class="contact-info" data-v-7a8228db><h4 data-v-7a8228db>或者透過以下表格聯絡</h4></div><div class="contact-form" data-v-7a8228db><form data-v-7a8228db><div class="mb-3" data-v-7a8228db><label for="name" class="form-label" data-v-7a8228db>姓名</label><input type="text" class="form-control" id="name" placeholder="請輸入您的姓名" data-v-7a8228db></div><div class="mb-3" data-v-7a8228db><label for="email" class="form-label" data-v-7a8228db>電子郵件</label><input type="email" class="form-control" id="email" placeholder="請輸入您的電子郵件" data-v-7a8228db></div><div class="mb-3" data-v-7a8228db><label for="message" class="form-label" data-v-7a8228db>留言</label><textarea class="form-control" id="message" rows="4" placeholder="請輸入您的訊息" data-v-7a8228db></textarea></div><button type="submit" class="btn btn-primary" data-v-7a8228db>送出</button></form></div></div>',3))}var la={name:"ContactUs",mounted(){const e=document.getElementById("faqSearch");e&&e.addEventListener("input",(function(){const e=this.ariaValueMax.toLowerCase();document.querySelectorAll(".faq-item").forEach((function(t){const a=t.querySelector("according-button").innerText.toLowerCase(),s=t.querySelector(".according-body").innerText.toLowerCase();a.includes(e)||s.includes(e)?t.style.display="block":t.style.display="none"}))}))}};const ca=(0,y.A)(la,[["render",ia],["__scopeId","data-v-7a8228db"]]);var da=ca;function ua(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)("div",null,[t[0]||(t[0]=(0,r.Lk)("h1",null,"搜尋結果",-1)),(0,r.Lk)("p",null,"搜尋關鍵字："+(0,l.v_)(n.searchQuery),1)])}var pa={name:"SearchResults",computed:{searchQuery(){return this.$route.query.q||"未指定"}}};const ma=(0,y.A)(pa,[["render",ua]]);var ha=ma;const ga={class:"container register-container mt-5 whitespace:nowrap"},ba={class:"mb-3 d-flex align-items-center"},ka={class:"mb-3 d-flex align-items-center"},va={class:"mb-3 d-flex align-items-center"},fa={class:"mb-3 d-flex align-items-center"},La={class:"mb-3 d-flex align-items-center"},ya=["type"],wa={class:"mb-3 d-flex align-items-center"},Ca={key:0,class:"text-danger"};function _a(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",ga,[t[15]||(t[15]=(0,r.Lk)("h2",{class:"mb-4"},"會員註冊",-1)),(0,r.Lk)("form",{onSubmit:t[7]||(t[7]=(0,s.D$)(((...e)=>i.handleRegister&&i.handleRegister(...e)),["prevent"]))},[(0,r.Lk)("div",ba,[t[8]||(t[8]=(0,r.Lk)("label",{for:"username",class:"form-label me-2"},"會員姓名",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),placeholder:"請輸入姓名",required:""},null,512),[[s.Jo,n.username]])]),(0,r.Lk)("div",ka,[t[9]||(t[9]=(0,r.Lk)("label",{for:"email",class:"form-label me-2"},"電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),placeholder:"請輸入電子信箱",required:""},null,512),[[s.Jo,n.email]])]),(0,r.Lk)("div",va,[t[10]||(t[10]=(0,r.Lk)("label",{for:"phone",class:"form-label me-2"},"會員電話號碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel",class:"form-control",id:"phone","onUpdate:modelValue":t[2]||(t[2]=e=>n.phone=e),placeholder:"請輸入手機號碼",required:""},null,512),[[s.Jo,n.phone]])]),(0,r.Lk)("div",fa,[t[11]||(t[11]=(0,r.Lk)("label",{for:"address",class:"form-label me-2"},"收件人地址",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"address","onUpdate:modelValue":t[3]||(t[3]=e=>n.address=e),placeholder:"請輸入收件人地址",required:""},null,512),[[s.Jo,n.address]])]),(0,r.Lk)("div",La,[t[12]||(t[12]=(0,r.Lk)("label",{for:"password",class:"form-label me-2"},"會員密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:n.showPassword?"text":"password",class:"form-control",id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>n.password=e),placeholder:"請設定密碼"},null,8,ya),[[s.hp,n.password]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary position-absolute end-0 top-0 h-100",onClick:t[5]||(t[5]=e=>n.showPassword=!n.showPassword),style:{width:"60px"}},(0,l.v_)(n.showPassword?"隱藏":"顯示"),1)]),(0,r.Lk)("div",wa,[t[13]||(t[13]=(0,r.Lk)("label",{for:"confirmpassword",class:"form-label me-2"},"請再次輸入密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"confirmpassword","onUpdate:modelValue":t[6]||(t[6]=e=>n.confirmpassword=e),placeholder:"請再次輸入密碼",required:""},null,512),[[s.Jo,n.confirmpassword]])]),n.formErrors.length?((0,r.uX)(),(0,r.CE)("div",Ca,[(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.formErrors,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e},(0,l.v_)(e),1)))),128))])])):(0,r.Q3)("",!0),t[14]||(t[14]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"註冊",-1))],32)])}var Ia={name:"UserRegister",data(){return{username:"",phone:"",address:"",email:"",password:"",confirmpassword:"",formErrors:[],showPassword:!1}},methods:{handleRegister(){this.formErrors=[],this.validatePhoneNumber()||this.formErrors.push("請輸入正確的手機號碼格式"),this.password!==this.confirmpassword&&this.formErrors.push("兩次密碼不相符，請重新輸入。"),this.validateEmail(this.email)||this.formErrors.push("請輸入正確的電子郵件格式"),this.username.trim()||this.formErrors.push("請輸入會員姓名"),this.address.trim()||this.formErrors.push("請輸入地址"),this.password.trim()||this.formErrors.push("請設定密碼"),this.password.length<6&&this.formErrors.push("密碼長度需至少為6個字元"),this.formErrors.length||ge.A.post("/api/users",{name:this.sanitizeInput(this.username),phone:this.sanitizeInput(this.phone),address:this.sanitizeInput(this.address),email:this.sanitizeInput(this.email),password:this.sanitizeInput(this.password),role:"user"}).then((()=>{alert("註冊成功"),this.$router.push("/UserLogin")})).catch((e=>{e.response?(console.error("伺服器錯誤:",e.response.data),this.formErrors.push("伺服器錯誤，請稍候再試。")):e.request?(console.error("未收到伺服器響應:",e.request),this.formErrors.push("無法連接到伺服器，請檢查網絡。")):(console.error("註冊失敗:",e.message),this.formErrors.push("註冊失敗，請稍候再試。"))}))},validatePhoneNumber(){const e=/^[0-9]{10}$/;return e.test(this.phone)},validateEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},sanitizeInput(e){return e.replace(/<[^>]*>?/gm,"").trim()}}};const Fa=(0,y.A)(Ia,[["render",_a],["__scopeId","data-v-ce59bb36"]]);var Ea=Fa;const Pa={class:"login-container container mt-5"},Sa={class:"mb-3"},Oa={class:"mb-3"},Aa={class:"d-flex justify-content-between mb-3"};function xa(e,t,a,o,n,i){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Pa,[t[8]||(t[8]=(0,r.Lk)("h2",{class:"text-center mb-4"},"會員登入",-1)),(0,r.Lk)("form",{onSubmit:t[2]||(t[2]=(0,s.D$)(((...e)=>i.handleLogin&&i.handleLogin(...e)),["prevent"]))},[(0,r.Lk)("div",Sa,[t[3]||(t[3]=(0,r.Lk)("label",{for:"email",class:"form-label"},"帳號/電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),name:"email",class:"form-control",placeholder:"請輸入你的EMAIL",required:""},null,512),[[s.Jo,n.email]])]),(0,r.Lk)("div",Oa,[t[4]||(t[4]=(0,r.Lk)("label",{for:"password",class:"form-label"},"密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),name:"password",class:"form-control",placeholder:"請輸入密碼",required:""},null,512),[[s.Jo,n.password]])]),(0,r.Lk)("div",Aa,[(0,r.bF)(l,{class:"text-decoration-none",to:"/ForgotPwd"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("忘記密碼？")]))),_:1}),(0,r.bF)(l,{class:"text-decoration-none",to:"/UserRegister"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("註冊新帳號")]))),_:1})]),t[7]||(t[7]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100"},"登入",-1))],32)])}var Ta={name:"UserLogin",data(){return{email:"",password:""}},methods:{...(0,U.i0)("auth",["login"]),async handleLogin(){try{const e=await ge.A.post("/api/users/login",{email:this.email,password:this.password}),t=e.data;if(console.log("用戶資料:",t),t){console.log("找到的用戶",t),alert("登入成功!歡迎"+t.name),this.login(t);const e=this.$route.query.redirect;"admin"===t.role?e&&e.startsWith("/admin")?this.$router.push(e):this.$router.push("/admin"):"user"===t.role?e&&!e.startsWith("/admin")?this.$router.push(e):this.$router.push("/MembersPage"):alert("帳號或密碼錯誤")}}catch(e){e.response?401===e.response.status||404===e.response.status?alert("帳號或密碼錯誤"):alert("登入失敗，伺服器錯誤！"):(console.error("登入失敗",e),alert("登入失敗，請稍候再試"))}}}};const Ua=(0,y.A)(Ta,[["render",xa],["__scopeId","data-v-33f37b08"]]);var Da=Ua;const Ma={class:"container"},Ra={class:"mb-3"};function Na(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",Ma,[t[4]||(t[4]=(0,r.Lk)("h5",null,"忘記密碼",-1)),(0,r.Lk)("form",{onSubmit:t[1]||(t[1]=(0,s.D$)(((...e)=>i.handleForgotPassword&&i.handleForgotPassword(...e)),["prevent"]))},[(0,r.Lk)("div",Ra,[t[2]||(t[2]=(0,r.Lk)("label",{for:"email",class:"form-label"},"電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),class:"form-control",id:"email",required:""},null,512),[[s.Jo,n.email]])]),t[3]||(t[3]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"發送重設密碼連結信",-1))],32)])}var Xa={name:"ForgotPwd",data(){return{email:""}},methods:{async handleForgotPassword(){try{const e=this.$route.params.token;await ge.A.post(`/api/reset-password/${e}`,{newPassword:this.newPassword}),alert("密碼已成功重新設置！"),this.$router.push("/login")}catch(e){console.error("重設密碼錯誤,error"),alert("重設密碼失敗")}}}};const $a=(0,y.A)(Xa,[["render",Na]]);var qa=$a;const Va={class:"order-confirmation container mt-5"},Wa={key:0,class:"text-center"},Ka={key:1,class:"text-center"},Ba={key:2};function Qa(e,t,a,s,o,n){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Va,[t[3]||(t[3]=(0,r.Lk)("h2",{class:"text-center mb-4"},"訂單確認",-1)),s.isLoading?((0,r.uX)(),(0,r.CE)("div",Wa,t[0]||(t[0]=[(0,r.Lk)("p",null,"正在加載訂單詳情...",-1)]))):s.orderDetails?((0,r.uX)(),(0,r.CE)("div",Ba,[(0,r.Lk)("p",null,"感謝您的購買，您的訂單編號是："+(0,l.v_)(s.orderId),1),(0,r.bF)(i,{to:"/",class:"btn btn-primary mt-3"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("繼續購物！")]))),_:1})])):((0,r.uX)(),(0,r.CE)("div",Ka,t[1]||(t[1]=[(0,r.Lk)("p",null,"無法加載訂單詳情，請稍後再試。",-1)])))])}var ja={name:"OrderConfirmation",setup(){const e=(0,K.lq)(),t=(0,U.Pj)(),a=(0,K.rd)(),s=e.params.orderId,o=(0,je.KR)(null),n=(0,je.KR)(!0),i=async()=>{n.value=!0;const e=/^[1-9]\d*$/.test(s);if(!e)return console.error("訂單編號格式不正確:",s),t.dispatch("notifications/showNotification",{type:"error",message:"訂單編號格式不正確，無法加載訂單詳情。"}),a.push("/").catch((e=>{"NavigationDuplicated"!==e.name&&console.error(e)})),void(n.value=!1);try{const e=await ge.A.get(`/api/orders/${s}`);if(!e.data||!e.data.orderId||0===!e.data.items.length)return console.error("訂單詳情數據不完整"),void(n.value=!1);o.value=e.data}catch(r){r.response&&404===r.response.status?(console.error("訂單不存在",r),t.dispatch("notifications/showNotification",{type:"error",message:"訂單不存在，請確認您的訂單編號。"})):(console.error("加載訂單詳情時出錯",r),t.dispatch("notifications/showNotification",{type:"error",message:"加載訂單詳情時出錯，請稍後再試！"})),o.value=null}finally{n.value=!1}};return(0,r.sV)((()=>{if(!s)return console.error("訂單編號缺失"),void a.push("/").catch((e=>{"NavigationDuplicated"!==e.name&&console.error(e)}));i()})),{orderId:s,orderDetails:o,isLoading:n}}};const Ja=(0,y.A)(ja,[["render",Qa],["__scopeId","data-v-1807772f"]]);var za=Ja;const Ha={class:"admin-dashboard container mt-5"},Ga={class:"button-container"},Za={class:"button-item"},Ya={class:"button-item"},es={class:"button-item"},ts={class:"button-item"},as={class:"row text-center mt-4"},ss={class:"col-md-6"},rs={class:"col-md-6"},os={class:"row text-center mt-4"},ns={class:"col-md-6"},is={class:"col-md-6"},ls={class:"row mt-5"},cs={class:"col-md-6"},ds={class:"col-md-6"};function us(e,t,a,s,o,n){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Ha,[t[10]||(t[10]=(0,r.Lk)("h2",{class:"text-center"},"管理後台儀表板",-1)),(0,r.Lk)("div",Ga,[(0,r.Lk)("div",Za,[(0,r.bF)(i,{to:"/admin/CarouselImages",class:"btn btn-primary btn-block"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("輪播圖片管理")]))),_:1})]),(0,r.Lk)("div",Ya,[(0,r.bF)(i,{to:"/admin/products",class:"btn btn-primary btn-block"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("商品管理")]))),_:1})]),(0,r.Lk)("div",es,[(0,r.bF)(i,{to:"/admin/orders",class:"btn btn-primary btn-block"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("訂單管理")]))),_:1})]),(0,r.Lk)("div",ts,[(0,r.bF)(i,{to:"/admin/users",class:"btn btn-primary btn-block"},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)("使用者管理")]))),_:1})])]),(0,r.Lk)("div",as,[(0,r.Lk)("div",ss,[t[4]||(t[4]=(0,r.Lk)("h4",null,"今日訂單數量",-1)),(0,r.Lk)("p",null,(0,l.v_)(o.todayOrders),1)]),(0,r.Lk)("div",rs,[t[5]||(t[5]=(0,r.Lk)("h4",null,"今日銷售金額",-1)),(0,r.Lk)("p",null,(0,l.v_)(n.formatNumber(o.todaySales)),1)])]),(0,r.Lk)("div",os,[(0,r.Lk)("div",ns,[t[6]||(t[6]=(0,r.Lk)("h4",null,"昨日銷售金額",-1)),(0,r.Lk)("p",null,(0,l.v_)(n.formatNumber(o.yesterdaySales)),1)]),(0,r.Lk)("div",is,[t[7]||(t[7]=(0,r.Lk)("h4",null,"過去七日銷售金額",-1)),(0,r.Lk)("p",null,(0,l.v_)(n.formatNumber(o.last7DaySales)),1)])]),t[11]||(t[11]=(0,r.Lk)("div",{class:"row mt-5"},[(0,r.Lk)("div",{class:"col-12"},[(0,r.Lk)("h4",null,"每日銷售趨勢圖"),(0,r.Lk)("canvas",{id:"salesChart"})])],-1)),(0,r.Lk)("div",ls,[(0,r.Lk)("div",cs,[t[8]||(t[8]=(0,r.Lk)("h4",null,"今日註冊會員",-1)),(0,r.Lk)("p",null,(0,l.v_)(o.todayNewMembers),1)]),(0,r.Lk)("div",ds,[t[9]||(t[9]=(0,r.Lk)("h4",null,"累積會員數",-1)),(0,r.Lk)("p",null,(0,l.v_)(o.totalMembers),1)])])])}a(8872);var ps=a(3456),ms={name:"AdminDashboard",data(){return{todayOrders:0,todaySales:0,yesterdaySales:0,last7DaySales:0,salesData:[],lowStockProducts:[],todayNewMembers:0,totalMembers:0,carouselImages:[],products:[],sevenDaySalesRanking:[],monthSalesRanking:[]}},async mounted(){await this.loadDashboardData(),this.renderSalesChart()},methods:{async loadDashboardData(){try{const[e,t,a]=await Promise.all([ge.A.get("/api/orders"),ge.A.get("/api/users"),ge.A.get("/api/products")]),s=e.data,r=t.data,o=a.data;this.products=o;const n=new Date,i=n.toISOString().split("T")[0];this.todayOrders=s.filter((e=>e.order_date.split("T")[0]===i)).length;const l=new Date;l.setDate(l.getDate()-1);const c=l.toISOString().split("T")[0],d=new Date;d.setDate(d.getDate()-7);const u=d.toISOString().split("T")[0];this.todaySales=s.filter((e=>e.order_date.split("T")[0]===i)).reduce(((e,t)=>e+Number(t.total)),0),this.yesterdaySales=s.filter((e=>e.order_date.split("T")[0]===c)).reduce(((e,t)=>e+Number(t.total)),0),this.last7DaySales=s.filter((e=>e.order_date.split("T")[0]>=u&&e.order_date.split("T")[0]<=i)).reduce(((e,t)=>e+Number(t.total)),0);const p={};s.forEach((e=>{const t=e.order_date.split("T")[0],a=Number(e.total);p[t]?p[t]+=a:p[t]=a})),this.salesData=Object.keys(p).map((e=>({date:e,amount:p[e]}))).sort(((e,t)=>new Date(e.date)-new Date(t.date)));const m=s.filter((e=>e.order_date>=u&&e.order_date<=n)),h={};m.forEach((e=>{e.items.forEach((e=>{h[e.product_id]?h[e.product_id].sales+=e.quantity:h[e.product_id]={name:e.product_name,sales:e.quantity}}))})),this.sevenDaySalesRanking=Object.values(h).sort(((e,t)=>t.sales-e.sales)).slice(0,10);const g=new Date;g.setDate(g.getDate()-30);const b=g.toISOString().split("T")[0],k=s.filter((e=>e.order_date>=b&&e.order_date<=n)),v={};k.forEach((e=>{e.items.forEach((e=>{v[e.product_id]?v[e.product_id].sales+=e.quantity:v[e.product_id]={name:e.product_name,sales:e.quantity}}))})),this.monthSalesRanking=Object.values(v).sort(((e,t)=>t.sales-e.sales)).slice(0,10);const f=r.filter((e=>{if(e.created_at){const t=new Date(e.created_at).toISOString().split("T")[0];return console.log("Members:",r),t===i}return!1})).length;this.todayNewMembers=f,this.totalMembers=r.length}catch(e){console.error(e),alert("加載儀表板數據時出錯，請稍候再試！")}},getProductStock(e){const t=this.products.find((t=>t.id===e));return t?t.stock:0},prepareSalesData(e){const t={};e.forEach((e=>{t[e.order_date]?t[e.order_date]+=e.total:t[e.order_date]=e.total}));const a=Object.keys(t).map((e=>({date:e,amount:t[e]}))).sort(((e,t)=>new Date(e.date)-new Date(t.date)));return a},renderSalesChart(){if(!this.salesData||0===this.salesData.length)return void console.error("銷售數據未加載！");const e=document.getElementById("salesChart").getContext("2d");new ps.Ay(e,{type:"line",data:{labels:this.salesData.map((e=>e.date)),datasets:[{label:"銷售金額",data:this.salesData.map((e=>e.amount)),borderColor:"rgba(75,192,192,1)",borderWidth:2,fill:!1}]},options:{scales:{x:{title:{display:!0,text:"日期"}},y:{title:{display:!0,text:"銷售金額(元)"},beginAtZero:!0}}}})},deleteCarouselImage(e){confirm("確定要刪除這張圖片嗎？")&&ge.A.delete(`/api/carousel-image/${e}`).then((()=>{this.carouselImages=this.carouselImages.filter((t=>t.id!==e)),alert("圖片已刪除。")})).catch((e=>{console.error("圖片刪除失敗",e),alert("圖片刪除失敗！請稍後再試。")}))},formatNumber(e){return Number(e).toLocaleString("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!1}).replace(/^0+/,"")}}};const hs=(0,y.A)(ms,[["render",us],["__scopeId","data-v-173b647b"]]);var gs=hs;const bs={class:"admin-dashboard container mt-5"},ks={class:"d-flex justify-content-end mb-3"},vs={key:0,class:"accordion",id:"productAccordion"},fs={class:"accordion-item"},Ls={class:"accordion-header",id:"headingProducts"},ys={class:"accordion-body"},ws={class:"d-flex justify-content-between align-items-center mb-3"},Cs=["value"],_s=["disabled"],Is=["disabled"],Fs={class:"table"},Es=["onClick"],Ps={class:"row mt-5"},Ss={class:"col-md-6"},Os={class:"accordion",id:"tagAccordion"},As={class:"accordion-item"},xs={class:"accordion-header",id:"headingTags"},Ts={class:"accordion-body"},Us={class:"d-flex justify-content-end mb-3"},Ds={class:"table"},Ms=["onClick"],Rs=["onClick"],Ns={class:"col-md-6"},Xs={class:"accordion",id:"brandAccordion"},$s={class:"accordion-item"},qs={class:"accordion-header",id:"headingBrands"},Vs={class:"accordion-body"},Ws={class:"d-flex justify-content-end mb-3"},Ks={class:"table"},Bs=["onClick"],Qs=["onClick"],js={class:"modal fade",tabindex:"-1",ref:"tagModal"},Js={class:"modal-dialog"},zs={class:"modal-content"},Hs={class:"modal-header"},Gs={class:"modal-body"},Zs={class:"modal-footer"},Ys={class:"modal fade",tabindex:"-1",ref:"brandModal"},er={class:"modal-dialog"},tr={class:"modal-content"},ar={class:"modal-header"},sr={class:"modal-body"},rr={class:"modal-footer"};function or(e,t,a,o,n,i){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",bs,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"text-center"},"商品管理",-1)),(0,r.Lk)("div",ks,[(0,r.bF)(c,{to:"/admin/CreateProduct",class:"btn btn-success"},{default:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.eW)("新增商品")]))),_:1}),(0,r.bF)(c,{to:"/admin/SpecialOffers",class:"btn btn-primary"},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.eW)("特價商品管理")]))),_:1})]),n.isSectionOpen.products?((0,r.uX)(),(0,r.CE)("div",vs,[(0,r.Lk)("div",fs,[(0,r.Lk)("h2",Ls,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[0]||(t[0]=e=>i.toggleSection("products"))}," 商品管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse show",{show:n.isSectionOpen.products}]),"aria-labelledby":"headingProducts","data-bs-parent":"#productAccordion"},[(0,r.Lk)("div",ys,[(0,r.Lk)("div",ws,[(0,r.Lk)("div",null,[t[18]||(t[18]=(0,r.Lk)("label",{for:"itemsPerPage"},"每頁顯示：",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.itemsPerPage=e),id:"itemsPerPage"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.itemsPerPageOptions,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e},(0,l.v_)(e),9,Cs)))),128))],512),[[s.u1,n.itemsPerPage,void 0,{number:!0}]])]),(0,r.Lk)("div",null,[(0,r.Lk)("button",{class:"btn btn-primary btn-sm me-2",disabled:1===n.currentPage,onClick:t[2]||(t[2]=e=>n.currentPage--)},"上一頁 ",8,_s),(0,r.Lk)("span",null,"第 "+(0,l.v_)(n.currentPage)+" 頁，共 "+(0,l.v_)(i.totalPages)+" 頁",1),(0,r.Lk)("button",{class:"btn btn-primary btn-sm ms-2",disabled:n.currentPage===i.totalPages,onClick:t[3]||(t[3]=e=>n.currentPage++)},"下一頁 ",8,Is)])]),(0,r.Lk)("table",Fs,[t[20]||(t[20]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"價格"),(0,r.Lk)("th",null,"庫存"),(0,r.Lk)("th",null,"描述"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.paginatedProducts,((e,a)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,(0,l.v_)(e.price),1),(0,r.Lk)("td",null,(0,l.v_)(e.stock),1),(0,r.Lk)("td",null,(0,l.v_)(e.description),1),(0,r.Lk)("td",null,[(0,r.bF)(c,{to:{name:"EditProduct",params:{id:e.id}},class:"btn btn-warning btn-sm"},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.eW)("編輯")]))),_:2},1032,["to"]),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ms-2",onClick:t=>i.deleteProduct(e.id,a)},"刪除",8,Es)])])))),128))])])])],2)])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Ps,[(0,r.Lk)("div",Ss,[(0,r.Lk)("div",Os,[(0,r.Lk)("div",As,[(0,r.Lk)("h2",xs,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[4]||(t[4]=e=>i.toggleSection("tags"))}," 標籤管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse",{show:n.isSectionOpen.tags}]),"aria-labelledby":"headingTags","data-bs-parent":"#tagAccordion"},[(0,r.Lk)("div",Ts,[(0,r.Lk)("div",Us,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[5]||(t[5]=(...e)=>i.openCreateTagModal&&i.openCreateTagModal(...e))},"新增標籤")]),(0,r.Lk)("table",Ds,[t[21]||(t[21]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"標籤名稱"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.tags,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>i.openEditTagModal(t)},"編輯",8,Ms),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>i.deleteTag(e.id,t)},"刪除",8,Rs)])])))),128))])])])],2)])])]),(0,r.Lk)("div",Ns,[(0,r.Lk)("div",Xs,[(0,r.Lk)("div",$s,[(0,r.Lk)("h2",qs,[(0,r.Lk)("button",{class:"accordion-button",type:"button",onClick:t[6]||(t[6]=e=>i.toggleSection("brands"))}," 廠牌管理 ")]),(0,r.Lk)("div",{class:(0,l.C4)(["accordion-collapse collapse",{show:n.isSectionOpen.brands}]),"aria-labelledby":"headingBrands","data-bs-parent":"#brandAccordion"},[(0,r.Lk)("div",Vs,[(0,r.Lk)("div",Ws,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[7]||(t[7]=(...e)=>i.openCreateBrandModal&&i.openCreateBrandModal(...e))}," 新增廠牌 ")]),(0,r.Lk)("table",Ks,[t[22]||(t[22]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"廠牌名稱"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.brands,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.name),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>i.openEditBrandModal(t)},"編輯",8,Bs),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:a=>i.deleteBrand(e.id,t)},"刪除",8,Qs)])])))),128))])])])],2)])])])])]),(0,r.Lk)("div",js,[(0,r.Lk)("div",Js,[(0,r.Lk)("div",zs,[(0,r.Lk)("div",Hs,[t[24]||(t[24]=(0,r.Lk)("h5",{class:"modal-title"},"編輯標籤",-1)),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[8]||(t[8]=(...e)=>i.closeTagModal&&i.closeTagModal(...e))})]),(0,r.Lk)("div",Gs,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>n.tagForm.name=e),class:"form-control",placeholder:"標籤名稱"},null,512),[[s.Jo,n.tagForm.name]])]),(0,r.Lk)("div",Zs,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=(...e)=>i.closeTagModal&&i.closeTagModal(...e))},"取消"),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",onClick:t[11]||(t[11]=(...e)=>i.saveTag&&i.saveTag(...e))},(0,l.v_)(n.isEditingTag?"保存變更":"新增標籤"),1)])])])],512),(0,r.Lk)("div",Ys,[(0,r.Lk)("div",er,[(0,r.Lk)("div",tr,[(0,r.Lk)("div",ar,[t[25]||(t[25]=(0,r.Lk)("h5",{class:"modal-title"},"編輯廠牌",-1)),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=(...e)=>i.closeBrandModal&&i.closeBrandModal(...e))})]),(0,r.Lk)("div",sr,[(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>n.brandForm.name=e),class:"form-control",placeholder:"廠牌名稱"},null,512),[[s.Jo,n.brandForm.name]])]),(0,r.Lk)("div",rr,[(0,r.Lk)("button",{class:"btn btn-secondary",onClick:t[14]||(t[14]=(...e)=>i.closeBrandModal&&i.closeBrandModal(...e))},"取消"),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[15]||(t[15]=(...e)=>i.saveBrand&&i.saveBrand(...e))},"保存")])])])],512)],64)}var nr={name:"AdminProducts",data(){return{products:[],tags:[],brands:[],productForm:{name:"",price:0,stock:0,description:"",brand_id:"",tag_ids:[]},tagForm:{name:""},brandForm:{name:""},isEditing:!1,currentIndex:null,isEditingTag:!1,isEditingBrand:!1,currentPage:1,itemsPerPage:10,itemsPerPageOptions:[10,20,50],isSectionOpen:{products:!0,tags:!1,brands:!1}}},mounted(){this.loadProducts(),this.loadTags(),this.loadBrands()},computed:{paginatedProducts(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.products.slice(e,t)},totalPages(){return Math.ceil(this.products.length/this.itemsPerPage)}},methods:{toggleSection(e){this.isSectionOpen[e]=!this.isSectionOpen[e]},async loadProducts(){try{const e=await ge.A.get("/api/products");this.products=e.data,this.currentPage>this.totalPages&&(this.currentPage=this.totalPages||1)}catch(e){console.error("加載產品時出錯",e),alert("加載產品時出錯，請稍候再試！")}},async loadTags(){try{const e=await ge.A.get("/api/tags");this.tags=e.data}catch(e){console.error("加載標籤時錯誤",e),alert("加載標籤時錯誤，請稍候再試！")}},async loadBrands(){try{const e=await ge.A.get("/api/brands");this.brands=e.data}catch(e){console.error("加載廠牌時出錯",e),alert("加載廠牌時出錯，請稍候再試！")}},async saveTag(){try{if(this.isEditingTag)await ge.A.put(`/api/tags/${this.tagForm.id}`,this.tagForm),this.tags[this.currentIndex]={...this.tagForm};else{const e=await ge.A.post("/api/tags",this.tagForm);this.tags.push(e.data)}}catch(e){console.error("保存標籤時出錯！",e),alert("保存標籤時出錯，請稍候再試")}this.closeTagModal()},async saveBrand(){try{if(this.isEditingBrand)await ge.A.put(`/api/brands/${this.brandForm.id}`,this.brandForm),this.brands[this.currentIndex]={...this.brandForm};else{const e=await ge.A.post("/api/brands",this.brandForm);this.brands.push(e.data)}}catch(e){console.error("保存廠牌時出錯！",e),alert("保存廠牌時出錯，請稍候再試")}this.closeBrandModal()},async deleteProduct(e,t){if(confirm("確定要刪除此商品？"))try{await ge.A.delete(`/api/products/${e}`),this.products.splice(t,1)}catch(a){console.error("刪除產品時出錯",a),alert("刪除產品時出錯，請稍候再試！")}},async deleteTag(e,t){if(confirm("確定要刪除此標籤？"))try{await ge.A.delete(`/api/tags/${e}`),this.tags.splice(t,1)}catch(a){console.error("刪除標籤時出錯",a),alert("刪除標籤時出錯，請稍候再試！")}},async deleteBrand(e,t){if(confirm("確定要刪除此廠牌？"))try{await ge.A.delete(`/api/brands/${e}`),this.brands.splice(t,1)}catch(a){console.error("刪除廠牌時出錯",a),alert("刪除廠牌時出錯，請稍候再試！")}},openCreateTagModal(){this.isEditingTag=!1,this.tagForm={name:""},this.$nextTick((()=>{const e=new V.aF(this.$refs.tagModal);e.show()}))},openCreateBrandModal(){this.isEditingBrand=!1,this.brandForm={name:""},this.$nextTick((()=>{const e=new V.aF(this.$refs.brandModal);e.show()}))},openEditTagModal(e){this.isEditingTag=!0,this.currentIndex=e,this.tagForm={...this.tags[e]};const t=new V.aF(this.$refs.tagModal);t.show()},openEditBrandModal(e){this.isEditingBrand=!0,this.currentIndex=e,this.brandForm={...this.brands[e]};const t=new V.aF(this.$refs.brandModal);t.show()},closeTagModal(){const e=V.aF.getInstance(this.$refs.tagModal);e&&e.hide()},closeBrandModal(){const e=V.aF.getInstance(this.$refs.brandModal);e&&e.hide()}},watch:{itemsPerPage(){this.currentPage=1}}};const ir=(0,y.A)(nr,[["render",or],["__scopeId","data-v-a8492868"]]);var lr=ir;const cr={class:"admin-dashboard container mt-5"},dr={class:"admin-users container mt-5"},ur={class:"table table-hover"},pr=["onClick"],mr=["onClick"],hr={key:0},gr={colspan:"4"},br={class:"recipient-card"},kr=["onClick"],vr=["onClick"],fr={class:"modal fade",tabindex:"-1",ref:"userModal"},Lr={class:"modal-dialog"},yr={class:"modal-content"},wr={class:"modal-header"},Cr={class:"modal-title"},_r={class:"modal-body"},Ir={class:"mb-3"},Fr={class:"mb-3"},Er={class:"mb-3"},Pr=["required"],Sr={class:"mb-3"},Or=["required"],Ar={class:"mb-3"},xr={key:0},Tr={class:"mb-3"},Ur=["required"],Dr=["required"],Mr={class:"modal-footer"},Rr={type:"submit",class:"btn btn-primary"};function Nr(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",cr,[t[24]||(t[24]=(0,r.Lk)("h2",{class:"text-center"},"用戶管理",-1)),(0,r.Lk)("div",dr,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[0]||(t[0]=(...e)=>i.openCreateUserModal&&i.openCreateUserModal(...e))},"新增用戶")]),(0,r.Lk)("table",ur,[t[15]||(t[15]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"用戶名"),(0,r.Lk)("th",null,"電子信箱"),(0,r.Lk)("th",null,"權限"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.users,((a,s)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:s},[(0,r.Lk)("tr",null,[(0,r.Lk)("td",null,(0,l.v_)(a.name),1),(0,r.Lk)("td",null,(0,l.v_)(a.email),1),(0,r.Lk)("td",null,(0,l.v_)(a.role),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm",onClick:e=>i.openEditUserModal(s)},"編輯",8,pr),(0,r.Lk)("button",{class:"btn btn-danger btn-sm ml-2",onClick:e=>i.deleteUser(s)},"刪除",8,mr)])]),a.recipients&&Array.isArray(a.recipients)?((0,r.uX)(),(0,r.CE)("tr",hr,[(0,r.Lk)("td",gr,[(0,r.Lk)("div",br,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.recipients,((a,o)=>((0,r.uX)(),(0,r.CE)("div",{key:o},[t[11]||(t[11]=(0,r.Lk)("strong",null,"收件人名稱:",-1)),(0,r.eW)(" "+(0,l.v_)(a.name)+" ",1),t[12]||(t[12]=(0,r.Lk)("strong",null,"電話:",-1)),(0,r.eW)(" "+(0,l.v_)(a.phone)+" ",1),t[13]||(t[13]=(0,r.Lk)("strong",null,"地址:",-1)),(0,r.eW)(" "+(0,l.v_)(a.address)+" ",1),(0,r.Lk)("button",{class:"btn btn-sm btn-warning",onClick:t=>e.editRecipient(s,o)},"編輯收件人",8,kr),(0,r.Lk)("button",{class:"btn btn-sm btn-danger",onClick:t=>e.deleteRecipient(s,o)},"刪除",8,vr),t[14]||(t[14]=(0,r.Lk)("br",null,null,-1))])))),128))])])])):(0,r.Q3)("",!0)],64)))),128))])]),(0,r.Lk)("div",fr,[(0,r.Lk)("div",Lr,[(0,r.Lk)("div",yr,[(0,r.Lk)("div",wr,[(0,r.Lk)("h5",Cr,(0,l.v_)(n.isEditing?"編輯用戶":"新增用戶"),1),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>i.closeModal&&i.closeModal(...e))})]),(0,r.Lk)("div",_r,[(0,r.Lk)("form",{onSubmit:t[10]||(t[10]=(0,s.D$)(((...e)=>i.saveUser&&i.saveUser(...e)),["prevent"]))},[(0,r.Lk)("div",Ir,[t[16]||(t[16]=(0,r.Lk)("label",{for:"userName",class:"form-label"},"用戶名",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"userName","onUpdate:modelValue":t[2]||(t[2]=e=>n.userForm.name=e),required:""},null,512),[[s.Jo,n.userForm.name]])]),(0,r.Lk)("div",Fr,[t[17]||(t[17]=(0,r.Lk)("label",{for:"userEmail",class:"form-label"},"電子郵件",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"userEmail","onUpdate:modelValue":t[3]||(t[3]=e=>n.userForm.email=e),required:""},null,512),[[s.Jo,n.userForm.email]])]),(0,r.Lk)("div",Er,[t[18]||(t[18]=(0,r.Lk)("label",{for:"userPassword",class:"form-label"},"密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"userPassword","onUpdate:modelValue":t[4]||(t[4]=e=>n.userForm.password=e),required:!n.isEditing||n.userForm.password},null,8,Pr),[[s.Jo,n.userForm.password]])]),(0,r.Lk)("div",Sr,[t[19]||(t[19]=(0,r.Lk)("label",{for:"confirmPassword",class:"form-label"},"確認密碼",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"confirmPassword","onUpdate:modelValue":t[5]||(t[5]=e=>n.userForm.confirmPassword=e),required:!n.isEditing||n.userForm.password},null,8,Or),[[s.Jo,n.userForm.confirmPassword]])]),(0,r.Lk)("div",Ar,[t[21]||(t[21]=(0,r.Lk)("label",{for:"userName",class:"form-label"},"權限",-1)),(0,r.bo)((0,r.Lk)("select",{id:"userRole",class:"form-select","onUpdate:modelValue":t[6]||(t[6]=e=>n.userForm.role=e)},t[20]||(t[20]=[(0,r.Lk)("option",{value:"user"},"用戶",-1),(0,r.Lk)("option",{value:"admin"},"管理者",-1)]),512),[[s.u1,n.userForm.role]])]),"user"===n.userForm.role?((0,r.uX)(),(0,r.CE)("div",xr,[(0,r.Lk)("div",Tr,[t[22]||(t[22]=(0,r.Lk)("label",{for:"userPhone",class:"form-label"},"電話",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"userPhone","onUpdate:modelValue":t[7]||(t[7]=e=>n.userForm.phone=e),required:"user"===n.userForm.role},null,8,Ur),[[s.Jo,n.userForm.phone]])]),(0,r.Lk)("div",null,[t[23]||(t[23]=(0,r.Lk)("label",{for:"userAddress",class:"form-label"},"地址",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"userAddress","onUpdate:modelValue":t[8]||(t[8]=e=>n.userForm.address=e),required:"user"===n.userForm.role},null,8,Dr),[[s.Jo,n.userForm.address]])])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Mr,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=(...e)=>i.closeModal&&i.closeModal(...e))},"取消"),(0,r.Lk)("button",Rr,(0,l.v_)(n.isEditing?"保存變更":"新增用戶"),1)])],32)])])])],512)])}var Xr={name:"AdminUsers",data(){return{users:[],userForm:{name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},isEditing:!1,currentIndex:null}},mounted(){this.loadUsers()},methods:{async loadUsers(){try{const e=await ge.A.get("/api/users");this.users=e.data}catch(e){console.error("加載用戶資料失敗",e),alert("無法家載用戶資料")}},openCreateUserModal(){this.isEditing=!1,this.userForm={name:"",email:"",password:"",confirmPassword:"",role:"user",phone:"",address:""},this.$nextTick((()=>{const e=new V.aF(this.$refs.userModal);e.show()}))},openEditUserModal(e){this.isEditing=!0,this.currentIndex=e,this.userForm={...this.users[e]},this.userForm.password="",this.userForm.confirmPassword="";const t=new V.aF(this.$refs.userModal);t.show()},async saveUser(){try{if(this.userForm.password!==this.userForm.confirmPassword)return void alert("密碼和確認密碼不一致");if(this.isEditing){const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address};this.userForm.password&&(e.password=this.userForm.password),await ge.A.put(`/api/users/${this.userForm.id}`,e),this.users[this.currentIndex]={...this.userForm}}else{const e={name:this.userForm.name,email:this.userForm.email,role:this.userForm.role,phone:this.userForm.phone,address:this.userForm.address,password:this.userForm.password},t=await ge.A.post("/api/users",e);this.users.push(t.data)}this.closeModal()}catch(e){console.error("更新用戶資料時錯誤！",e),alert("更新用戶資料失敗！")}},async deleteUser(e){if(confirm("確定要刪除此用戶嗎？"))try{await ge.A.delete(`/api/users/${this.users[e].id}`),this.users.splice(e,1)}catch(t){alert("無法刪除用戶")}},closeModal(){this.$nextTick((()=>{const e=V.aF.getInstance(this.$refs.userModal);e&&e.hide()}))}}};const $r=(0,y.A)(Xr,[["render",Nr],["__scopeId","data-v-ef3d2a10"]]);var qr=$r;const Vr={class:"admin-dashboard container mt-5"},Wr={class:"filters d-flex justify-content-between mb-3"},Kr={class:"table table-hover"},Br=["onClick"],Qr=["onClick","disabled","title"],jr={key:0},Jr={class:"d-flex justify-content-center align-items-center"},zr=["disabled"],Hr=["disabled"];function Gr(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",Vr,[t[8]||(t[8]=(0,r.Lk)("h2",{class:"text-center"},"訂單管理",-1)),(0,r.Lk)("div",Wr,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control me-2",placeholder:"搜尋訂單號或用戶名","onUpdate:modelValue":t[0]||(t[0]=e=>n.searchQuery=e)},null,512),[[s.Jo,n.searchQuery]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedStatus=e),class:"form-select me-2","aria-label":"訂單狀態篩選"},t[5]||(t[5]=[(0,r.Fv)('<option value="" data-v-41c61baa>全部狀態</option><option value="pending" data-v-41c61baa>待確認</option><option value="shipped" data-v-41c61baa>已發貨</option><option value="completed" data-v-41c61baa>已完成</option><option value="cancelled" data-v-41c61baa>已取消</option>',5)]),512),[[s.u1,n.selectedStatus]]),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[2]||(t[2]=(...e)=>i.filterOrders&&i.filterOrders(...e))},"篩選")]),(0,r.Lk)("table",Kr,[t[7]||(t[7]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"訂單號"),(0,r.Lk)("th",null,"用戶編號"),(0,r.Lk)("th",null,"總金額"),(0,r.Lk)("th",null,"訂單狀態"),(0,r.Lk)("th",null,"建立日期"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.paginatedOrders,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(e.id),1),(0,r.Lk)("td",null,(0,l.v_)(e.user_id)+" - "+(0,l.v_)(i.getUserName(e.user_id)),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatCurrency(e.total)),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatStatus(e.status)),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatDate(e.order_date)),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-info btn-sm me-2",onClick:t=>i.viewOrderDetails(e)},"查看",8,Br),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:t=>i.cancelOrder(e),disabled:"cancelled"===e.status||"completed"===e.status,title:"cancelled"===e.status||"completed"===e.status?"無法取消或已取消的訂單":"取消訂單"}," 取消訂單 ",8,Qr)])])))),128)),0===i.paginatedOrders.length?((0,r.uX)(),(0,r.CE)("tr",jr,t[6]||(t[6]=[(0,r.Lk)("td",{colspan:"6",class:"text-center"},"沒有符合條件的訂單。",-1)]))):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Jr,[(0,r.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:t[3]||(t[3]=(...e)=>i.prevPage&&i.prevPage(...e)),disabled:1===n.currentPage},"上一頁",8,zr),(0,r.Lk)("span",null,(0,l.v_)(n.currentPage)+" / "+(0,l.v_)(i.totalPages)+"頁",1),(0,r.Lk)("button",{class:"btn btn-outline-primary ms-2",onClick:t[4]||(t[4]=(...e)=>i.nextPage&&i.nextPage(...e)),disabled:n.currentPage===i.totalPages},"下一頁",8,Hr)])])}var Zr=a(2952),Yr=a.n(Zr),eo={name:"AdminOrders",data(){return{orders:[],users:[],searchQuery:"",selectedStatus:"",currentPage:1,itemsPerPage:10,debouncedFilter:null}},computed:{filteredOrders(){return this.orders.filter((e=>{const t=e.userId&&e.userId.toString().toLowerCase().includes(this.searchQuery.toLowerCase())||e.id&&e.id.toString().toLowerCase().includes(this.searchQuery.toLowerCase()),a=!this.selectedStatus||e.status===this.selectedStatus;return t&&a}))},totalPages(){return Math.ceil(this.filteredOrders.length/this.itemsPerPage)||1},paginatedOrders(){const e=(this.currentPage-1)*this.itemsPerPage,t=this.currentPage*this.itemsPerPage;return this.filteredOrders.slice(e,t)}},methods:{async fetchOrders(){try{const e=await ge.A.get("/api/orders");console.log("API回傳的訂單資料",e.data);const t=e.data;this.orders=t.map((e=>({...e,status:e.status||"pending"})))||[]}catch(e){console.error("加載訂單時出錯",e),alert("加載訂單時出錯"),this.orders=[]}},async fetchUsers(){try{const e=await ge.A.get("/api/users");this.users=e.data||[]}catch(e){console.error("加載用戶時出錯",e),alert("加載用戶時出錯，請稍候再試！"),this.users=[]}},viewOrderDetails(e){console.log("查看訂單",e),this.$router.push({name:"OrderDetail",params:{id:e.id}})},async cancelOrder(e){if(confirm("確定要取消這個訂單？"))try{await ge.A.put(`/api/orders/${e.id}/status`,{status:"cancelled"}),e.status="cancelled",alert("訂單已成功取消。")}catch(t){console.error("取消訂單時出錯",t),alert("取消訂單時出錯")}},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatStatus(e){const t={pending:"待確認",shipped:"已發貨",completed:"已完成",cancelled:"已取消"};return t[e]||"未知狀態"},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},filterOrders(){this.currentPage=1},getUserName(e){const t=this.users.find((t=>t.id==e));return t?t.name:"未知用戶"}},mounted(){this.fetchOrders(),this.fetchUsers(),this.debouncedFilter=Yr()(this.filterOrders,300)},watch:{searchQuery(){this.debouncedFilter()},selectedStatus(){this.debouncedFilter()}}};const to=(0,y.A)(eo,[["render",Gr],["__scopeId","data-v-41c61baa"]]);var ao=to;const so={class:"container mt-5"},ro={class:"mb-3"},oo={class:"mb-3"},no={class:"mb-3"},io={class:"mb-3"},lo={class:"mb-3"},co={key:0,class:"text-danger"},uo={class:"mb-3"},po={key:0,class:"text-danger"},mo={class:"mb-3"},ho={key:0},go=["src"];function bo(e,t,a,o,n,i){const l=(0,r.g2)("Multiselect");return(0,r.uX)(),(0,r.CE)("div",so,[t[17]||(t[17]=(0,r.Lk)("h2",{class:"text-center mb-4"},"新增商品",-1)),(0,r.Lk)("form",{onSubmit:t[7]||(t[7]=(0,s.D$)(((...e)=>o.createProduct&&o.createProduct(...e)),["prevent"]))},[(0,r.Lk)("div",ro,[t[8]||(t[8]=(0,r.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.productForm.name=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.name]])]),(0,r.Lk)("div",oo,[t[9]||(t[9]=(0,r.Lk)("label",{for:"description",class:"form-label"},"商品描述",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.productForm.description=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.description]])]),(0,r.Lk)("div",no,[t[10]||(t[10]=(0,r.Lk)("label",{for:"price",class:"form-label"},"價格",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>o.productForm.price=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.price]])]),(0,r.Lk)("div",io,[t[11]||(t[11]=(0,r.Lk)("label",{for:"stock",class:"form-label"},"庫存",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>o.productForm.stock=e),class:"form-control",required:""},null,512),[[s.Jo,o.productForm.stock]])]),(0,r.Lk)("div",lo,[t[12]||(t[12]=(0,r.Lk)("label",{for:"brand_id",class:"form-label"},"選擇品牌",-1)),(0,r.bF)(l,{modelValue:o.productForm.brand_id,"onUpdate:modelValue":t[4]||(t[4]=e=>o.productForm.brand_id=e),options:o.brands,searchable:!0,taggable:!0,label:"name",key:"id",valueProp:"id",placeholder:"搜尋或選擇品牌",onSelect:o.handleBrandSelect,onTag:o.createNewBrand},null,8,["modelValue","options","onSelect","onTag"]),!o.productForm.brand_id&&o.formSubmitted?((0,r.uX)(),(0,r.CE)("span",co,"請選擇品牌")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",uo,[t[13]||(t[13]=(0,r.Lk)("label",{for:"tag_ids",class:"form-label"},"選擇標籤",-1)),(0,r.bF)(l,{modelValue:o.productForm.tag_ids,"onUpdate:modelValue":t[5]||(t[5]=e=>o.productForm.tag_ids=e),options:o.tags,searchable:!0,taggable:!0,label:"name",multiple:!0,key:"id",valueProp:"id",placeholder:"搜尋或選擇標籤",onSelect:o.handleTagSelect,onTag:o.createNewTag},null,8,["modelValue","options","onSelect","onTag"]),!o.productForm.tag_ids?.length&&o.formSubmitted?((0,r.uX)(),(0,r.CE)("span",po,"請選擇至少一個標籤")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",mo,[t[14]||(t[14]=(0,r.Lk)("label",{for:"productImage",class:"form-label"},"圖片上傳",-1)),(0,r.Lk)("input",{type:"file",class:"form-control",id:"productImage",onChange:t[6]||(t[6]=(...e)=>o.selectImage&&o.selectImage(...e)),accept:"image/*"},null,32)]),o.productForm.imagePreview?((0,r.uX)(),(0,r.CE)("div",ho,[t[15]||(t[15]=(0,r.Lk)("h5",null,"圖片預覽",-1)),(0,r.Lk)("img",{src:o.productForm.imagePreview,alt:"商品圖片",style:{"max-width":"200px"}},null,8,go)])):(0,r.Q3)("",!0),t[16]||(t[16]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"新增商品",-1))],32)])}a(4603),a(7566),a(8721);var ko=a(8074),vo={name:"CreateProduct",components:{Multiselect:ko.Ay},setup(){const e=(0,K.rd)(),t=(0,je.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],created_at:(new Date).toISOString().split("T")[0],imageFile:null,imagePreview:""}),a=()=>t.name.trim()?t.description.trim()?t.price<=0?(alert("價格必填且需大於 0"),!1):t.stock<=0?(alert("庫存必填且需大於 0"),!1):t.brand_id?!!t.tag_ids.length||(alert("請選擇至少一個標籤"),!1):(alert("請選擇品牌"),!1):(alert("商品描述必填"),!1):(alert("商品名稱必填"),!1),s=(0,je.KR)([]),o=(0,je.KR)([]),n=(0,je.KR)(!1),i=async()=>{try{const e=await ge.A.get("/api/brands");s.value=e.data,console.log("加載的品牌資料:",s.value)}catch(e){console.error("讀取品牌資料時出錯:",e)}},l=async()=>{try{const e=await ge.A.get("/api/tags");o.value=e.data,console.log("加載的標籤資料:",o.value)}catch(e){console.error("讀取標籤資料時出錯:",e)}},c=e=>{t.brand_id=e,console.log("選擇的品牌:",e)},d=e=>{Array.isArray(e)?t.tag_ids=e:t.tag_ids=[e].filter(Boolean),console.log("選擇的標籤",e)},u=async e=>{try{const a=await ge.A.post("/api/brands",{name:e}),r=a.data;s.value.push(r),t.brand_id=r.id,alert("新品牌已添加")}catch(a){console.error("創建新品牌時出錯",a),alert("創建新品牌時出錯，請稍候再試")}},p=async e=>{try{const a=await ge.A.post("/api/tags",{name:e}),s=a.data;o.value.push(s),t.tag_ids.push(s.id),alert("新標籤已增加")}catch(a){console.error("創建新標籤時出錯",a),alert("創建新標籤時出錯，請稍候再試。")}};(0,r.sV)((()=>{i(),l()}));const m=async()=>{if(n.value=!0,a())if(t.brand_id&&t.tag_ids&&0!==t.tag_ids.length)try{const a=new FormData;let s=[];Array.isArray(t.tag_ids)&&(s=t.tag_ids.map((e=>"object"===typeof e?e.id:e))),a.append("name",t.name),a.append("description",t.description),a.append("price",String(t.price)),a.append("stock",String(t.stock)),a.append("brand_id","object"===typeof t.brand_id?t.brand_id.id:t.brand_id),a.append("tag_ids",JSON.stringify(s)),a.append("created_at",t.created_at),t.imageFile&&a.append("image",t.imageFile);const r=await ge.A.post("/api/products",a,{headers:{"Content-Type":"multipart/form-data"},timeout:1e4});console.log("伺服器回應：",r.data),alert("商品新增成功"),e.push("/admin/products")}catch(s){console.error("新增商品時出錯:",s);let e="新增商品失敗";"ERR_NETWORK"===s.code?e="無法連接到伺服器，請確認伺服器是否正常運行。":s.response?e=`伺服器錯誤: ${s.response.data?.message||s.message}`:s.request&&(e="未收到伺服器回應，請稍後再試。"),alert(e)}else alert("請選擇品牌和至少一個標籤")},h=e=>{const a=e.target.files[0];if(a){if(a.size>5242880)return alert("圖片大小不能超過5MB!"),void(e.target.value="");if(!a.type.startsWith("image/"))return alert("請上傳正確的圖片格式"),void(e.target.value="");t.imageFile=a,t.imagePreview=URL.createObjectURL(a)}};return{productForm:t,brands:s,tags:o,formSubmitted:n,createProduct:m,selectImage:h,handleBrandSelect:c,handleTagSelect:d,validateForm:a,createNewBrand:u,createNewTag:p}}};const fo=(0,y.A)(vo,[["render",bo],["__scopeId","data-v-cd4324ac"]]);var Lo=fo;const yo={class:"container mt-5"},wo={key:0,class:"text-center my-5"},Co={key:0,class:"text-center mb-4"},_o=["src"],Io={class:"mb-3"},Fo={class:"mb-3"},Eo={class:"input-group"},Po=["readonly"],So={class:"mb-3"},Oo={class:"input-group"},Ao=["readonly"],xo={class:"mb-3"},To={class:"input-group"},Uo=["readonly"],Do={class:"mb-3"},Mo={class:"input-group"},Ro=["readonly"],No={class:"mb-3"},Xo={class:"input-group"},$o={class:"mb-3"},qo={class:"input-group"},Vo={class:"custom-tag"},Wo=["onClick"];function Ko(e,t,a,o,n,i){const c=(0,r.g2)("Multiselect");return(0,r.uX)(),(0,r.CE)("div",yo,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"text-center"},"編輯產品資訊",-1)),o.isLoading?((0,r.uX)(),(0,r.CE)("div",wo,t[14]||(t[14]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"載入中...")],-1)]))):(0,r.Q3)("",!0),o.isLoading?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("form",{key:1,onSubmit:t[13]||(t[13]=(0,s.D$)(((...e)=>o.updateProduct&&o.updateProduct(...e)),["prevent"]))},[o.productForm.imagePreview?((0,r.uX)(),(0,r.CE)("div",Co,[(0,r.Lk)("img",{src:o.productForm.imagePreview,alt:"Product Image",class:"product-image"},null,8,_o)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Io,[t[15]||(t[15]=(0,r.Lk)("label",{for:"productImage",class:"form-label"},"產品圖片",-1)),(0,r.Lk)("input",{type:"file",id:"productImage",class:"form-control",onChange:t[0]||(t[0]=(...e)=>o.selectImage&&o.selectImage(...e))},null,32)]),(0,r.Lk)("div",Fo,[t[16]||(t[16]=(0,r.Lk)("label",{for:"productName",class:"form-label"},"商品名稱",-1)),(0,r.Lk)("div",Eo,[(0,r.bo)((0,r.Lk)("input",{type:"text",id:"productName",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>o.productForm.name=e),readonly:!o.editableFields.name,required:""},null,8,Po),[[s.Jo,o.productForm.name]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=e=>o.toggleEdit("name"))},(0,l.v_)(o.editableFields.name?"完成":"修改"),1)])]),(0,r.Lk)("div",So,[t[17]||(t[17]=(0,r.Lk)("label",{for:"productPrice",class:"form-label"},"價格",-1)),(0,r.Lk)("div",Oo,[(0,r.bo)((0,r.Lk)("input",{type:"number",id:"productPrice",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>o.productForm.price=e),readonly:!o.editableFields.price,required:""},null,8,Ao),[[s.Jo,o.productForm.price]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=e=>o.toggleEdit("price"))},(0,l.v_)(o.editableFields.price?"完成":"修改"),1)])]),(0,r.Lk)("div",xo,[t[18]||(t[18]=(0,r.Lk)("label",{for:"productStock",class:"form-label"},"庫存",-1)),(0,r.Lk)("div",To,[(0,r.bo)((0,r.Lk)("input",{type:"number",id:"productStock",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>o.productForm.stock=e),readonly:!o.editableFields.stock,required:""},null,8,Uo),[[s.Jo,o.productForm.stock]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[6]||(t[6]=e=>o.toggleEdit("stock"))},(0,l.v_)(o.editableFields.stock?"完成":"修改"),1)])]),(0,r.Lk)("div",Do,[t[19]||(t[19]=(0,r.Lk)("label",{for:"productDescription",class:"form-label"},"描述",-1)),(0,r.Lk)("div",Mo,[(0,r.bo)((0,r.Lk)("textarea",{type:"number",id:"productDescription",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=e=>o.productForm.description=e),readonly:!o.editableFields.description,required:""},null,8,Ro),[[s.Jo,o.productForm.description]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[8]||(t[8]=e=>o.toggleEdit("description"))},(0,l.v_)(o.editableFields.description?"完成":"修改"),1)])]),(0,r.Lk)("div",No,[t[20]||(t[20]=(0,r.Lk)("label",{for:"productBrand",class:"form-label"},"廠牌",-1)),(0,r.Lk)("div",Xo,[(0,r.bF)(c,{modelValue:o.productForm.brand_id,"onUpdate:modelValue":t[9]||(t[9]=e=>o.productForm.brand_id=e),options:o.brands,searchable:!0,label:"name","value-prop":"id",placeholder:"請選擇廠牌",disabled:!o.editableFields.brand_id,required:""},null,8,["modelValue","options","disabled"]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[10]||(t[10]=e=>o.toggleEdit("brand_id"))},(0,l.v_)(o.editableFields.brand_id?"完成":"修改"),1)])]),(0,r.Lk)("div",$o,[t[21]||(t[21]=(0,r.Lk)("label",{for:"productTags",class:"form-label"},"標籤",-1)),(0,r.Lk)("div",qo,[(0,r.bF)(c,{modelValue:o.productForm.tag_ids,"onUpdate:modelValue":t[11]||(t[11]=e=>o.productForm.tag_ids=e),options:o.tags,label:"name","value-prop":"id",placeholder:"請選擇標籤",disabled:!o.editableFields.tag_ids,required:"",multiple:""},{tag:(0,r.k6)((({option:e,remove:t})=>[(0,r.Lk)("span",Vo,[(0,r.eW)((0,l.v_)(e.name)+" ",1),(0,r.Lk)("button",{type:"button",onClick:a=>t(e)}," X ",8,Wo)])])),_:1},8,["modelValue","options","disabled"]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[12]||(t[12]=e=>o.toggleEdit("tag_ids"))},(0,l.v_)(o.editableFields.tag_ids?"完成":"修改"),1)])]),t[22]||(t[22]=(0,r.Lk)("button",{type:"submit",class:"btn btn-primary"},"更新產品",-1))],32))])}var Bo=a(4014),Qo={name:"EditProduct",components:{Multiselect:Bo.A},setup(){const e=(0,K.rd)(),t=(0,K.lq)(),a=t.params.id,s=(0,je.KR)(!0),o=(0,je.Kh)({name:!1,price:!1,stock:!1,description:!1,brand_id:!1,tag_ids:!1}),n=e=>{o[e]=!o[e]},i=(0,je.Kh)({name:"",description:"",price:0,stock:0,brand_id:null,tag_ids:[],imageFile:null,imagePreview:""}),l=(0,je.KR)([]),c=(0,je.KR)([]),d=async()=>{try{s.value=!0;const[e,t,r]=await Promise.all([ge.A.get(`/api/products/${a}`),ge.A.get("/api/brands"),ge.A.get("/api/tags")]);l.value=t.data,c.value=r.data;const o=e.data;if(i.name=o.name,i.description=o.description,i.price=o.price,i.stock=o.stock,i.imagePreview=o.image?`/api/${o.image}`:"",o.brand_id){const e=l.value.find((e=>Number(e.id)===Number(o.brand_id)));i.brand_id=e?e.id:null}o.tag_ids&&Array.isArray(o.tag_ids)&&(i.tag_ids=o.tag_ids.map((e=>Number(e)))),console.log("成功讀取資料！",{product:o,selectedBrand:i.brand_id,selectedTags:i.tag_ids})}catch(e){console.error("加載商品訊息時出錯",e),alert("加載商品訊息時出錯，請稍後再試！")}finally{s.value=!1}},u=async()=>{try{const t=new FormData;t.append("name",i.name),t.append("description",i.description),t.append("price",i.price),t.append("stock",i.stock),t.append("brand_id",i.brand_id?.id),t.append("tag_ids",JSON.stringify(i.tag_ids.map((e=>e.id)))),i.imageFile&&t.append("image",i.imageFile),await ge.A.put(`/api/products/${a}`,t,{headers:{"Content-Type":"multipart/form-data"}}),alert("更新商品成功！"),e.push("/products")}catch(t){console.error("更新商品時出錯:",t),alert("更新商品時出錯，請稍後再試！")}},p=e=>{const t=e.target.files[0];t&&(i.imageFile=t,i.imagePreview=URL.createObjectURL(t))};return(0,r.sV)((async()=>{await d()})),{productForm:i,brands:l,tags:c,isLoading:s,editableFields:o,toggleEdit:n,updateProduct:u,selectImage:p}}};const jo=(0,y.A)(Qo,[["render",Ko]]);var Jo=jo;function zo(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)("h5",null,"AdminContact")}var Ho={name:"AdminContact"};const Go=(0,y.A)(Ho,[["render",zo]]);var Zo=Go;const Yo={class:"order-detail container mt-5"},en={key:0},tn={class:"order-info mb-4"},an={class:"mb-3"},sn={class:"table table-bordered"},rn={key:1};function on(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",Yo,[t[13]||(t[13]=(0,r.Lk)("h2",{class:"text-center"},"訂單詳情",-1)),n.order?((0,r.uX)(),(0,r.CE)("div",en,[(0,r.Lk)("div",tn,[(0,r.Lk)("p",null,[t[3]||(t[3]=(0,r.Lk)("strong",null,"訂單號：",-1)),(0,r.eW)((0,l.v_)(n.order.id),1)]),(0,r.Lk)("p",null,[t[4]||(t[4]=(0,r.Lk)("strong",null,"會員編號：",-1)),(0,r.eW)((0,l.v_)(n.order.user_id),1)]),(0,r.Lk)("p",null,[t[5]||(t[5]=(0,r.Lk)("strong",null,"用戶名：",-1)),(0,r.eW)((0,l.v_)(n.userName),1)]),(0,r.Lk)("p",null,[t[6]||(t[6]=(0,r.Lk)("strong",null,"建立日期：",-1)),(0,r.eW)((0,l.v_)(i.formatDate(n.order.orderDate)),1)]),(0,r.Lk)("p",null,[t[7]||(t[7]=(0,r.Lk)("strong",null,"總金額：",-1)),(0,r.eW)((0,l.v_)(i.formatCurrency(n.order.total)),1)]),(0,r.Lk)("div",an,[t[9]||(t[9]=(0,r.Lk)("label",{for:"orderStatus",class:"form-label"},[(0,r.Lk)("strong",null,"訂單狀態：")],-1)),(0,r.bo)((0,r.Lk)("select",{id:"orderStatus","onUpdate:modelValue":t[0]||(t[0]=e=>n.order.status=e),class:"form-select",onChange:t[1]||(t[1]=(...e)=>i.updateOrderStatus&&i.updateOrderStatus(...e))},t[8]||(t[8]=[(0,r.Lk)("option",{value:"pending"},"待確認",-1),(0,r.Lk)("option",{value:"shipped"},"已發貨",-1),(0,r.Lk)("option",{value:"completed"},"已完成",-1),(0,r.Lk)("option",{value:"cancelled"},"已取消",-1)]),544),[[s.u1,n.order.status]])])]),t[11]||(t[11]=(0,r.Lk)("h4",null,"商品列表",-1)),(0,r.Lk)("table",sn,[t[10]||(t[10]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"數量"),(0,r.Lk)("th",null,"單價"),(0,r.Lk)("th",null,"小計")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.order.items,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.productId},[(0,r.Lk)("td",null,(0,l.v_)(e.product_name),1),(0,r.Lk)("td",null,(0,l.v_)(e.quantity),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatCurrency(e.price)),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatCurrency(e.price*e.quantity)),1)])))),128))])]),(0,r.Lk)("button",{class:"btn btn-secondary mt-3",onClick:t[2]||(t[2]=(...e)=>i.goBack&&i.goBack(...e))},"返回")])):((0,r.uX)(),(0,r.CE)("div",rn,t[12]||(t[12]=[(0,r.Lk)("p",null,"正在加載訂單詳情...",-1)])))])}var nn={name:"OrderDetail",props:["id"],data(){return{order:null,userName:""}},methods:{async fetchOrderDetails(e){try{const t=await ge.A.get(`/api/orders/${e}`);this.order=t.data.order||t.data,this.fetchUserName(this.order.user_id)}catch(t){console.error("加載訂單詳情時出錯",t),alert("加載訂單詳情時出錯，請稍候再試！"),this.order=null}},async fetchUserName(e){try{const t=await ge.A.get(`/api/users/${e}`),a=t.data.user||t.data;this.userName=a.name||"未知用戶"}catch(t){console.error("加載用戶資訊時出錯",t),this.userName="未知用戶"}},formatCurrency(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},formatDate(e){const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(e).toLocaleDateString("zh-TW",t)},async updateOrderStatus(){if(this.order)try{await ge.A.put(`/api/orders/${this.order.id}`,{status:this.order.status}),alert("訂單狀態已更新")}catch(e){console.error("更新訂單狀態時出錯",e),alert("更新訂單狀態時出錯，請稍候再試！")}},goBack(){this.$router.go(-1)}},mounted(){const e=this.id||this.$route.params.id;this.fetchOrderDetails(e)}};const ln=(0,y.A)(nn,[["render",on],["__scopeId","data-v-2181e1df"]]);var cn=ln;const dn={class:"carousel-management container mt-5"},un={class:"carousel-image-list d-flex flex-wrap"},pn=["src"],mn=["onClick"],hn={class:"me-2"},gn=["onClick"],bn={class:"upload-section mt-4"},kn={key:0,class:"preview-section mt-3"},vn=["src"],fn={class:"mt-2"};function Ln(e,t,a,s,o,n){return(0,r.uX)(),(0,r.CE)("div",dn,[t[5]||(t[5]=(0,r.Lk)("h2",{class:"text-center"},"輪播圖片管理",-1)),(0,r.Lk)("div",un,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.carouselImages,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"carousel-image-item m-2"},[(0,r.Lk)("img",{src:n.getImageUrl(e.url),alt:"輪播圖片",class:"img-thumbnail"},null,8,pn),(0,r.Lk)("button",{class:"btn btn-danger btn-sm mt-2",onClick:t=>n.deleteCarouselImage(e.id)},"刪除圖片",8,mn),(0,r.Lk)("div",hn,[(0,r.Lk)("button",{class:"btn btn-secondary btn-sm",onClick:t=>n.toggleImageVisibility(e)},(0,l.v_)(e.visible?"隱藏":"顯示"),9,gn)])])))),128))]),(0,r.Lk)("div",bn,[t[4]||(t[4]=(0,r.Lk)("h4",null," 上傳新圖片 ",-1)),(0,r.Lk)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>n.handleFileSelect&&n.handleFileSelect(...e)),accept:"image/*",ref:"fileInput"},null,544),o.previewUrl?((0,r.uX)(),(0,r.CE)("div",kn,[t[3]||(t[3]=(0,r.Lk)("h5",null,"預覽圖片",-1)),(0,r.Lk)("img",{src:o.previewUrl,alt:"上傳的圖片",class:"img-thumbnail",style:{"max-width":"300px"}},null,8,vn),(0,r.Lk)("div",fn,[(0,r.Lk)("button",{class:"btn btn-primary me-2",onClick:t[1]||(t[1]=(...e)=>n.confirmUpload&&n.confirmUpload(...e))},"確認上傳"),(0,r.Lk)("button",{class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>n.cancelUpload&&n.cancelUpload(...e))},"取消上傳")])])):(0,r.Q3)("",!0)])])}var yn={name:"AdminCarouselImages",data(){return{carouselImages:[],selectedFile:null,previewUrl:""}},async mounted(){await this.loadCarouselImages()},methods:{async loadCarouselImages(){try{const e=await ge.A.get("/api/carousel_images");this.carouselImages=e.data||[]}catch(e){console.error("加載輪播圖片失敗",e),alert("加載輪播圖片失敗！")}},handleFileSelect(e){const t=e.target.files[0];if(t){const e=["image/jpeg","image/png","image/gif"],a=5242880;if(!e.includes(t.type))return void alert("僅支援JPEG, PNG, GIF 格式的圖片！");if(t.size>a)return void alert("圖片超出5MB的上限！");this.selectedFile=t,this.previewUrl=URL.createObjectURL(t)}},async confirmUpload(){if(!this.selectedFile)return void alert("沒有選擇任何文件！");const e=new FormData;e.append("image",this.selectedFile);try{const t=await ge.A.post("/api/carousel_images",e,{headers:{"Content-Type":"multipart/form-data"}});this.carouselImages.push(t.data),alert("圖片上傳成功"),this.resetUpload()}catch(t){console.error("圖片上傳失敗",t),alert("圖片上傳失敗!")}},cancelUpload(){this.resetUpload()},resetUpload(){this.selectedFile=null,this.previewUrl="",this.$refs.fileInput.value=""},async deleteCarouselImage(e){if(confirm("確定要刪除這張圖片嗎？"))try{await ge.A.delete(`/api/carousel_images/${e}`),this.carouselImages=this.carouselImages.filter((t=>t.id!==e)),alert("圖片已刪除。")}catch(t){console.error("圖片刪除失敗",t),alert("圖片刪除失敗！請稍後再試。")}},async toggleImageVisibility(e){const t=!e.visible;try{await ge.A.put(`/api/carousel_images/${e.id}`,{visible:t}),e.visible=t,alert(`圖片已${t?"顯示":"隱藏"}。`)}catch(a){console.error("更新圖片狀態失敗",a),alert("更新圖片狀態失敗！")}},getImageUrl(e){return`/api/${e}`}}};const wn=(0,y.A)(yn,[["render",Ln],["__scopeId","data-v-dc35b1bc"]]);var Cn=wn;const _n={class:"special-offers-dashboard container mt-5"},In={class:"d-flex justify-content-end mb-3"},Fn={class:"accordion",id:"specialOffersAccordion"},En={class:"accordion-item"},Pn={id:"collapseSpecialOffers",class:"accordion-collapse collapse show","aria-labelledby":"headingSpecialOffers","data-bs-parent":"#specialOffersAccordion"},Sn={class:"accordion-body"},On={class:"table"},An=["onClick"],xn=["onClick"],Tn={class:"modal fade",tabindex:"-1",ref:"specialOfferModal"},Un={class:"modal-dialog"},Dn={class:"modal-content"},Mn={class:"modal-header"},Rn={class:"modal-title"},Nn={class:"modal-body"},Xn={class:"mb-3"},$n={key:0,class:"list-group mt-2"},qn=["onClick"],Vn={key:1,class:"mt-2"},Wn={class:"mb-3"},Kn={class:"mb-3"},Bn={class:"mb-3"},Qn={class:"modal-footer"};function jn(e,t,a,o,n,i){return(0,r.uX)(),(0,r.CE)("div",_n,[t[17]||(t[17]=(0,r.Lk)("h2",{class:"text-center"},"特價商品管理",-1)),(0,r.Lk)("div",In,[(0,r.Lk)("button",{class:"btn btn-success",onClick:t[0]||(t[0]=(...e)=>i.openCreateSpecialOfferModal&&i.openCreateSpecialOfferModal(...e))},"新增特價商品")]),(0,r.Lk)("div",Fn,[(0,r.Lk)("div",En,[t[11]||(t[11]=(0,r.Lk)("h2",{class:"accordion-header",id:"headingSpecialOffers"},[(0,r.Lk)("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseSpecialOffers","aria-expanded":"true","aria-controls":"collapseSpecialOffers"}," 特價商品管理 ")],-1)),(0,r.Lk)("div",Pn,[(0,r.Lk)("div",Sn,[(0,r.Lk)("table",On,[t[10]||(t[10]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"商品名稱"),(0,r.Lk)("th",null,"特價價格"),(0,r.Lk)("th",null,"倒數時間 (秒)"),(0,r.Lk)("th",null,"創建日期"),(0,r.Lk)("th",null,"操作")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.specialOffers,((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id},[(0,r.Lk)("td",null,(0,l.v_)(i.getProductName(e.product_id)),1),(0,r.Lk)("td",null,(0,l.v_)(e.price),1),(0,r.Lk)("td",null,(0,l.v_)(e.countdown),1),(0,r.Lk)("td",null,(0,l.v_)(i.formatDate(e.created_at)),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn btn-warning btn-sm me-2",onClick:e=>i.openEditSpecialOfferModal(t)},"編輯",8,An),(0,r.Lk)("button",{class:"btn btn-danger btn-sm",onClick:a=>i.deleteSpecialOffer(e.id,t)},"刪除",8,xn)])])))),128))])])])])])]),(0,r.Lk)("div",Tn,[(0,r.Lk)("div",Un,[(0,r.Lk)("div",Dn,[(0,r.Lk)("div",Mn,[(0,r.Lk)("h5",Rn,(0,l.v_)(n.isEditing?"編輯特價商品":"新增特價商品"),1),(0,r.Lk)("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=(...e)=>i.closeSpecialOfferModal&&i.closeSpecialOfferModal(...e))})]),(0,r.Lk)("div",Nn,[(0,r.Lk)("div",Xn,[t[13]||(t[13]=(0,r.Lk)("label",{for:"productSelect",class:"form-label"},"搜尋商品名稱",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"productSearch",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>n.productSearchKeyword=e),onInput:t[3]||(t[3]=(...t)=>e.debouncedSearchProducts&&e.debouncedSearchProducts(...t)),required:""},null,544),[[s.Jo,n.productSearchKeyword]]),n.searchResults.length>0?((0,r.uX)(),(0,r.CE)("ul",$n,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.searchResults,(e=>((0,r.uX)(),(0,r.CE)("li",{class:"list-group-item list-group-item-action",key:e.id,onClick:t=>i.selectProduct(e)},(0,l.v_)(e.name),9,qn)))),128))])):(0,r.Q3)("",!0),n.selectedProduct?((0,r.uX)(),(0,r.CE)("div",Vn,[t[12]||(t[12]=(0,r.Lk)("strong",null,"已選擇商品：",-1)),(0,r.eW)((0,l.v_)(n.selectedProduct.name)+" ",1),(0,r.Lk)("button",{type:"button",class:"btn btn-sm btn-outline-danger ms-2",onClick:t[4]||(t[4]=(...e)=>i.clearSelectedProduct&&i.clearSelectedProduct(...e))},"移除")])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Wn,[t[14]||(t[14]=(0,r.Lk)("label",{for:"priceInput",class:"form-label"},"特價價格",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",id:"priceInput","onUpdate:modelValue":t[5]||(t[5]=e=>n.specialOfferForm.price=e),class:"form-control",placeholder:"請輸入特價價格",required:""},null,512),[[s.Jo,n.specialOfferForm.price]])]),(0,r.Lk)("div",Kn,[t[15]||(t[15]=(0,r.Lk)("label",{for:"countdownInput",class:"form-label"},"倒數時間 (秒)",-1)),(0,r.bo)((0,r.Lk)("input",{type:"number",id:"countdownInput","onUpdate:modelValue":t[6]||(t[6]=e=>n.specialOfferForm.countdown=e),class:"form-control",placeholder:"請輸入倒數時間",required:""},null,512),[[s.Jo,n.specialOfferForm.countdown]])]),(0,r.Lk)("div",Bn,[t[16]||(t[16]=(0,r.Lk)("label",{for:"createdAtInput",class:"form-label"},"創建日期",-1)),(0,r.bo)((0,r.Lk)("input",{type:"date",id:"createdAtInput","onUpdate:modelValue":t[7]||(t[7]=e=>n.specialOfferForm.created_at=e),class:"form-control",required:""},null,512),[[s.Jo,n.specialOfferForm.created_at]])])]),(0,r.Lk)("div",Qn,[(0,r.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[8]||(t[8]=(...e)=>i.closeSpecialOfferModal&&i.closeSpecialOfferModal(...e))},"取消"),(0,r.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>i.saveSpecialOffer&&i.saveSpecialOffer(...e))},(0,l.v_)(n.isEditing?"保存變更":"新增特價商品"),1)])])])],512)])}var Jn={name:"SpecialOffers",data(){return{specialOffers:[],products:[],specialOfferForm:{id:null,product_id:"",price:0,countdown:0,created_at:""},isEditing:!1,currentIndex:null,productSearchKeyword:"",searchResults:[],selectedProduct:null}},mounted(){this.loadSpecialOffers(),this.loadProducts(),this.debouncedSearchProducts=Yr()(this.searchProducts,500)},methods:{async loadSpecialOffers(){try{const e=await ge.A.get("/api/special-offers");this.specialOffers=e.data}catch(e){console.error("加載特價商品時出錯",e),alert("加載特價商品時出錯，請稍後再試！")}},async searchProducts(){if(""!==this.productSearchKeyword.trim())try{const e=await ge.A.get("/api/products/search",{params:{keyword:this.productSearchKeyword,page:1,limit:10}});this.searchResults=e.data}catch(e){console.error("搜尋商品時出錯",e),alert("搜尋商品時出錯，請稍後再試！")}else this.searchResults=[]},selectProduct(e){this.selectedProduct=e,this.specialOfferForm.product_id=e.id,this.searchResults=[],this.productSearchKeyword=""},clearSelectedProduct(){this.selectedProduct=null,this.specialOfferForm.product_id=""},async loadProducts(){try{const e=await ge.A.get("/api/products");this.products=e.data}catch(e){console.error("加載商品時出錯",e),alert("加載商品時出錯，請稍後再試！")}},formatDate(e){const t=new Date(e);return t.toLocaleDateString()},openCreateSpecialOfferModal(){this.isEditing=!1,this.specialOfferForm={id:null,product_id:"",price:0,countdown:0,created_at:""},this.selectedProduct=null,this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new V.aF(this.$refs.specialOfferModal);e.show()}))},async openEditSpecialOfferModal(e){this.isEditing=!0,this.currentIndex=e;const t={...this.specialOffers[e]};this.specialOfferForm=t;try{const e=await ge.A.get(`/api/products/${t.product_id}`);this.selectedProduct=e.data}catch{console.error("取得商品資訊時出錯！"),alert("取得商品資訊時出錯，請稍後再試！")}this.productSearchKeyword="",this.searchResults=[],this.$nextTick((()=>{const e=new V.aF(this.$refs.specialOfferModal);e.show()}))},async getProductName(e){if(this.selectedProduct&&this.selectedProduct.id===e)return this.selectedProduct.name;try{const t=await ge.A.get(`/api/products/${e}`);return t.data.name}catch(t){return console.error("取得商品名稱時出錯！"),alert("取得商品名稱時出錯，請稍候再試！"),"未知商品"}},closeSpecialOfferModal(){const e=V.aF.getInstance(this.$refs.specialOfferModal);e&&e.hide()},async saveSpecialOffer(){if(this.specialOfferForm.product_id&&this.specialOfferForm.price&&this.specialOfferForm.countdown&&this.specialOfferForm.created_at)try{if(this.isEditing)await ge.A.put(`/api/special-offers/${this.specialOfferForm.id}`,this.specialOfferForm),this.specialOffers[this.currentIndex]={...this.specialOfferForm},alert("特價商品已更新！");else{const e=await ge.A.post("/api/special-offers",this.specialOfferForm);this.specialOffers.push(e.data),alert("特價商品已新增！")}this.closeSpecialOfferModal()}catch(e){console.error("保存特價商品時出錯！",e),alert("保存特價商品時出錯，請稍後再試！")}else alert("請填寫所有必填欄位！")},async deleteSpecialOffer(e,t){if(confirm("確定要刪除此特價商品？"))try{await ge.A.delete(`/api/special-offers/${e}`),this.specialOffers.splice(t,1),alert("特價商品已刪除！")}catch(a){console.error("刪除特價商品時出錯",a),alert("刪除特價商品時出錯，請稍後再試！")}}}};const zn=(0,y.A)(Jn,[["render",jn],["__scopeId","data-v-c82959e0"]]);var Hn=zn;const Gn=[{path:"/",name:"HomePage",component:fe},{path:"/admin",name:"AdminDashBoard",component:gs},{path:"/admin/Products",name:"AdminProducts",component:lr},{path:"/admin/Users",name:"AdminUsers",component:qr},{path:"/admin/Orders",name:"AdminOrders",component:ao},{path:"/admin/Orders/:id(\\d+)",name:"OrderDetail",component:cn,props:!0},{path:"/admin/CreateProduct",name:"CreateProduct",component:Lo},{path:"/admin/EditProduct/:id",name:"EditProduct",component:Jo},{path:"/admin/AdminContact",name:"AdminContact",component:Zo},{path:"/admin/CarouselImages",name:"CarouselImages",component:Cn},{path:"/admin/SpecialOffers",name:"SpecialOffers",component:Hn},{path:"/ShopCart",name:"ShopCart",component:De,meta:{requiresAuth:!0}},{path:"/ProductsList",name:"ProductsList",component:ot},{path:"/MembersPage",name:"MembersPage",component:na,meta:{requiresAuth:!0}},{path:"/AboutUsPage",name:"AboutUsPage",component:Ce},{path:"/ContactUs",name:"ContactUs",component:da},{path:"/SearchResults",name:"SearchResults",component:ha},{path:"/UserRegister",name:"UserRegister",component:Ea},{path:"/UserLogin",name:"UserLogin",component:Da},{path:"/ForgotPwd",name:"ForgotPwd",component:qa},{path:"/ProductDetail/:id",name:"ProductDetail",component:yt},{path:"/Order-Confirmation/:orderId",name:"OrderConfirmation",component:za}],Zn=(0,K.aE)({history:(0,K.LA)(),routes:Gn});Zn.beforeEach(((e,t,a)=>{const s=!!localStorage.getItem("authToken"),r=localStorage.getItem("role");e.matched.some((e=>e.meta.requiresAuth))?s?e.meta.role&&e.meta.role!==r?(alert("你沒有權限進入此頁面"),a({path:"/"})):a():(alert("請先登入再使用！"),a({path:"/UserLogin"})):a()}));var Yn=Zn,ei={namespaced:!0,state:{items:[]},getters:{cartItems:e=>e.items,cartTotal:e=>e.items.reduce(((e,t)=>e+t.price*t.quantity),0),cartItemCount:e=>e.items.reduce(((e,t)=>e+t.quantity),0)},mutations:{addToCart(e,t){const a=Number(t.price);if(isNaN(a))return void console.error("Invalid price value");const s=e.items.find((e=>e.id===t.id));s?s.quantity++:e.items.push({id:t.id,name:t.name,price:a,image:t.image,quantity:1})},removeFromCart(e,t){e.items.splice(t,1)},updateCartItemQuantity(e,{index:t,quantity:a}){e.items[t].quantity=a<1?1:a},clearCart(e){e.items=[]}},actions:{addProductToCart({commit:e},t){t&&t.id?e("addToCart",t):console.error("Invalid product data")},removeItemFromCart({commit:e},t){e("removeFromCart",t)},updateItemQuantity({commit:e},t){e("updateCartItemQuantity",t)},clearShoppingCart({commit:e}){e("clearCart")}}},ti=a(5131),ai={namespaced:!0,state:{isLoggedIn:!1,user:null,showLoginModal:!1},mutations:{login(e,t){e.isLoggedIn=!0,e.user=t},logout(e){e.isLoggedIn=!1,e.user=null},setShowLoginModal(e,t){e.showLoginModal=t}},actions:{login({commit:e},t){e("login",t),localStorage.setItem("user",JSON.stringify(t))},logout({commit:e}){e("logout"),localStorage.removeItem("user")},showLoginModal({commit:e},t){e("setShowLoginModal",t)}},getters:{isLoggedIn:e=>e.isLoggedIn,user:e=>e.user,showLoginModal:e=>e.showLoginModal}};const si={notifications:[]},ri=3,oi=2e3,ni={ADD_NOTIFICATION(e,t){if(!t.message||!t.type)return void console.error("Invalid notification data");e.notifications.length>=ri&&e.notifications.shift();const a=e.notifications.some((e=>e.message===t.message&&e.type===t.type));a||e.notifications.push(t)},REMOVE_NOTIFICATION(e,t){const a=e.notifications.findIndex((e=>e.id===t));-1!==a&&e.notifications.splice(a,1)}},ii={showNotification({commit:e},{message:t,type:a,timeout:s=oi}){if(!t||!a)return void console.error("Missing required notification parameters");const r=Date.now(),o={id:r,message:t,type:a};e("ADD_NOTIFICATION",o),s>0&&setTimeout((()=>{e("REMOVE_NOTIFICATION",r)}),s)},removeNotification({commit:e},t){e("REMOVE_NOTIFICATION",t)}};var li={namespaced:!0,state:si,mutations:ni,actions:ii},ci=(0,U.y$)({modules:{cart:ei,auth:ai,notifications:li},plugins:[(0,ti.A)()]});const di=(0,s.Ef)($);ge.A.interceptors.response.use((e=>(e.url.startsWith("/api/")&&(e.url=e.url.slice(5)),e))),di.config.globalProperties.$axios=ge.A,di.use(Yn),di.use(ci),di.use(q.A),di.use(W.Ay),di.mount("#app")}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,r,o){if(!s){var n=1/0;for(d=0;d<e.length;d++){s=e[d][0],r=e[d][1],o=e[d][2];for(var i=!0,l=0;l<s.length;l++)(!1&o||n>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(i=!1,o<n&&(n=o));if(i){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,r,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,o,n=s[0],i=s[1],l=s[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var d=l(a)}for(t&&t(s);c<n.length;c++)o=n[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self["webpackChunkeshop_site"]=self["webpackChunkeshop_site"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(3906)}));s=a.O(s)})();